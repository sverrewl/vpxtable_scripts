'        .B@MBMMOOGMM@N:   GBZ0L   rBONNkSXqSSk8u        Lqu  .             LZJ2r.   YNvLr:   UZ7v7    :Mu7L:    JLL77iirr7Lr    qU7i:iii;i7rr.
'         @OOOMOMOMOMOBPi  B@M@M;  E@MBMBB@B@B@BE:      @B@BBZv            .@B8Mjr   B@B@Xv: .@BB@Bv   M@B@ML:  @B@B@MOGBMMM@Fi 7BBMMEBMBMBBF:L
'         @ESXXEXkFkSXGF,  @NNEO:  ZBPXqP0EZqqPEMu     @BMOMM@2,           .B52MFY   @GEE@S: .BG08BX   M@E0@k: :BZqZq00Eq0N0GOJ r@NEEOEZZZEGOuv
'         @1uu5LOOqU2102:  Bk2Xqr  GMUSkXM0M0FSS8j     B@O8GOO@B           .BOMM@5   BSUFNY, .@25SOJ   8O2FEu. :@21u5FS12u22SFr 7B522u2u11F1Pv7
'         B2Yu2,.7B0JuFu:  @2U5Xi  GOUUXv   Bk2S0j     MBMGGGOM@2          .8OMBOJ   @5Uukv, .@uJ1NL   OEuUqv. iBuuUJS0OG1u25Fi  BM8ZFJjjuEBBO.
'         @YLjF:  i@YJFJ:  M1J15i  ZMY2k7   @51107      @BMG8GMBP           BM@q7i   B2Yu5L. .@Juuqv   EZJuSL  :@JJuJ:  j8YLUur     LZLL27
'         @Yvuu;  :@7YUL,  BJJjU:  0ELjS7   B2J2kv       7BOZOMG            @B7iLr   BYvvUv, .BuLukL   O0JYSv. :BjY1ji   BLJJ1;     rO7LuL
'         @777Li  iBrrL7:  MYvLLi  X0vJuv   @uJJS7       JB8OZMZ          ,G@8.:J;   MYr7vv,  @YYJkL   00vY2L. ,@uu2ur  .MJYuur     vOvvuY
'         B7irri  i@irr7:  Or77L:  qX77u7   OL7LYL     L@@88ZO8@Guvi.. .:0B@M@Frv7   B7rrL7: .BL7LUL   kFrrj7. ,BjvJv7   G7vvL;.    vO7vjj
'         @iiiri  :Ziir;:  Zr;77i  F5;7L7   Mrrrrr  :BMBBOOZ8ZOOB@@B@@@B@BMOM@1:77   Orir77, .BrrrYr   SUir77. ,Brr7vr  .qrir7r     LGirLL
'         Mr:;ii  :G:i;r:  Eiii7i  1j;r77   Or:::i XB@BMOMOOGGZOGOOMOMMMMMOMMB;i77   Oiii7r: .Mi:;7r   Xuii7r, :Orir77  .0i;r7i.    7qir7v
'         Oiiiii  :N::;i:  ki:i;i  jJi;r7   O::YSFBBMOMB@B@BMG8GGEOZOOMMBB@B@7:i7r   Oi:i;r, .Miii7;   Su:irr. ,Oiir7r  .qrrr77     iS;i77
'         qi:i:i  :q,::i:  S:iiii  J7::ir   O70BMBMMB@Bi 1irqM8GZ8GOM@B@BO,,u.:ir7   M::irr: .Mi:irr   1Y:iri, :Z;iri7  .Eirr7r.    iXir77
'         X::::i  :5,:::i  1::::r  u7,::7   ZkMOMO@B@EP  .  FMOZ8ZOM@2i    .F.::ir   8::iir: .B:::ri   uL,:i;, ,8iii;r  .Piirrr     r5:irr.
'         5:.:,r  :1.,,:i  1,,,:7  2r...:  7@@MMB@v.   1P. 7B@OOE8O@i      :U.,::r   M,::ii: .B:,::r   5v,::i: :Ei:i:7  .P:iirr.    i2,ii7
'         P,...i  :2..,:r  u,.,,u  Ui .:v:@B@BZkku     .u:0 .MMGG8BB       :1 .,,i   O..,:i: .B.,::i   uv.::i, ,0,:::r. ,k:::ir.    ru,:i;.
'         0,...r  :1 ..:L  2...,L  X,:jqB@MJM:   :      :i:7 uBOZM@Z       :u..,.i   M...:i: ,M..,:i   5v.,::: :P,,:.7. .X,:::i.    ru.::;.
'         Z....7  i1 ..:Y  u.   i  S1O@B@L  Z  ..i        i  :@88M@i       :u ,.,:  .M..,,i: .B..,::   Pv.,,:: :N.,,.7. ,F,,:,i.    rJ.,ii.
'         G,...Y  :1 ..,r  F   :7  kB@B@B   k. . i       uBL.qMOG@B        :u....i   M..,,:: ,M..,.:   q7..,:: :k..,.J. ,5.,,,:.    rj.,:i.
'         O....u  ;u    ,  q7uEBB12EYJ5Lr   q   L8       r@B@MOGOB;        :2 ...:   M....i: .M...,:   P7 ..:: :k ...u, .2....i.    rL..::.
'         0    v  ;5 .iu7,7OZGFu5  5        MLG@Gr       iBM8OG8O@         :7    :   O    .i .0    ,   Ni  ..: ,u    5. r7    :.    iv  .:.
'         M:  ,i  :0FPOB@q7OMOUi:  Z@GS7i   @8r          j@OOZ8GMB:        .GLjr:..ikZ:,77r,  Gii:.:   kL . ,,  F..  r::M7..,:r.    iL   .
'         B@JvPkJq8MOGG@v  @B@B@i  OB@B@Y               .@M8Z8Z88BBi       .B@B@B0kBB@B@B@O.  B@B@BZ   EB@B@O. .B@B@B@B@@@B@B@M     i@@@BM
'         G2S0MM@MZSkFSq.  BO0MMi  Z@EGM7               MBOZ8Z8G8OBB87     .@OGZ8MBMOEGE8BX.  @GZZ@5   P@8OBE  ,@OOOM8OGGZGZGM:     r@MM@O
'         B@MM0NFk1XP0q7   @Nq0Gi  8BqqMr   BXUUukL    .BBGGG8Z8Z8GMB@8r    BOq008M@OEPN0M2.  BOPEMF   FBZNBF. .BZq008GZPNP02i      i@N0O0
'         @qX512MOEFkSZE:  BNS0qi  NBk08v   @@MOBB@v   ,@MOZGZ8G8G88OM@@B.  @OENOOq70MENGM1.  @8ZE@2   2@E0Bk   BGE0qSMB@PqNMui     ,MZXOX
'         BX1Pui:iBNLU55,  @1U2Si  k8U5E7   BEkPNXj     @@8GEGE8Z8Z8Z88MB@7 8M0EO2   @Z00MU.  B8PZM5   5B0PM5.  OGqZ1:  kMSPqMu     .BPXZq
'         @uuujr  iMvLUU:  8uJuUi  10YUk7   @S21E7      ;BM8GG8ZGZGG8ZGGOM@5:1GNOj   BOX0O1.  @EPXOU   1@PqGS.  BNPNki  .Bk5PEL     :Mk10S
'         @uvuL7  :@vJuU,  EjJu5i  SqJukr   B5JUXL       iBOZGE8Z8ZOG8ZOGOOB5750Gu   @Nkk8u.  B05kZ2   SBSFZ5. .MPFqF7  .@115Nv     :M22SF
'         @jYJJr  i@LLuu:  0UYu2r  1EYu17   @UJuPL       .@88ZGGO8@MMOOG8GO8MP25Zv   BN1FN2.  @S12Zu   1M21k1. .M5251r  .M1u2SL     :OujS2
'         OuvuL7  :@vJu1:  Guuu5r  1PJJF7   MFj1PJ       ,BMG8G8OOr@B@BM8OEOGMZSPJ   @SUUXu.  B5Y2ku   F8UjFu. .MUJ2j7  .MjujFv     :MJjU1
'         OjLLYr  iBvvjj:  qjvJur  2PvjUv   OujjXJ       .@OGG8GBB  ,7ZB@88ZOO8USJ   B1LJuj.  @YLL1Y   SGvJuj. .BLLYJ7  .8JYuuv     :8uY1U
'         Zu7Lvv  :Mi7vL,  N77rLi  1277J7   OL77LL       .BMZ8ZOB0      F@G8ZOqLvJ   @L77Yv: .BLrvYL   q0r7Yv. .M7rv7v  .O7v7j7     :ZvYU2
'         87777v  :E;r77:  P7;rr;  u2i7v7   Mvrrvv        @MOZ8O@r       BOZOOM7r7   @v;7vY,  @7r7Y7   Sqir7v. .Mi;r7v  ,8iir77     :PrrLL
'         EririJ  :Zirr7:  Nri;7i  1urrvr   E7ir7L        MBG8ZMB       P@8O8BF:r7   @vr7vv: .B7i7Lv   SSrr77, ,Biir;v  .O:iir;     :X:;rv
'         XiiiiY  :k:i;r:  X;irrr  UUir77   Z7ir7Y        1MOGOB@      :@M8GMBi:r7   Bvi77v:  @7rrv7   FSirr7. .@irrrv  ,Gii;rr     iSiirr.
'         F;:iij  ,P:iir:  Piiir;  1uir7r   8v;77u       .ZMZOO@v      1@MZOBS.ir7   @7ir77: .Br:r77   S1iirr, .Mririv  .Oirr7r     :Pi;;7
'         kiiiiJ  :Sii;r:  k;i;rr  1Uirr7   M7rr7J     u@BBOOOBB       Z@8OOO::i;7   @v:ii7: .@i:irr   F1:iir, .M:iii7  ,Giirr7     iXiirr.
'         Si:iiu  :S:iir:  Xiiiri  Fjiirr   M7irrY   ;B@BMOOO@BN       BMOG@k.:iir   @r::i;: .B;:iir   Xu,:ii: .O::i:v  .O:i:ir     :P:iir
'         q::::v  :1::ii:  1:::ii  2Y::ir   M;::i7  YB@MMM@@@B2        BMG@GX.:::r   Br.::;: .@:::ii.  SU.::i, .M,:::7  ,Z::::;     ik::ii.
'         k:.:,v  :U.::::  S::::i  F7,::i   O:...: SB@M@@@OL          :@M@O Z:,::r   @;.::i: .@:,::i.  0u.:::, .O,,::v  .O.:::i     :X.::i
'         S,,,,v  :u,,::r  S:,::r  FL.::r   M. :;u@B@B@0r             GB@@  B.,::i   B;.:,i: .@,.::i.  ZF.:::, .M.,,:v  ,G,,::i     iS,:::.
'         5,.,.Y  :1.,,:i  X,,,:7  Ev.,:i   Oiu@B@B@BJ                BBB, .B..:,r   @i.,::i .B:.:,:  :Gi.,::, ,M..:,Y  .O.,,:i     ik.,:i.
'         S,...u  7J.,,:r  X,.,,7  0v ,,i   M0@MBB@r                 M@B2  .@..,:i   Br ,,i; .@,.,,..:r,.,:,:, ,M.,,,Y  ,O..:,;     iF.,::.
'         F,...i:ir....::  N...,i  Ev .,..:L.rBBM@                  8@M@7  .B....i   @i .,:r ,B:...........,:: ,O....F  ,O ...;.    ik .,:.
'         X         . .,i  G. ..;  MY . . .   SB@q                 v@@MB@.  @   .i   Br . :i  @i ..........,i. :B    j  :M  ..i.    7S  .:.
'         B;::::::::::iF:  @;::rv  SB;::::::::7@B8                 vB@B@B@87BLi;ru   @8:irYi   7irii:i:::ii:   .Bi.:i5  .@,..:Y     7B...r,
'         @@@B@BBMBMMOM;   .BMBO.   vBMZO8MOMO8N@@r                   ,7GB@@7jUJ5.    uuYuv     :u5UFFS11ur     :BBMB.   i@MMBr      qB8BX


'Frank Thomas' Big Hurt/ IPD No. 3591 / June, 1995 / 4 Players
'Â© Gottlieb
'VPX recreation by ninuzzu
'Resources from Farsight's The Pinball Arcade

Option Explicit
Randomize

' Thalamus 2019 March : Improved directional sounds
' !! NOTE : Table not verified yet !!

' Options
' Volume devided by - lower gets higher sound

Const VolDiv = 2000    ' Lower number, louder ballrolling/collition sound
Const VolCol = 10      ' Ball collition divider ( voldiv/volcol )

' The rest of the values are multipliers
'
'  .5 = lower volume
' 1.5 = higher volume

Const VolBump   = 2    ' Bumpers volume.
Const VolRol    = 1    ' Rollovers volume.
Const VolGates  = 1    ' Gates volume.
Const VolMetal  = 1    ' Metals volume.
Const VolRB     = 1    ' Rubber bands volume.
Const VolRH     = 1    ' Rubber hits volume.
Const VolPo     = 1    ' Rubber posts volume.
Const VolPi     = 1    ' Rubber pins volume.
Const VolPlast  = 1    ' Plastics volume.
Const VolTarg   = 1    ' Targets volume.
Const VolWood   = 1    ' Woods volume.
Const VolKick   = 1    ' Kicker volume.
Const VolSpin   = 1.5  ' Spinners volume.
Const VolFlip   = 1    ' Flipper volume.


Const BallSize = 52
Const BallMass = 1.2
Const UseVPMDMD = 1

On Error Resume Next
ExecuteGlobal GetTextFile("controller.vbs")
If Err Then MsgBox "You need the controller.vbs in order to run this table, available in the vp10 package"
On Error Goto 0

Dim DesktopMode:DesktopMode = Table1.ShowDT
'Dim UseVPMDMD:UseVPMDMD = DesktopMode

Const cGameName= "bighurt"

LoadVPM "01560000", "gts3.VBS", 3.26

'********************
'Standard definitions
'********************
Const UseSolenoids  = 1
Const UseLamps      = 1
Const UseSync   = 1
Const UseGI     = 0

' Standard Sounds
Const SSolenoidOn = "fx_Solenoid"
Const SSolenoidOff = ""
Const SCoin = "fx_Coin"

' Gottlieb System 3 Specific
Const swStartButton = 4

'******************************************************
'         Initialize the table
'******************************************************

Dim bsTrough,bsTroughEnt, bsUpSaucer,bsLVUK, bsRVUK, dtDrop, plungerIM, xx

Sub Table1_Init

' Thalamus : Was missing 'vpminit me'
  vpminit me

    With Controller
    .GameName = cGameName
    If Err Then MsgBox "Can't start Game " & cGameName & vbNewLine & Err.Description:Exit Sub
    .SplashInfoLine = "Big Hurt (Gottlieb 1995)"
    .HandleKeyboard = 0
    .ShowTitle = 0
    .ShowDMDOnly = 1
    .ShowFrame = 0
    .HandleMechanics = 0
    .dip(0) = &H00
    .Hidden = DesktopMode
    On Error Resume Next
    .Run GetPlayerHWnd
    If Err Then MsgBox Err.Description
    On Error Goto 0
    End With

    '** Main Timer init
  PinMAMETimer.Interval = PinMAMEInterval
  PinMAMETimer.Enabled = 1

    '** Nudging
  vpmNudge.TiltSwitch = 151
  vpmNudge.Sensitivity = 3
  vpmNudge.TiltObj = Array(sw10, sw11, sw12, sw13)

  '** Right VUK
    Set bsRVUK = new cvpmSaucer
    With bsRVUK
        .InitExitVariance 3,4
        .InitKicker Sw21, 21, 0, 65, 1.56
        .InitSounds "fx_kicker_catch", SoundFX("fx_mine_popper",DOFContactors), SoundFX("fx_mine_popper",DOFContactors)
        .CreateEvents "bsRVUK", sw21
    End With

  '** RightUp Saucer
    Set bsUpSaucer = new cvpmSaucer
    With bsUpSaucer
        .InitExitVariance 3,4
        .InitKicker Sw22, 22, 190, 6, 0
        .InitSounds "fx_saucerHit", SoundFX("LeftEject",DOFContactors), SoundFX("ExitSandman",DOFContactors)
        .CreateEvents "bsUpSaucer", sw22
    End With

  '** Left VUK
    Set bsLVUK = new cvpmSaucer
    With bsLVUK
        .InitExitVariance 3,4
        .InitKicker Sw110, 110, 0, 45, 1.56
        .InitSounds "fx_kicker_catch", SoundFX(SSolenoidOn,DOFContactors), SoundFX("ExitDoc",DOFContactors)
        .CreateEvents "bsLVUK", Sw110
    End With

    '** DropTargets Bank
    Set dtDrop = new cvpmDropTarget
  With dtDrop
    .InitDrop Array(sw7,sw17,sw27),Array(7,17,27)
    .Initsnd SoundFX("CenterDropBankDown",DOFDropTargets), SoundFX("CenterDropBankUp",DOFDropTargets)
  End With

  '** Impulse Plunger
    Set plungerIM = New cvpmImpulseP
    With plungerIM
        .InitImpulseP sw20, 55, 0.65
        .Switch 20
        .Random 1.5
        .InitExitSnd SoundFX("AutoPlunger",DOFContactors), SoundFX(SSolenoidOn,DOFContactors)
        .CreateEvents "plungerIM"
    End With

  '** Captive Ball
  CapBall.CreateSizedBallWithMass Ballsize/2, BallMass:CapBall.kick 0,0:CapBall.enabled=0

  '** Other Suff
  InitRolling:InitGlove:InitLamps:InitTrough
  SideRails.visible=DesktopMode
End Sub

'******************************************************
'         Solenoids Map
'******************************************************

SolCallback(1)  = "vpmSolSound SoundFX(""LeftJet"",DOFContactors),"     '1 - Left Bumper
SolCallback(2)  = "vpmSolSound SoundFX(""RightJet"",DOFContactors),"    '2 - Right Bumper
SolCallback(3)  = "vpmSolSound SoundFX(""LeftSling"",DOFContactors),"   '3 - Left Slingshot
SolCallback(4)  = "vpmSolSound SoundFX(""RightSling"",DOFContactors),"    '4 - Right Slingshot
SolCallback(5)  = "AutoPlungerIM"                     '5 - Autoplunger
SolCallback(6)  = "SolRightVUK"                       '6 - Bottom Right Upkicker
SolCallback(7)  = "SolLeftVUK"                        '7 - Top Left upkicker
SolCallback(8)  = "dtDrop.SolDropUp"                    '8 - Drop Reset
SolCallback(9)  = "dtDrop.SolHit 1,"                    '9 - Left Drop Target Down
SolCallback(10) = "dtDrop.SolHit 2,"                    '10 - Center Drop Target Down
SolCallback(11) = "dtDrop.SolHit 3,"                    '11 - Right Drop Target Down
SolCallback(12) = "CenterRampLift"                      '12 - Center Ramp Lift
SolCallback(13) = "bsUpSaucer.SolOut"                   '13 - Top Right Saucer
SolCallback(14) = "ShooterRampLift"                     '14 - Shooter Ramp Lift
SolCallback(16) = "TopPostMove"                       '16 - Top Right Post
SolCallback(17) = "vpmSolGate TopGate,SoundFX(""DiverterOn"",DOFContactors)," '17 - Top ControlGate
SolCallback(18) = "setlamp 148,"                          '18 - Flasher:LeftDome (Apron)
SolCallback(19) = "setlamp 149,"                          '19 - Flasher:RightDome (Apron)
SolCallback(20) = "setlamp 150,"                          '20 - Flasher:HomeRun (Inserts)
SolCallback(21) = "setlamp 151,"                          '21 - Flasher:GrandSlam (Inserts)
SolCallback(22) = "setlamp 152,"                          '22 - Flasher:PopBumpersArea
SolCallback(25) = "GloveMotor"                        '25 - Glove Motor
SolCallback(26) = "GIRelay"                         '26 - LightBox Relay
SolCallback(27) = ""                            '27 - Ticket/Coin Meter
SolCallback(28) = "ReleaseBall"                       '28 - Ball Release
SolCallback(29) = "SolOuthole"                        '29 - Outhole.
SolCallback(30) = "vpmSolSound SoundFX(""fx_Knocker"",DOFKnocker),"     '30 - Knocker
SolCallback(31) = "TiltRelay"                       '31 - Tilt Relay
SolCallback(32) = "vpmNudge.SolGameOn"                    '32 - Game Over Relay

SolCallback(sLRFlipper) = "SolRFlipper"
SolCallback(sLLFlipper) = "SolLFlipper"

'******************************************************
'     TROUGH BASED ON FOZZY'S
'******************************************************
Dim BIP:BIP=0   'no ball in play
'Init Trough
Sub InitTrough
  Slot1.CreateSizedballWithMass Ballsize/2,Ballmass
  Slot2.CreateSizedballWithMass Ballsize/2,Ballmass
  Slot3.CreateSizedballWithMass Ballsize/2,Ballmass
  Drain.CreateSizedballWithMass Ballsize/2,Ballmass
  Controller.Switch(14) = 1
  Controller.Switch(24) = 1
End Sub

'Handle Trough
Sub Slot3_UnHit():UpdateTrough:End Sub
Sub Slot2_UnHit():UpdateTrough:End Sub
Sub Slot1_Hit():Controller.Switch(14) = 1:UpdateTrough:End Sub
Sub Slot1_UnHit():Controller.Switch(14) = 0:UpdateTrough:BIP=BIP+1:End Sub

Sub UpdateTrough()
  Slot1.TimerInterval = 300
  Slot1.TimerEnabled = 1
End Sub

Sub Slot1_Timer()
  If Slot1.BallCntOver = 0 Then Slot2.kick 60, 9
  If Slot2.BallCntOver = 0 Then Slot3.kick 60, 9
  Me.TimerEnabled = 0
End Sub

'Drain & Release
Sub Drain_Hit()
  PlaySoundAtVol "fx_drain", Drain, 1
  UpdateTrough:BIP=BIP-1
  Controller.Switch(24) = 1
End Sub

Sub Drain_UnHit()
  Controller.Switch(24) = 0
End Sub

Sub SolOuthole(enabled)
  If enabled Then
    Drain.kick 60,20
    PlaySound SoundFX(SSolenoidOn,DOFContactors)
  End If
End Sub

Sub ReleaseBall(enabled)
  If enabled Then
    PlaySoundAtVol SoundFX("BallRelease",DOFContactors), Plunger, 1
    Slot1.kick 60, 9
    UpdateTrough
  End If
End Sub

'******************************************************
'         Solenoids Routines
'******************************************************
'**VUKs
Sub SolLeftVUK(enabled)
  If Enabled Then
    LeftHole.Enabled=0
    sw110.timerinterval=500:sw110.timerEnabled=1
    bsLVUK.ExitSol_On
    sw110W.IsDropped=0
  End If
End Sub

Sub SolRightVUK(enabled)
  If Enabled Then
    RightHole.Enabled=0
    sw21.timerinterval=500:sw21.timerEnabled=1
    bsRVUK.ExitSol_On
  End If
End Sub

sub sw21_timer:me.timerEnabled=0:RightHole.Enabled=1:end Sub
sub sw110_timer:me.timerEnabled=0:LeftHole.Enabled=1:sw110W.IsDropped=1:end Sub

'**AutoPlunger
Sub AutoPlungerIM(enabled)
  If Enabled Then PlungerIM.AutoFire
end sub

'**Center Ramp up/down
Sub CenterRampLift(Enabled)
If  Enabled Then
  HomeRunRamp.collidable=1
  CenterRamp.RotX=-8:CenterRampDecal.RotX=-8
  PlaySound SoundFX("DiverterOn",DOFContactors)
Else
  HomeRunRamp.collidable=0
  CenterRamp.RotX=0:CenterRampDecal.RotX=0
  PlaySound SoundFX("DiverterOff",DOFContactors)
End If
End Sub

'**Shooterlane ramp up/down
Sub ShooterRampLift(enabled)
    if enabled then
    DiverterRamp.collidable = 0
    ShootRamp.RotX=9:ShootRampDecal.RotX=9:ShootRampFlap.RotX=9
        Playsound SoundFX("IdolReleaseOn",DOFContactors)
  else
    DiverterRamp.collidable = 1
    ShootRamp.RotX=0:ShootRampDecal.RotX=0:ShootRampFlap.RotX=0
        Playsound SoundFX("IdolReleaseOff",DOFContactors)
  end if
End Sub

'**Top Right Post Up/Down
Sub TopPostMove(Enabled)
  If Enabled Then
    DropPost.IsDropped=1:TopPost.Z=-60:Playsound SoundFX("TopPostDown",DOFContactors)
  Else
    DropPost.IsDropped=0:TopPost.Z=0:Playsound SoundFX("TopPostUp",DOFContactors)
  End If
End Sub

'**Flippers
Sub SolLFlipper(Enabled)
    If Enabled Then
        PlaySoundAtVol SoundFX("fx_flipperupboth", DOFFlippers), LeftFlipper, VolFlip
        PlaySoundAtVol "fx_flipperupboth", LeftFlipper1, VolFlip
        LeftFlipper.RotateToEnd
        LeftFlipper1.RotateToEnd
    Else
        PlaySoundAtVol SoundFX("fx_flipperdown", DOFFlippers), LeftFlipper, VolFlip
        PlaySoundAtVol "fx_flipperdown", LeftFlipper1, VolFlip
        LeftFlipper.RotateToStart
        LeftFlipper1.RotateToStart
    End If
End Sub

Sub SolRFlipper(Enabled)
    If Enabled Then
        PlaySoundAtVol SoundFX("fx_flipperup", DOFFlippers), RightFlipper, VolFlip
        RightFlipper.RotateToEnd
    Else
        PlaySoundAtVol SoundFX("fx_flipperdown", DOFFlippers), RightFlipper, VolFlip
        RightFlipper.RotateToStart
    End If
End Sub

'**Glove Motorized Toy
Dim Gloveposition, Glovedirection, XDir,ZRot

Sub GloveMotor(enabled):If Enabled Then PlaySound SoundFX("GloveMotor",DOFGear),-1,0.5:MoveGlove.enabled=1:Else StopSound "GloveMotor":MoveGlove.enabled=0:End If:End Sub

Sub InitGlove
  XDir=1:ZRot=0
  For each xx in Gloves:xx.collidable=0:next
  Gloves(12).collidable=1
  HomeRunRamp.collidable=0:sw110W.IsDropped=1
End Sub

Sub MoveGlove_Timer
  If ZRot>25 Then XDir=-1
  If ZRot<-25 Then XDir=1
  ZRot=ZRot+.65* XDir
  GloveToy.rotz=ZRot:GloveAssy.rotz=ZRot:GlovePost.rotz=ZRot
  For each xx in Gloves:xx.collidable=0:next
  Gloves(Int(ABS((24-ZRot)/2))).collidable=1
End Sub

'******************************************************
'             Keys
'******************************************************

Sub Table1_KeyDown(ByVal keycode)
  If keycode = LeftTiltKey Then Nudge 90, 5:PlaySound SoundFX("fx_nudge",0)
  If keycode = RightTiltKey Then Nudge 270, 5:PlaySound SoundFX("fx_nudge",0)
  If keycode = CenterTiltKey Then Nudge 0, 6:PlaySound SoundFX("fx_nudge",0)
  If keycode = PlungerKey Then Plunger.PullBack:PlaySoundAtVol "fx_plungerpull", Plunger, 1
  ' If keycode = PlungerKey Then Plunger.PullBack:PlaySound "fx_plungerpull",0,1,0.25,0.25
  If keycode = LeftMagnaSave Then Controller.Switch(5) = 1    'Tournament
  If keycode = RightMagnaSave Then Controller.Switch(6) = 1   'FrontDoor (Service)
    If vpmKeyDown(keycode) Then Exit Sub
End Sub

Sub Table1_KeyUp(ByVal keycode)
  If keycode = PlungerKey Then Plunger.Fire:StopSound "plungerpull":PlaySoundAtVol "fx_plunger", Plunger, 1
  If keycode = LeftMagnaSave Then Controller.Switch(5) = 0    'Tournament
  If keycode = RightMagnaSave Then Controller.Switch(6) = 0   'FrontDoor (Service)
  if vpmKeyUp(keycode) Then Exit Sub
End Sub

Sub Table1_Paused:Controller.Pause = True:End Sub
Sub Table1_unPaused:Controller.Pause = False:End Sub
Sub Table1_exit():Controller.Pause = False:Controller.Stop:End Sub

'******************************************************
'             Switches
'******************************************************
'drop targets
Sub sw7_dropped() : vpmTimer.PulseSw 7 : End Sub
Sub sw17_dropped() : vpmTimer.PulseSw 17 : End Sub
Sub sw27_dropped() : vpmTimer.PulseSw 27 : End Sub

Sub sw7_hit:PlaySoundAtVol SoundFX("DropTargetHit",0), ActiveBall, 1:End Sub
Sub sw17_hit:PlaySoundAtVol SoundFX("DropTargetHit",0), ActiveBall, 1:End Sub
Sub sw27_hit:PlaySoundAtVol SoundFX("DropTargetHit",0), ActiveBall, 1:End Sub

'bumpers
Sub sw10_Hit() : vpmTimer.PulseSw 10 : End Sub
Sub sw11_Hit() : vpmTimer.PulseSw 11 : End Sub

'slings
Dim LStep,RStep
Sub sw12_Slingshot
  vpmTimer.PulseSw 12
  LSling.Visible = 0
  LSling1.Visible = 1
  sling1.TransZ = -20
  LStep = 0
  Me.TimerInterval = 20
  Me.TimerEnabled = 1
End Sub

Sub sw12_Timer
    Select Case LStep
        Case 3:LSLing1.Visible = 0:LSLing2.Visible = 1:sling1.TransZ = -10
        Case 4:LSLing2.Visible = 0:LSLing.Visible = 1:sling1.TransZ = 0:Me.TimerEnabled = 0
    End Select
    LStep = LStep + 1
End Sub

Sub sw13_Slingshot
  vpmTimer.PulseSw 13
  RSling.Visible = 0
  RSling1.Visible = 1
  sling2.TransZ = -20
  RStep = 0
  Me.TimerInterval = 20
  Me.TimerEnabled = 1
End Sub

Sub sw13_Timer
    Select Case RStep
        Case 3:RSLing1.Visible = 0:RSLing2.Visible = 1:sling2.TransZ = -10
        Case 4:RSLing2.Visible = 0:RSLing.Visible = 1:sling2.TransZ = 0:Me.TimerEnabled = 0
    End Select
    RStep = RStep + 1
End Sub

'Left Orbit Opto
Sub sw80_Hit(): vpmTimer.PulseSw 80: End Sub
'Right Orbit Opto
Sub sw81_Hit(): vpmTimer.PulseSw 81: End Sub
'LeftRamp Opto
Sub sw90_Hit(): vpmTimer.PulseSw 90: End Sub
'RightRamp Opto
Sub sw91_Hit(): vpmTimer.PulseSw 91: End Sub
'Left ScoreBoard
Sub sw87_Hit(): vpmTimer.PulseSw 87: PlaysoundAtVol "fx_sensor", ActiveBall, VolRol: End Sub
'RightScoreBoard
Sub sw97_Hit(): vpmTimer.PulseSw 97 :PlaysoundAtVol "fx_sensor", ActiveBall,  VolRol: End Sub
'LeftOutLane
Sub sw85_Hit(): Controller.Switch(85) = 1 : PlaysoundAtVol "fx_sensor", ActiveBall,  VolRol: End Sub
Sub sw85_UnHit(): Controller.Switch(85) = 0 : End Sub
'RightOutLane
Sub sw86_Hit()  : Controller.Switch(86) = 1 : PlaysoundAtVol "fx_sensor", ActiveBall,  VolRol: End Sub
Sub sw86_UnHit(): Controller.Switch(86) = 0 : End Sub
'LeftInlane
Sub sw95_Hit()  : Controller.Switch(95) = 1 : PlaysoundAtVol "fx_sensor", ActiveBall,  VolRol: End Sub
Sub sw95_UnHit()  : Controller.Switch(95) = 0 : End Sub
'RightInlane
Sub sw96_Hit()  : Controller.Switch(96) = 1 : PlaysoundAtVol "fx_sensor", ActiveBall,  VolRol: End Sub
Sub sw96_UnHit()  : Controller.Switch(96) = 0 : End Sub
'Homerun Opto (under playfield)
Sub sw100_Hit():vpmTimer.PulseSw 100:End Sub
'Scoop Ramp Opto
Sub sw101_Hit():vpmTimer.PulseSw 101:End Sub

'standup's
Sub sw105_Hit(): vpmTimer.PulseSw 105: PlaysoundAtVol SoundFX("fx_target",DOFTargets), ActiveBall, VolTarg: End Sub
Sub sw115_Hit(): vpmTimer.PulseSw 115: PlaysoundAtVol SoundFX("fx_target",DOFTargets), ActiveBall, VolTarg: End Sub

'RightTop rollover (bumpers area)
Sub sw106_Hit()   : Controller.Switch(106) = 1 : PlaysoundAtVol "fx_sensor", ActiveBall, VolRol: End Sub
Sub sw106_UnHit() : Controller.Switch(106) = 0 : End Sub

'CaptiveBall rollover
Sub sw107_Hit()   : Controller.Switch(107) = 1 : PlaysoundAtVol "fx_sensor", ActiveBall, VolRol:End Sub
Sub sw107_UnHit() : Controller.Switch(107) = 0 : End Sub

'Right Side Rollover
Sub sw116_Hit()   : Controller.Switch(116) = 1 : PlaysoundAtVol "fx_sensor", ActiveBall, VolRol: End Sub
Sub sw116_UnHit() : Controller.Switch(116) = 0 : End Sub

'Glove Collision events
Sub Gloves_Hit(idx)
  Dim BallSpeed
  BallSpeed = SQR((ActiveBall.velx ^2) + (ActiveBall.vely ^2))
  If ActiveBall.Z > 80 Then
    vpmTimer.PulseSw 23
    If BallSpeed > 15 Then
      vpmTimer.PulseSw 117      'Glove all the way
      PlaySound "fx_rubber", 0, 10*Vol(ActiveBall), Pan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
    Else
      RandomSoundRubber()
    End If
  End If
End Sub

'******************************************************
'       GENERAL ILLUMINATION
'******************************************************

Sub GIRelay(enabled)
  If Enabled Then
    for each xx in GI:xx.State=0:Next
'     for each xx in GIbulbs:xx.intensityscale=0:Next
    Table1.ColorGradeImage = "ColorGrade_1"
    Playsound "fx_relay_off"
  Else
    for each xx in GI:xx.State=1:Next
'     for each xx in GIbulbs:xx.intensityscale=1:Next
    Table1.ColorGradeImage = "ColorGrade_8"
    Playsound "fx_relay_on"
  End If
End Sub

Sub TiltRelay(enabled)
  If Enabled Then
    for each xx in GI:xx.State=0:Next
'     for each xx in GIbulbs:xx.intensityscale=0:Next
    Table1.ColorGradeImage = "ColorGrade_1"
    Playsound "fx_relay_off"
  Else
    for each xx in GI:xx.State=1:Next
'     for each xx in GIbulbs:xx.intensityscale=1:Next
    Table1.ColorGradeImage = "ColorGrade_8"
    Playsound "fx_relay_on"
  End If
End Sub

' *********************************************************************
'           Lighting
' *********************************************************************

Dim FadingLevel(200), LampState(200)

Sub InitLamps
  On Error Resume Next
  Dim i
  For i=0 To 97: Execute "Lights(" & i & ")  = Array (Light" & i & ",Light" & i & "a)": Next
  For i=0 to 200:LampState(i) = 0:FadingLevel(i) = 0:Next
  LampTimer.Interval = 10:LampTimer.Enabled = 1
End Sub

Sub LampTimer_Timer()
  AddBurst 42, L42
  AddBurst 43, L43
  AddBurst 44, L44
  AddBurst 45, L45
  AddBurst 46, L46
  AddBurst 47, L47
  AddBurst 91, L91b
  AddBurst 92, L92b
  AddBurst 93, L93b
  'flashers
  FadeLamp 148, F18   'LeftDome (Apron)
  FadeLamp 148, F18a    'LeftDome (Apron)
  FadeLamp 148, F18b    'LeftDome (Apron)
  FadeLamp 149, F19   'RightDome (Apron)
  FadeLamp 149, F19a    'RightDome (Apron)
  FadeLamp 149, F19b    'RightDome (Apron)
  FadeLamp 150, F20   'HomeRun Insert
  FadeLamp 151, F21   'GrandSlam Insert
  FadeLamp 152, F22   'PopBumpers Insert
'aux drv board
  AddBurst 120, F1    'Left Ramp #1
  AddBurst 121, F2    'Left Ramp #2
  AddBurst 122, F3    'Left Ramp #3
  AddBurst 122, F3a   'Left Ramp #3
  AddBurst 122, F3b   'Left Ramp #3
  AddBurst 123, F4    'Right Ramp #1
  AddBurst 124, F5    'Right Ramp #2
  AddBurst 125, F6    'Right Ramp #3
  AddBurst 125, F6a   'Right Ramp #3
  AddBurst 125, F6b   'Right Ramp #3
  AddBurst 126, F7    'Left Scoop
  AddBurst 127, F8    'Right VUK Dome
  AddBurst 127, F8a   'Right VUK Dome
  AddBurst 127, F8b   'Right VUK Dome
  AddBurst 127, F8c   'Right VUK Dome
End Sub

Sub SetLamp(nr, enabled)
        LampState(nr) = enabled
End Sub

Sub SetModLamp(nr, value)
    If value > 0 Then
    LampState(nr) = 1
  Else
    LampState(nr) = 0
  End If
  FadingLevel(nr) = value
End Sub

Sub FadeLamp(nr, object)
  If TypeName(object) = "Light" Then
    Object.State = LampState(nr)
  End If
  If TypeName(object) = "Flasher" Then
    Object.visible = LampState(nr)
  End If
End Sub

Sub FadeModLamp(nr, object, factor)
  Object.IntensityScale = FadingLevel(nr) * factor/255
  If TypeName(object) = "Light" Then
    Object.State = LampState(nr)
  End If
  If TypeName(object) = "Flasher" Then
    Object.visible = LampState(nr)
  End If
End Sub

Sub AddBurst(nr,Object)
  If TypeName(object) = "Light" Then
    object.state = Controller.Lamp(nr)
  End If
  If TypeName(object) = "Flasher" Then
    Object.visible = Controller.Lamp(nr)
  End If

End Sub

' *******************************************************************************************************
' Positional Sound Playback Functions by DJRobX and Rothbauerw
' PlaySound sound, 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 0, 1, AudioFade(ActiveBall)
' *******************************************************************************************************

' Play a sound, depending on the X,Y position of the table element (especially cool for surround speaker setups, otherwise stereo panning only)
' parameters (defaults): loopcount (1), volume (1), randompitch (0), pitch (0), useexisting (0), restart (1))
' Note that this will not work (currently) for walls/slingshots as these do not feature a simple, single X,Y position

Sub PlayXYSound(soundname, tableobj, loopcount, volume, randompitch, pitch, useexisting, restart)
  PlaySound soundname, loopcount, volume, AudioPan(tableobj), randompitch, pitch, useexisting, restart, AudioFade(tableobj)
End Sub

' Set position as table object (Use object or light but NOT wall) and Vol to 1

Sub PlaySoundAt(soundname, tableobj)
  PlaySound soundname, 1, 1, AudioPan(tableobj), 0,0,0, 1, AudioFade(tableobj)
End Sub

'Set all as per ball position & speed.

Sub PlaySoundAtBall(soundname)
  PlaySoundAt soundname, ActiveBall
End Sub

'Set position as table object and Vol manually.

Sub PlaySoundAtVol(sound, tableobj, Volume)
  PlaySound sound, 1, Volume, AudioPan(tableobj), 0,0,0, 1, AudioFade(tableobj)
End Sub

'Set all as per ball position & speed, but Vol Multiplier may be used eg; PlaySoundAtBallVol "sound",3

Sub PlaySoundAtBallVol(sound, VolMult)
  PlaySound sound, 0, Vol(ActiveBall) * VolMult, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 0, 1, AudioFade(ActiveBall)
End Sub

'Set position as bumperX and Vol manually.

Sub PlaySoundAtBumperVol(sound, tableobj, Vol)
  PlaySound sound, 1, Vol, AudioPan(tableobj), 0,0,1, 1, AudioFade(tableobj)
End Sub

Sub PlaySoundAtBOTBallZ(sound, BOT)
    PlaySound sound, 0, ABS(BOT.velz)/17, Pan(BOT), 0, Pitch(BOT), 1, 0, AudioFade(BOT)
End Sub

'*********************************************************************
'                     Supporting Ball & Sound Functions
'*********************************************************************

Function RndNum(min, max)
    RndNum = Int(Rnd() * (max-min + 1) ) + min ' Sets a random number between min and max
End Function

Function AudioFade(tableobj) ' Fades between front and back of the table (for surround systems or 2x2 speakers, etc), depending on the Y position on the table. "table1" is the name of the table
  Dim tmp
  On Error Resume Next
  tmp = tableobj.y * 2 / table1.height-1
  If tmp > 0 Then
    AudioFade = Csng(tmp ^10)
  Else
    AudioFade = Csng(-((- tmp) ^10) )
  End If
End Function

Function AudioPan(tableobj) ' Calculates the pan for a tableobj based on the X position on the table. "table1" is the name of the table
  Dim tmp
  On Error Resume Next
  tmp = tableobj.x * 2 / table1.width-1
  If tmp > 0 Then
    AudioPan = Csng(tmp ^10)
  Else
    AudioPan = Csng(-((- tmp) ^10) )
  End If
End Function

Function Pan(ball) ' Calculates the pan for a ball based on the X position on the table. "table1" is the name of the table
  Dim tmp
  On Error Resume Next
  tmp = ball.x * 2 / table1.width-1
  If tmp > 0 Then
    Pan = Csng(tmp ^10)
  Else
    Pan = Csng(-((- tmp) ^10) )
  End If
End Function

Function Vol(ball) ' Calculates the Volume of the sound based on the ball speed
  Vol = Csng(BallVel(ball) ^2 / VolDiv)
End Function

Function Pitch(ball) ' Calculates the pitch of the sound based on the ball speed
  Pitch = BallVel(ball) * 20
End Function

Function BallVel(ball) 'Calculates the ball speed
  BallVel = INT(SQR((ball.VelX ^2) + (ball.VelY ^2) ) )
End Function

Function BallVelZ(ball) 'Calculates the ball speed in the -Z
    BallVelZ = INT((ball.VelZ) * -1 )
End Function

Function VolZ(ball) ' Calculates the Volume of the sound based on the ball speed in the Z
    VolZ = Csng(BallVelZ(ball) ^2 / 200)*1.2
End Function

'*** Determines if a Points (px,py) is inside a 4 point polygon A-D in Clockwise/CCW order

Function InRect(px,py,ax,ay,bx,by,cx,cy,dx,dy)
  Dim AB, BC, CD, DA
  AB = (bx*py) - (by*px) - (ax*py) + (ay*px) + (ax*by) - (ay*bx)
  BC = (cx*py) - (cy*px) - (bx*py) + (by*px) + (bx*cy) - (by*cx)
  CD = (dx*py) - (dy*px) - (cx*py) + (cy*px) + (cx*dy) - (cy*dx)
  DA = (ax*py) - (ay*px) - (dx*py) + (dy*px) + (dx*ay) - (dy*ax)

  If (AB <= 0 AND BC <=0 AND CD <= 0 AND DA <= 0) Or (AB >= 0 AND BC >=0 AND CD >= 0 AND DA >= 0) Then
    InRect = True
  Else
    InRect = False
  End If
End Function


' *********************************************************************
'             Other Sound FX
' *********************************************************************
'Ball Collision
Sub OnBallBallCollision(ball1, ball2, velocity)
  PlaySound("fx_collide"), 0, Csng(velocity) ^2 / (VolDiv/VolCol), Pan(ball1), 0, Pitch(ball1), 0, 0, AudioFade(ActiveBall)
End Sub

'Gates Collision
Sub Gate3_hit():PlaysoundAtVol "fx_gate", ActiveBall, 1:Me.TimerInterval=400:Me.TimerEnabled=1:End Sub
Sub Gate3_Timer(): Me.TimerEnabled=0 : PlaySoundAtVol "fx_balldrop" , LFGuide, 1: End Sub
Sub TopGate_hit():PlaysoundAtVol "fx_gate4", ActiveBall, 1:End Sub
Sub Gate2_hit():PlaysoundAtVol "fx_gate4", ActiveBall, 1:End Sub

'Holes Collision
Sub LeftHole_hit:RandomSoundHole:End Sub
Sub RightHole_hit:RandomSoundHole:End Sub
Sub CenterHole_hit:RandomSoundHole:End Sub
Sub RightCenterHole_hit:RandomSoundHole:End Sub

'Flippers Collision
Sub LeftFlipper_Collide(parm):RandomSoundFlipper:End Sub
Sub LeftFlipper1_Collide(parm):RandomSoundFlipper:End Sub
Sub Rightflipper_Collide(parm):RandomSoundFlipper:End Sub

'Rubber Posts Collision
Sub Posts_Hit(idx)
  dim finalspeed
    finalspeed=SQR((activeball.velx ^2) + (activeball.vely ^2))
  If finalspeed > 20 then
    PlaySound "fx_rubber", 0, 10*Vol(ActiveBall), Pan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
  End if
  If finalspeed >= 6 AND finalspeed <= 20 then
    RandomSoundRubber()
  End If
End Sub

'Rubber Collision
Sub Rubbers_Hit(idx)
  dim finalspeed
    finalspeed=SQR((activeball.velx ^2) + (activeball.vely ^2))
  If finalspeed > 20 then
    PlaySound "fx_rubber", 0, 10*Vol(ActiveBall), Pan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
  End if
  If finalspeed >= 6 AND finalspeed <= 20 then
    RandomSoundRubber()
  End If
End Sub

Sub RandomSoundRubber()
  Select Case RndNum(1,3)
    Case 1 : PlaySound "fx_rubber_hit_1", 0, 10*Vol(ActiveBall), Pan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
    Case 2 : PlaySound "fx_rubber_hit_2", 0, 10*Vol(ActiveBall), Pan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
    Case 3 : PlaySound "fx_rubber_hit_3", 0, 10*Vol(ActiveBall), Pan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
  End Select
End Sub

Sub RandomSoundFlipper()
  Select Case RndNum(1,3)
    Case 1 : PlaySound "fx_flip_hit_1", 0, 20*Vol(ActiveBall), Pan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
    Case 2 : PlaySound "fx_flip_hit_2", 0, 20*Vol(ActiveBall), Pan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
    Case 3 : PlaySound "fx_flip_hit_3", 0, 20*Vol(ActiveBall), Pan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
  End Select
End Sub

Sub RandomSoundHole()
  Select Case RndNum(1,3)
    Case 1 : PlaySound "fx_hole1"
    Case 2 : PlaySound "fx_hole2"
    Case 3 : PlaySound "fx_hole3"
  End Select
End Sub

' *********************************************************************
'           Ball Drop & Ramp Sounds
' *********************************************************************
'shooter ramp
Sub ShooterStart_Hit():StopSound "fx_launchball":If ActiveBall.VelY < 0 Then PlaySoundAtVol "fx_launchball", ActiveBall, 1:End If:End Sub 'ball is going up
Sub ShooterEnd_Hit:If ActiveBall.Z > 30  Then Me.TimerInterval=100:Me.TimerEnabled=1:End If:End Sub           'ball is flying
Sub ShooterEnd_Timer(): Me.TimerEnabled=0 : PlaySound "fx_balldrop",0, 0.5 : End Sub
Sub SREnter_Hit():PlaySoundAtVol "fx_wireramp" , ActiveBall, 1: End Sub
Sub SRExit_Hit:StopSound "fx_wireramp" : PlaysoundAtVol "fx_wireramp_exit", ActiveBall, 1:Me.TimerInterval=100:Me.TimerEnabled=1:End Sub
Sub SRExit_Timer(): Me.TimerEnabled=0 : PlaySound "fx_balldrop" : End Sub

'homerun ramp
Sub HHREnter_Hit():If ActiveBall.VelY < 0 Then PlaySoundAtVol "fx_lrenter", ActiveBall, 1:End If:End Sub      'ball is going up
Sub HRREnter_UnHit():If ActiveBall.VelY > 0 Then StopSound "fx_lrenter":End If:End Sub    'ball is going down
Sub HRRDrop_Hit():PlaySound "fx_balldrop" : End Sub

'center ramp
Sub CREnter_Hit():If ActiveBall.VelY < 0 Then PlaySoundAtVol "fx_lrenter", ActiveBall, 1:End If:End Sub     'ball is going up
Sub CREnter_UnHit():If ActiveBall.VelY > 0 Then StopSound "fx_lrenter":End If:End Sub   'ball is going down
Sub CRail_Hit:StopSound "fx_lrenter" : PlaySoundAtVol "fx_wireramp" , ActiveBall, 1:End Sub
Sub CRExit_Hit:StopSound "fx_wireramp" :PlaysoundAtVol "fx_wireramp_exit", ActiveBall, 1: Me.TimerInterval=100:Me.TimerEnabled=1:End Sub
Sub CRExit_Timer(): Me.TimerEnabled=0 : PlaySound "fx_balldrop" : End Sub

'left scoreboard ramp
Sub LRTurn_hit():PlaySoundAtVol "fx_lr2", ActiveBall, 1:End Sub
Sub LRail_hit():PlaySoundAtVol "fx_wireramp", ActiveBall, 1:End Sub
Sub LRail1_Hit:If ActiveBall.Z>120 Then PlaySoundAtVol "fx_balldrop_SSRamp", ActiveBall, 1:Me.TimerInterval=200:Me.TimerEnabled=1:End If:End Sub
Sub LRail1_timer:Me.TimerEnabled=0:Playsound "fx_wireramp"::End Sub
Sub LRExit_Hit:StopSound "fx_wireramp":PlaysoundAtVol "fx_wireramp_exit", ActiveBall, 1:ActiveBall.VelY = 0:ActiveBall.VelX = 5:Me.TimerInterval=200:Me.TimerEnabled=1:End Sub
Sub LRExit_timer:Me.TimerEnabled=0:Playsound "fx_balldrop"::End Sub

'right scoreboard ramp
Sub RRTurn_hit():PlaySoundAtVol "fx_lr2", ActiveBall, 1:End Sub
Sub RRail_Hit:PlaySoundAtVol "fx_wireramp", ActiveBall, 1:End Sub
Sub RRail1_Hit:If ActiveBall.Z>120 Then PlaySoundAtVol "fx_balldrop_SSRamp", ActiveBall, 1:Me.TimerInterval=200:Me.TimerEnabled=1:End If:End Sub
Sub RRail1_timer:Me.TimerEnabled=0:Playsound "fx_wireramp"::End Sub
Sub RRExit_Hit:StopSound "fx_wireramp":PlaysoundAtVol "fx_wireramp_exit", ActiveBall, 1:ActiveBall.VelY = 0:ActiveBall.VelX = -5:Me.TimerInterval=200:Me.TimerEnabled=1:End Sub
Sub RRExit_timer:Me.TimerEnabled=0:Playsound "fx_balldrop"::End Sub

' *********************************************************************
'       Left and Right Orbits Hack
' *********************************************************************
'slow down the ball when shooting at loops (orbits)
Sub LoopHelpL_Unhit():If ActiveBall.VelY > 20 Then ActiveBall.VelY = RndNum(18,20):End If:End Sub
Sub LoopHelpR_Unhit():If ActiveBall.VelY > 20 Then ActiveBall.VelY = RndNum(18,20):End If:End Sub

'******************************************************
'         RealTime Updates
'******************************************************
Set MotorCallback = GetRef("RealTimeUpdates")

Sub RealTimeUpdates()
  RollingSoundUpdate
  BallShadowUpdate
  FlipperL.RotZ=LeftFlipper.currentangle
  FlipperUL.RotZ=LeftFlipper1.currentangle
  FlipperR.RotZ=RightFlipper.currentangle
  LFGuide.RotX = Gate3.currentangle*1/3
  FlipperLSh.RotZ = LeftFlipper.currentangle
  FlipperULSh.RotZ = LeftFlipper1.currentangle
  FlipperRSh.RotZ = RightFlipper.currentangle
End Sub

'*********** ROLLING SOUND *********************************
Const tnob = 5            ' total number of balls : 4 (trough) + 1 (Captive Ball)
ReDim rolling(tnob)

Sub InitRolling:Dim i:For i=0 to (tnob-1):rolling(i) = False:Next:End Sub

Sub RollingSoundUpdate()
    Dim BOT,b
    BOT = GetBalls
  ' stop the sound of deleted balls
  If BIP<(tnob - 1) Then
    For b = (BIP + 2) to tnob
      rolling(b-1) = False
      StopSound("fx_ballrolling" & b)
    Next
  End If
  ' exit the Sub if no balls on the table
  If BIP=0 Then Exit Sub
  ' play the rolling sound for each ball
  For b = 0 to BIP
    If BallVel(BOT(b)) > 1 AND BOT(b).z < 30 Then
      rolling(b) = True
      PlaySound("fx_ballrolling" & (b+1)), -1, Vol(BOT(b) )/2, Pan(BOT(b) ), 0, Pitch(BOT(b) ), 1, 0, AudioFade(BOT(b))
  Else
            If rolling(b) = True Then
                StopSound("fx_ballrolling" & (b+1))
                rolling(b) = False
            End If
        End If
    Next
End Sub

'*********** BALL SHADOW *********************************
Dim BallShadow
BallShadow = Array (BallShadow1, BallShadow2, BallShadow3,Ballshadow4,Ballshadow5)

Sub BallShadowUpdate()
    Dim BOT, b
    BOT = GetBalls
  ' hide shadow of deleted balls
  If BIP<(tnob-1) Then
    For b = (BIP + 2) to tnob
      BallShadow(b-1).visible = 0
    Next
  End If
  ' exit the Sub if no balls on the table
  If BIP=0 Then Exit Sub
  ' render the shadow for each ball
    For b = 0 to BIP
    If BOT(b).X < Table1.Width/2 Then
      BallShadow(b).X = ((BOT(b).X) - (Ballsize/6) + ((BOT(b).X - (Table1.Width/2))/10)) + 10
    Else
      BallShadow(b).X = ((BOT(b).X) + (Ballsize/6) + ((BOT(b).X - (Table1.Width/2))/10)) - 10
    End If
      ballShadow(b).Y = BOT(b).Y + 15
    If BOT(b).Z > 20 Then
      BallShadow(b).visible = 1
    Else
      BallShadow(b).visible = 0
    End If
  Next
End Sub









''*********************************************************************************************************************************************
'DEBUG: CODE USED TO PLAY AND TEST THE TABLE WITHOUT VPM
'Const BallSize = 52
'Const BallMass = 1.2
'Sub Table1_KeyDown(ByVal keycode)
' If keycode = LeftTiltKey Then Nudge 90, 4
' If keycode = RightTiltKey Then Nudge 270, 4
' If keycode = CenterTiltKey Then Nudge 0, 5
' If keycode = PlungerKey Then Plunger.PullBack:PlaySound "plungerpull",0,1,0.25,0.25
' If keycode = LeftFlipperKey Then LeftFlipper.RotateToEnd :LeftFlipper1.RotateToEnd:PlaySound "fx_flipperup", 0, .67, -0.05, 0.05
' If keycode = RightFlipperKey Then RightFlipper.RotateToEnd:PlaySound "fx_flipperup", 0, .67, 0.05, 0.05
'End Sub
'
'Sub Table1_KeyUp(ByVal keycode)
' If keycode = PlungerKey Then Plunger.Fire:StopSound "plungerpull":PlaySound "plunger",0,1,0.25,0.25
' If keycode = LeftFlipperKey Then LeftFlipper.RotateToStart:LeftFlipper1.RotateToStart:PlaySound "fx_flipperdown", 0, 1, -0.05, 0.05
' If keycode = RightFlipperKey Then RightFlipper.RotateToStart:PlaySound "fx_flipperdown", 0, 1, 0.05, 0.05
'End Sub
'
'Sub Drain_Hit()
' PlaySound "drain",0,1,0,0.25
' Drain.DestroyBall
' BallRelease.CreateSizedBallWithMass BallSize/2, BallMass
' BallRelease.Kick 90, 7
' PlaySound "ballrelease",0,1,0,0.25
'End Sub
'
'Sub Plunger_Init()
' PlaySound "ballrelease",0,1,0,0.25
' BallRelease.CreateSizedBallWithMass BallSize/2, BallMass
' BallRelease.Kick 90, 7
' CapBall.CreateSizedBallWithMass BallSize/2, BallMass:CapBall.kick 0, 0    'captive
' DropPost.isdropped=1
'End Sub
'
'Sub PinMameTimer_timer
'FlipperL.RotZ=LeftFlipper.currentangle
'FlipperUL.RotZ=LeftFlipper1.currentangle
'FlipperR.RotZ=RightFlipper.currentangle
'LFGuide.RotX = Gate3.currentangle*1/3
'End Sub
'
'Sub sw100_Hit():debug.print "sw homerun":End Sub
'sub sw22_hit:me.kick 0,15:end Sub
'sub sw21_hit:RightHole.Enabled=0:me.kick 0,45,1.56:me.timerinterval=500:me.timerEnabled=1:end Sub
'sub sw21_timer:me.timerEnabled=0:RightHole.Enabled=1:end Sub
'sub sw110_hit:LeftHole.Enabled=0:me.kick 0,45,1.56:me.timerinterval=500:me.timerEnabled=1:end Sub
'sub sw110_timer:me.timerEnabled=0:LeftHole.Enabled=1:end Sub
''********************************************************************************************************************************************
