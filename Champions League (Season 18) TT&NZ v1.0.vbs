'                                                                                     `.:/+osyhhdddddddddhyys+/:.`                                                                                       
'                                                                                ./oyddhyo+/:-.```     ``.--:+oshddyo/-`                                                                                 
'                                                                           `:oymhs+:.     `.-:`                  `-/shmho:`                                                                             
'                                                                        .+ymho:`     .oyhdmmmd/          `+yyys+/-.   `-+ydho-                                                                          
'                                                                     .+hdy/.         -mms:-.`            smd++syhmo       `:sddo-                                                                       
'                                                                  `/hmy/` `-          hmy-:/+oo         -mms.`   ``          `:sdh+.                                                                    
'                                                                .oddo.   `hmy-        /mmmdhyso`        ymmdmmdyo            `  `/hms-                                                                  
'                                                              .omh/`      .smmo`      `dms``  `.`      -mm/``-/+:         ./ydh.  `:ymy.                                                                
'                                                              `o/` .+-      :dmh:      +mmysyddm+      ymd`            ./ymmmmm`     -/`                                                                
'                                                                   ommo`     `smm:      -+oo+/:.`      ./-          .+hmdy/:mm+                                                                         
'                                                                    :hmh:     `mms          `.-:::::::--.`        :hmdy/.:-ymd`                                                                         
'                                                                    :hmh:     `mms          `.-:::::::--.`        :hmdy/.:-ymd`                                                                         
'                                                                     `+mmy:..:ymd.    `-/oyhyyssooooosssyhhyo/-`  `-:`  +hmmm/                                                                          
'                                                                       -sdmddmh+` `-+yhyo/-```          ``.-/syhy/-      .mmh                                                                           
'                                                                         `.--.` -ohyo-`                       `.:shh+.   .hm-                                                                           
'                                                                             `:yho-`                              `:yds-  `:                                                                            
'                                                                            .hh+.                                    .ods-                                                                              
'                                                                            `:`                                        .o-                                                                              
'        ``.....``                                                                                                                                                                                       
'    `-+yhdddddddho     .-....-.    .-....-.          .....-`           `-....-          -....-`     `...........`         -.....-`          `--:::-.           -......      -.....        `.-://///:-.  
'  `+hmmmdysooshmmy     .odddd+`    .odddd/`          .sdddmo           `/ddddm+        :ddddd+`     `/dddddddddddhs:      -ydddd:`       .+yddmmmmmdho-        -yddddh-     .+dds.      -shdmdhhhhdmmd- 
' .hmmmh:`     `-yh      :mmmm-      /mmmm.           .dmmmmm-           .mmmmmm-      `dmmmmm/        dmmmy:--/odmmms`     smmmd       `odmmy/---:odmmms.       smmmmmd/     .mm+      +mmmd:.````./ym: 
'.dmmmy`         `s      :mmmm-      /mmmm.          `hmm+mmmh`          -mmhmmmd`     smddmmm+        dmmmo     :mmmm:     smmmd      `ymmm+`      .ymmmd.      smm/dmmmo`   .mm+      mmmmy`       `o/ 
'ommmm.                  :mmmm:......+mmmm.          smm+ hmmm+          :mm/smmms    :mm/smmms        dmmmo     .mmmm:     smmmd      +mmmh         `dmmmy      smm`-hmmmy`  .mm+      hmmmmhs/:-.`  `` 
'hmmmd                   :mmmmdddddddmmmmm.         /mmy  /mmmm.         /mm/`hmmm+  `dmy ommmh        dmmmo   `.ymmms`     smmmd      hmmmy          ommmm`     smm` `smmmh- .mm+      .sdmmmmmmmdhs+-` 
'hmmmd                   :mmmmdddddddmmmmm.         /mmy  /mmmm.         /mm/`hmmm+  `dmy ommmh        dmmmo   `.ymmms`     smmmd      hmmmy          ommmm`     smm` `smmmh- .mm+      .sdmmmmmmmdhs+-` 
'hmmmm.                  :mmmmo//////smmmm.        -mmm+///mmmmy         +mm: .dmmm- smd. /mmmd        dmmmo/+syddhs:`      smmmd      ymmmd`         /mmmm`     smm`  `+mmmd:.mm+        .:+shddmmmmmmy.
'/mmmmy`                 :mmmm-      /mmmm.       .dmmyyyyyymmmm/        smm-  /mmmd/mm/  -mmmm`       dmmmo `.-..`         smmmd      :mmmm+         ommmy      smm`    :dmmmsmm+      -.     `-:+hmmmmy
' smmmmh:`        `-     :mmmm-      /mmmm.      `ymm+      ommmd.       ymm.   ommmmmy   `mmmm-       dmmmo                smmmd       ommmm+`     `/mmmh.      smm`     .hmmmmm+      /h.        .mmmmh
'  +dmmmmho:-.-:+shh     :mmmm-      /mmmm.      ommy       `dmmms       hmm.   `hmmmd.    mmmm/       mmmmo                smmmd        /hmmmho/::+ymmdo`       smm`      `smmmm+      :md+-.```.-smmmh-
'   .+hdmmmmmmmmmdh/    -odddd+.    -odddd+.   .+hdds-     `:hddddo.   ./hddo:   .ddd/   -+dddds:    `/ddddy/.             :ydddh:`       `:shddmmddhy/.        :ydd+-       +ddd+      -hdmmdhhddmddy/` 
'      .:/+ooo+/:.      ````````    ````````   ```````      .```````   ``````.    ...    ```````.    `.```````             .```````           ..--..`           ``````        ...`       `.--::/::-.`    
'                                                                                                                                                                                                        
'                                                                                                                                                                                                        
'                                                                                                                                                                                                        
'                                                   .....`         ............         ....`           ``--::-.`      .....`   `.....    `...........                                                   
'                                                  `/mmmo.         :mmmdhhhhhdh        `smmms         -ohddhyhdmd:     -mmmy.   .ommm/`   -hmmmhhhhhhm.                                                  
'                                                   .mmm:          `mmm/     `o        .dmdmm:       ommh:`   `-y/      mmmo     /mmm.     ymmy      /.                                                  
'                                                   .mmm:          `mmm+```.-         `hm+/mmd`     +mmd`       `.      mmmo     /mmm.     ymmy````/                                                     
'                                                   .mmm:          `mmmdhhhd+         smy``dmmo     hmms     ``````     mmmo     /mmm.     ymmmhhhdh                                                     
'                                                   .mmm:          `mmmo---//        +mmysshmmm-    ymmd     -oddd/`    mmmo     /mmm.     ymmh...-o                                                     
'                                                   .mmm:      +   `mmm/      .:    -mm/----smmh`   -mmmo`    :mmm      dmms     /mmm`     ymmy       +                                                  
'                                                   .mmmo::::/sy   `mmms:::::/h+   .dmo     `mmm+    -hmmh+::/hmmm      /mmm+-.-/dmmo      ymmh:::::/sy                                                  
'                                                  `+yyyyyyyyyy/  `/yyyyyyyyyyy-  .oss+.    /ssss/     :oyhdhy+./y       .+shhdhhy+-      :syyyyyyyyyy+                                                  
'                                                                                                                                                                                                                                         ````                              
'
' An original table created by Tom Tower & Ninuzzu
' Thanks to flupper for the domes and the bumper caps
' Thanks to VPDev team for the amazing VPX!
' All rights belong to UEFA and to their European Teams.
' All resources and musics have been found online, we hold no rights to any media used.

' Thalamus 2018-07-20
' This table has already its own version of  "Positional Sound Playback Functions" and "Supporting Ball & Sound Functions"

Option Explicit
Randomize

Const Ballsize=51
Const BallMass=1.25

On Error Resume Next
ExecuteGlobal GetTextFile("Controller.vbs")
If Err Then MsgBox "Unable to open Controller.vbs. Ensure that it is placed in the Scripts folder"
On Error Goto 0

On Error Resume Next
ExecuteGlobal GetTextFile("Core.vbs")
If Err Then MsgBox "Unable to open Core.vbs. Ensure that it is placed in the Scripts folder"
On Error Goto 0

On Error Resume Next
ExecuteGlobal GetTextFile("UltraDMD_Options.vbs")
If Err Then MsgBox "Unable to open UltraDMD_Options.vbs. Ensure that it is placed in the Scripts folder"
On Error Goto 0

Const cGameName = "uefa_cl18"						'this is the table name needed by DOF and by VPreg.stg
Const cAssetsFolder="ChampionsLeague"				'the folder that contains gifs, videos (the assets folder) used for DMD
Const cDefaultDMDColor = "PowderBlue"            	'this is the default DMD text color defined for this table

'************************************************************************
'*ULTRADMD STUFF*********************************************************
'************************************************************************

'*DMD SCENES WITH PRIORITY***********************************************
Dim OldPriority:Oldpriority=0

Sub UDMD_Display(bkgnd,toptext,topBrightness, topOutlineBrightness, bottomtext, bottomBrightness, bottomOutlineBrightness, animateIn,pauseTime,animateOut,priority)
	If priority >= OldPriority Then
		UltraDMD.CancelRendering
		UltraDMD.DisplayScene00Ex bkgnd, toptext, topBrightness, topOutlineBrightness, bottomtext, bottomBrightness, bottomOutlineBrightness, animateIn, pauseTime, animateOut
		SCReset.Enabled=1
	End If
	OldPriority = priority
End Sub

Sub SCReset_Timer()
    If Not UltraDMD.IsRendering Then
        'When the scene finishes rendering, Then immediately display the scoreboard
        Me.Enabled=0
        OnScoreboardChanged
		If OptMusicEnabled Then OptMusicEnabled=False
    End If
End Sub

'*DMD SCORING*********************************************************
Dim  p1score, p2score, p3score, p4score, creditString

Sub GetPricing
	If FreePlay=0 Then
		creditString = "credits " & creditgame
	Else
		creditString = "FREE PLAY"
	End If
End Sub

Sub SetScoring
	For ii=1 to NewPlayer
		ExecuteGlobal ("p" & ii &  "score=" & scores(ii-1) & ":")
	Next
	If NewPlayer<>4 Then
	For ii=(NewPlayer+1) to 4
		ExecuteGlobal ("p" & ii &  "score=0" & ":")
	Next
	End If
End Sub

Sub OnScoreboardChanged
	SetScoring:GetPricing:Oldpriority=0
	If gmover= 0 Then
		On Error Resume Next
		UltraDMD.DisplayScoreboard00 NewPlayer, CurrentPlayer+1, p1score, p2score, p3score, p4score, creditString, "ball " & ballinplay(CurrentPlayer)
		If Err.number <> 0 Then UltraDMD.DisplayScoreboard NewPlayer, CurrentPlayer+1, p1score, p2score, p3score, p4score, creditString, "ball " & ballinplay(CurrentPlayer)       
	Else
		On Error Resume Next
		UltraDMD.DisplayScoreboard00 NewPlayer, CurrentPlayer+1, p1score, p2score, p3score, p4score, creditString, " "
		If Err.number <> 0 Then UltraDMD.DisplayScoreboard NewPlayer, CurrentPlayer+1, p1score, p2score, p3score, p4score, creditString, " "
	End If
End Sub

'************************************************************************
'*BALL TYPE *************************************************************
'************************************************************************
Sub UpdateBall
	Dim b,BOT:BOT=GetBalls:B2SEffect B2SLight4,3,50
	For b=0 to Ubound(BOT)
	If Table1.VersionMajor > 10 OR (Table1.VersionMajor = 10 AND Table1.VersionMinor > 3) Then
		If GKMM=0 AND MVPOfTheYear(CurrentPlayer)=0 AND progress(CurrentPlayer)<5 Then
			If BallType=1 Then
				On Error Resume Next
				BOT(b).DecalMode=True
				BOT(b).image="black":BOT(b).FrontDecal="ball_decal1"							'CL 18 MatchBall
				BOT(b).BulbIntensityScale=0.1:BOT(b).PlayfieldReflectionScale=0
			Else
				On Error Resume Next
				BOT(b).DecalMode=False
				BOT(b).image="ball":BOT(b).FrontDecal="Scratches"								'Steel Ball
				BOT(b).BulbIntensityScale=1:BOT(b).PlayfieldReflectionScale=1
			End If
		End If

		If GKMM=0 AND MVPOfTheYear(CurrentPlayer)=0 AND progress(CurrentPlayer)>=5 Then
			On Error Resume Next
			BOT(b).DecalMode=True
			BOT(b).image="black":BOT(b).FrontDecal="ball_decal2"								'CL 18 Finale
			BOT(b).BulbIntensityScale=0.1:BOT(b).PlayfieldReflectionScale=0
		End If

		If GKMM=1 Then
			On Error Resume Next
			BOT(b).DecalMode=True
			BOT(b).image="black":BOT(b).FrontDecal="ball_decal3"								'CL 18 Orange
			BOT(b).BulbIntensityScale=0.1:BOT(b).PlayfieldReflectionScale=0
		End If

		If MVPOfTheYear(CurrentPlayer)=1 Then													'Ballon d'Or
			On Error Resume Next
			BOT(b).DecalMode=False
			BOT(b).image="ball":BOT(b).color=RGB(250,180,90):BOT(b).FrontDecal="ball_decal4"
			BOT(b).BulbIntensityScale=0.25:BOT(b).PlayfieldReflectionScale=1
		End If
	Else
		BOT(b).image="ball":BOT(b).FrontDecal="Scratches"										'Steel Ball
		BOT(b).BulbIntensityScale=1:BOT(b).PlayfieldReflectionScale=1
	End If
	Next
End Sub

'************************************************************************
'*GAME MUSIC*************************************************************
'************************************************************************
Dim rMusic,MusicList,optMusicVolume,optMusicEnabled

Sub InitMusic
	Set MusicList = CreateObject("System.Collections.ArrayList")
	MusicList.Add "bgout_UEFACL - ACDC - Thunderstruck.mp3"						'index 0
	MusicList.Add "bgout_UEFACL - Deep Purple - Smoke On The Water.mp3"			'index 1
	MusicList.Add "bgout_UEFACL - Guns N Roses - Welcome To The Jungle.mp3"		'index 2
	MusicList.Add "bgout_UEFACL - Iggy Pop - Lust for Life.mp3"					'index 3
	MusicList.Add "bgout_UEFACL - Iron Maiden - The Trooper.mp3"				'index 4
	MusicList.Add "bgout_UEFACL - Jethro Tull - Locomotive Breath.mp3"			'index 5
	MusicList.Add "bgout_UEFACL - Jimi Hendrix - Voodoo Child.mp3"				'index 6
	MusicList.Add "bgout_UEFACL - Pink Floyd - One of These Days.mp3"			'index 7
	MusicList.Add "bgout_UEFACL - Ram Jam - Black Betty.mp3"					'index 8
	MusicList.Add "bgout_UEFACL - Ramones - Blitzkrieg Bop.mp3"					'index 9
	MusicList.Add "bgout_UEFACL - RATM - Killing In The Name.mp3"				'index 10
	MusicList.Add "bgout_UEFACL - Sex Pistols - God save the queen.mp3"			'index 11
	MusicList.Add "bgout_UEFACL - Survivor - Eye of the Tiger.mp3"				'index 12
	MusicList.Add "bgout_UEFACL - MultiMode.mp3"								'index 13
	MusicList.Add "bgout_UEFACL - MultiMode2.mp3"								'index 14
	MusicList.Add "bgout_UEFACL - GKMode.mp3"									'index 15
	MusicList.Add "bgout_UEFACL - HighScore.mp3"								'index 16
	MusicList.Add "bgout_UEFACL - IntroHS.mp3"									'index 17
	MusicList.Add "bgout_UEFACL - finalVideo.mp3"								'index 18
	MusicList.Add "bgout_UEFACL - win.mp3"										'index 19
	MusicList.Add "bgout_UEFACL - MVPMode.mp3"									'index 20
	MusicList.Add "bgout_UEFACL - Intro.mp3"									'index 21
	MusicList.Add "bgout_UEFACL - Intro2.mp3"									'index 22
	optMusicVolume=LoadValue (cGameName, "Volume")
	If optMusicVolume = "" then
		optMusicVolume = 1
		SaveValue cGameName, "Volume", 100
	Else
		optMusicVolume=optMusicVolume/100
	End If
	optMusicEnabled=False
End Sub

Sub Music
	If cAttractMode=0 AND gkmm=0 AND VMOn=0 AND MVPOfTheYear(CurrentPlayer)=0 AND NOT (lmultilock.state=1 OR Lmultiticket.state=1 OR Lmultiskill.state=1) Then rMusic=RndNum(0,12):PlayMusic MusicList(rMusic), optMusicVolume
	If cAttractMode=0 AND gkmm=0 AND VMOn=0 AND MVPOfTheYear(CurrentPlayer)=0 AND (lmultilock.state=1 OR Lmultiticket.state=1 OR Lmultiskill.state=1) Then rMusic=RndNum(13,14):PlayMusic MusicList(rMusic), optMusicVolume
	If GKMM=1 OR VMOn=1 Then PlayMusic MusicList(15),optMusicVolume
	If HSPlace>=0 Then PlayMusic MusicList(16),optMusicVolume
	If MVPOfTheYear(CurrentPlayer)=1 Then PlayMusic MusicList(20),optMusicVolume
End Sub

Sub Table1_MusicDone():Music:End Sub
Sub StopMusic:EndMusic:End Sub

'************************************************************************
'*TABLE INIT*************************************************************
'************************************************************************
Const MaximumCredits=9			'set the max number of credits the rom can support
Dim LockMultiMode,TicketMultiMode,SkillMultiMode			'0=off,1=on(light blinking),2=running (light On)
Dim bip,creditgame,b1force,b2force,flforce,TeamSelection,SelectedTeams,CurrentPlayer,NewPlayer,ii
ReDim Lampstate(AllInserts.count),AllPlayersLampStates(3,AllInserts.count)
Dim choiceteam(3),numBump(3), JetLevel(3), SkillShotMade(3)
Dim ballinplay(3),extraball(3),extraballmax(3),maxballs(3),completed(3)
Dim win(3),defencestate(3),progress(3),DefenceLocked(3),BLhit(3),BRhit(3),FKGoal(3)
Dim StrikerMode(3),StrikerModeStart(3),FKAward(3),SemiFinalAward(3),BSMODE(3),MVPOfTheYear(3),TDState(3)
Dim teamsix(3),teamfive(3),teamfour(3),teamthree(3),teamtwo(3),teamone(3)
Dim vs1(3),vs2(3),vs3(3),vs4(3),vs5(3),vs6(3)
Dim scores(3),CLChamp(3),FKChamp(3),LockMScoreBest(3),VMChamp(3),GKMChamp(3)

Sub Table1_Init()
	LoadEM
	LoadTableOptions
	GameInit:InitMusic:GiOff
	InitUltraDMD cAssetsFolder,cGameName
	RailL.visible=Table1.ShowDT:RailLb.visible=Table1.ShowDT
	RailR.visible=Table1.ShowDT:RailRb.visible=Table1.ShowDT
	RailLC.visible=Table1.ShowDT
	If Table1.VersionMajor>10 OR (Table1.VersionMajor=10 AND Table1.VersionMinor>3) Then ToysBar.BlendDisableLightingFromBelow=0.9
	If Table1.VersionMajor=10 AND Table1.VersionMinor=3 Then hotdogTL.intensity=0:canTL.intensity=0:chipsTL.intensity=0
	b1force=Bumper1.Force:b2force=Bumper2.Force:flforce=RightFlipper.Strength:Plunger.MechStrength=BallMass*100
	LoadHighScores
End Sub

Sub Table1_Exit()
	If B2SOn Then Controller.Stop
	ExitUltraDMD
	SaveHighScores
	SaveValue cGameName, "Volume", 100*optMusicVolume
End Sub

'************************************************************************
'*GAME INTRO*************************************************************
'************************************************************************
Dim rndIntro,introtime,displaystart,introtxt,opadir:displaystart=0:introtxt=0:opadir=-1
Sub skipultradmd_timer
	If NOT UltraDMD.IsRendering Then
		me.enabled=0
		GIOn:StartAttractMode:PlaySound "reset"
		DisplayIntro.Interval=100:DisplayIntro.enabled=1
	End If
End Sub

Sub DisplayIntro_timer()
	If NOT UltraDMD.IsRendering AND cAttractMode=1 Then
		Me.Enabled=0:Randomize
		rndIntro=RndNum(1,2)
		If displaystart=0 Then
			UltraDMD.DisplayScene00Ex "ttnzprsent.png", "", -1,-1, "", -1,-1, UltraDMD_Animation_ScrollOnDown, 2000, UltraDMD_Animation_FadeOut
			If rndIntro=1 Then PlayMusic MusicList(21),optMusicVolume:introtime=41500
			If rndIntro=2 Then PlayMusic MusicList(22),optMusicVolume:introtime=38000
		End If
		If displaystart=1 Then introtime=10000
		If rndIntro=1 Then UltraDMD.DisplayScene00Ex "CLIntro.gif", "", -1, -1,"", -1, -1, UltraDMD_Animation_FadeIn, introtime, UltraDMD_Animation_FadeOut
		If rndIntro=2 Then UltraDMD.DisplayScene00Ex "CLIntro2.wmv", "", -1, -1,"", -1, -1, UltraDMD_Animation_FadeIn, introtime, UltraDMD_Animation_FadeOut
		DisplayIntroHS.enabled=1
	End If
End Sub

Sub DisplayIntro1_timer()
	Select Case introtxt
	Case 0
	If SCframe.opacity>100 Then opadir=-1
	If SCframe.opacity=0 Then SCframe.imageA="LCD_introtxt_0":introtxt=1:opadir=1
	Case 1
	If SCframe.opacity>100 Then opadir=-1
	If SCframe.opacity=0 Then SCframe.imageA="LCD_introtxt_1":introtxt=2:opadir=1
	Case 2
	If SCframe.opacity>100 Then opadir=-1
	If SCframe.opacity=0 Then SCframe.imageA="LCD_introtxt_2":introtxt=3:opadir=1
	Case 3
	If SCframe.opacity>100 Then opadir=-1
	If SCframe.opacity=0 Then SCframe.imageA="LCD_introtxt_3":introtxt=4:opadir=1
	Case 4
	If SCframe.opacity>100 Then opadir=-1
	If SCframe.opacity=0 Then SCframe.imageA="LCD_introtxt_4":introtxt=5:opadir=1
	Case 5
	If SCframe.opacity>100 Then opadir=-1
	If SCframe.opacity=0 Then SCframe.imageA="LCD_introtxt_00":introtxt=0:opadir=1
	End Select
	SCframe.Opacity=SCframe.Opacity+5*opadir
End Sub

Sub DisplayIntroHS_Timer()
	If Not UltraDMD.IsRendering Then
		Me.Enabled=0
		If displaystart=0 Then
			PlayMusic MusicList(17),optMusicVolume
			UltraDMD.DisplayScene00 "", HSStrings(0),15, highScoreName(0) & "  " & formatnumber(highScore(0),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
			UltraDMD.DisplayScene00 "", "HIGHSCORES",15, "", 15, UltraDMD_Animation_None, 1300, UltraDMD_Animation_None
			UltraDMD.DisplayScene00 "", "1) " & bestnames(0) & " " & formatnumber(bestscores(0),0),15, "2) " & bestnames(1) & " " & formatnumber(bestscores(1),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
			UltraDMD.DisplayScene00 "", "3) " & bestnames(2) & " " & formatnumber(bestscores(2),0),15, "4) " & bestnames(3) & " " & formatnumber(bestscores(3),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
			UltraDMD.DisplayScene00 "", HSStrings(1),15, highScoreName(1) & "  " & highScore(1) & " CL WINS", 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
			UltraDMD.DisplayScene00 "", HSStrings(2),15, highScoreName(2) & "  " & highScore(2) & " FREE KICKS", 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
			UltraDMD.DisplayScene00 "", HSStrings(3),15, highScoreName(3) & "  " & formatnumber(highScore(3),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
			UltraDMD.DisplayScene00 "", HSStrings(4),15, highScoreName(4) & "  " & formatnumber(highScore(4),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
			UltraDMD.DisplayScene00 "", HSStrings(5),15, highScoreName(5) & "  " & formatnumber(highScore(5),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
		End If
		DisplayIntro.enabled=1
	End If
End Sub

Sub DisplayStartScreen_Timer()
    If Not UltraDMD.IsRendering Then
		Me.Enabled=0
        If FreePlay=1 Then UltraDMD.DisplayScene00Ex "freeplay.gif", " ", 14, 2, "", -1, -1, UltraDMD_Animation_ScrollOnUp, 4000, UltraDMD_Animation_ScrollOffDown
        UltraDMD.DisplayScene00Ex "press_start.gif", " ", 14, 2, "", -1, -1, UltraDMD_Animation_ScrollOnUp, 10000, UltraDMD_Animation_ScrollOffDown
		displaystart=1:DisplayIntro.enabled=1
    End If
End Sub

'************************************************************************
'* GAME INIT ************************************************************
'************************************************************************
Sub GameInit
	For ii=0 to 3
		scores(ii)=0:choiceteam(ii)=1:completed(ii)=0:numBump(ii)=0:JetLevel(ii)=1:SkillShotMade(ii)=0
		ballinplay(ii)=1:extraball(ii)=0:extraballmax(ii)=0:maxballs(ii)=0
		win(ii)=0:defencestate(ii)=0:progress(ii)=0:DefenceLocked(ii)=0:BLhit(ii)=0:BRhit(ii)=0
		StrikerMode(ii)=0:StrikerModeStart(ii)=0:FKAward(ii)=0:SemiFinalAward(ii)=0:BSMODE(ii)=0:MVPOfTheYear(ii)=0:TDState(ii)=0
		CLChamp(ii)=0:FKChamp(ii)=0:FKGoal(ii)=0:LockMScoreBest(ii)=0:VMChamp(ii)=0:GKMChamp(ii)=0	
	Next
	NewPlayer=0:CurrentPlayer=0:TeamSelection=0:SelectedTeams=0
	LockMultiMode=0:TicketMultiMode=0:SkillMultiMode=0
	lpin.isdropped=1:rpin.isdropped=1:wall61.isdropped=1
	wkl1.isdropped=1:Wkl2.isdropped=1:wkc1.isdropped=1:Wkc2.isdropped=1:wkr1.isdropped=1:Wkr2.isdropped=1
	GKMHelper1.IsDropped=1:GKMHelper2.IsDropped=1
	hitLD.isdropped=1:WALL32.isdropped=1
	hitRD.isdropped=1:WALL33.isdropped=1
	screenprim.visible=1:screenprim.image="logoCL"
	LeftFlipper.RotatetoStart:RightFlipper.RotatetoStart
	LeftFlipper1.RotatetoStart:RightFlipper1.RotatetoStart
	LdefL.Height=headDEF1.Z+100:LdefC.Height=headDEF2.Z+100:LdefR.Height=headDEF3.Z+100
	LbombL.Height=-140:LbombR.Height=-140
	ResetAllToys:ResetGK:WallDrain.IsDropped=1
	For each ii in AllInserts:ii.state=0:Next
	For each ii in TeamLogos:StopFlash ii,0:Next
	For each ii in VMFlashers:StopFlash ii,0:next
	StopFlash TDFL1,0:StopFlash TDFL2,0:StopFlash TDFL3,0:StopFlash VMFlasher,0:StopFlash lClwin,0:UpdateB2SLogos
	StopFlash Fl1a,0:StopFlash Fl2a,0:StopFlash Fl3a,0:StopFlash Fl4a,0
	StopFlash FKFL1,0:StopFlash FKFL2,0:StopFlash FKFL3,0:StopFlash FKFL4,0:StopFlash FKFL5,0
End Sub

Sub ResetAllToys
	If headGK.Z>0 Then GKHOLEin.enabled=1
	defencedown.enabled=1
	If headLD.Z>0 Then bomberLdown.enabled=1:PlaySoundAt SoundFXDOF("fx_postdown",134,DOFPulse,DOFDropTargets),headLD
	If headRD.Z>0 Then bomberRdown.enabled=1:PlaySoundAt SoundFXDOF("fx_postdown",135,DOFPulse,DOFDropTargets),headRD
	If TrapDoorP.Z>0 then OpenTrapDoor False
	If DiverterP.Z<50 Then TicketDiverter True
	TabletDown
End Sub

Sub ResetGK
	For each ii in GkWalls:ii.IsDropped=1:Next
	GKwalls(4).isdropped=0:GKwalls(5).isdropped=0
	ResetGKTimer.enabled=1
End Sub

Sub ResetGKTimer_Timer
If headGK.transx>0 Then
	headGK.transx=headGK.transx-1
	bootsGK.transx=headGK.transx-1
	kitGK.transx=headGK.transx-1
	bodyGK.transx=headGK.transx-1
	GKpost.transx=headGK.transx-1
End If
If headGK.transx<0 Then
	headGK.transx=headGK.transx+1
	bootsGK.transx=headGK.transx+1
	kitGK.transx=headGK.transx+1
	bodyGK.transx=headGK.transx+1
	GKpost.transx=headGK.transx+1
End If
If headGK.transx=0 Then ResetGKTimer.enabled=0
End Sub

Sub DisableTable(Enabled)
If Enabled Then
	'turn off GI
	GiOff
	'turn off kick again light
	If kickagainT.enabled OR Lkag.state=1 Then kickagainT.enabled=0:kickcount=0:kicked=0:Lkag.state=0:BSaverAward=0
	'turn off multiball modes lights
		If Lmultilock.state=1 Then
			Lmultilock.state=0:LockMultiMode=0
			lockjackpot.state=0:skilljackpot.state=0:ticketjackpot.state=0:superjackpot.state=0
			Llock.state=2:Llock1.state=2:Llock2.state=2:Llock3.state=2
			TicketDiverter True
			If subwall.Z > 140 Then TabletDown
			subwall.image = "sub_text"
			njack=0:kicked=0:bonus=0
		End If
		If Lmultiskill.state=1 Then
			Lmultiskill.state=0:SkillMultiMode=0
			skilljackpot.state=0:superjackpot.state=0
			skill1.state=2:skill2.state=2:skill3.state=2
			TicketDiverter True
			skill=0:kicked=0:bonus=0
		End If
		If Lmultiticket.state=1 Then
			Lmultiticket.state=0:TicketMultiMode=0
			ticketjackpot.state=0:superjackpot.state=0
			ticket1.state=2:ticket2.state=2:ticket3.state=2
			TicketDiverter True
			ticket=0:kicked=0:bonus=0
		End If
	'Disable slings, bumpers ...
	LeftFlipper.RotatetoStart:RightFlipper.RotatetoStart
	LeftFlipper1.RotatetoStart:RightFlipper1.RotatetoStart
	LeftSlingshot.Disabled=1:RightSlingshot.Disabled=1
	Bumper1.Force=0
	Bumper2.Force=0
	If moveGK.enabled AND GKMM=0 Then moveback=1:moveGK.enabled=0:ResetGK
	kickagain=0:cBonusM=0		'disable bonus
	DisplayInfoTimer.Enabled=0:DisplayRulesTimer.Enabled=0
	If cGameRules Then cGameRules=False:RulesDT.visible=0:RulesFS.visible=0
	If cInstantInfo Then CheckGameInfo.Enabled=0:UltraDMD.CancelRendering:cInstantInfo=False
Else
	'turn back on GI
	GiOn
	'Enable slings, bumpers ....
	LeftSlingshot.Disabled=0:RightSlingshot.Disabled=0
	Bumper1.Force=b1force:Bumper2.Force=b2force
	If moveback=1 Then ResetGKTimer.Enabled=0:moveGK.enabled=1:moveback=0:Lshoot.state=2
	kickagain=1
End If
End Sub

'************************************************************************
'*GAME OVER *************************************************************
'************************************************************************
Dim gmover:gmover=0
Sub GameOver_Timer()
	gmover=1
    If Not UltraDMD.IsRendering Then
        'When the scene finishes, display the game over screen, after 4 seconds display the final score
		Me.Enabled=0:moveGK.enabled=0:StopMusic
		UDMD_Display "", "GAME OVER", 14, 2, "", -1, -1, UltraDMD_Animation_ScrollOnUp, 4000, UltraDMD_Animation_FadeOut,10
		CheckforNewGame.Interval=8000
		CheckforNewGame.Enabled=1
    End If
End Sub

Sub CheckforNewGame_Timer()
Me.Enabled=0:gmover=0
If creditgame=0 AND FreePlay=0 Then UltraDMD.CancelRendering:DisplayIntro.enabled=1:GameInit:StartAttractMode
If (creditgame>0 or FreePlay=1) AND resetcomplete=1 Then UltraDMD.CancelRendering:DisplayStartScreen.Enabled=1:GameInit:StartAttractMode
End Sub

'*********************************************************************
'*****TILT************************************************************
'*********************************************************************
Dim TiltLevel, TiltWarnings, Tilted, RndNudge
TiltLevel=0:TiltWarnings=0:Tilted=0

Sub AddToTilt(byVal Power)
	TiltLevel=TiltLevel+(10*Power*TiltSensitivity)
    TiltDecrease.Enabled=1
    TiltDecrease.Interval=50
	If TiltLevel>200 Then
		TiltWarnings=TiltWarnings+1
		If TiltLevel>400 Then TiltWarnings=TiltWarnings+1
		If TiltLevel>600 Then TiltWarnings=TiltWarnings+1
		If TiltWarnings>TiltMaxWarnings Then
			PlaySound "V.red card"
			StopMusic
			DisableTable 1:Tilted=1:bonus=0:bonusP=0
			LightSeqTilt.Play SeqAllOff
			UltraDMD.CancelRendering:UltraDMD.DisplayScene00Ex "redcard.gif", "    TILT     ", 15,0,"",15,0,UltraDMD_Animation_None, 6000, UltraDMD_Animation_None
			'start the Tilt recovery to check for all the balls to be drained
			TiltRecovery.Interval=3000
			TiltRecovery.Enabled=1
		Else
			PlaySound "V.yellowcard":UltraDMD.CancelRendering
			UDMD_Display "yellowcard.gif", "* WARNING *", 15,0,"",15,0,UltraDMD_Animation_FadeIn, 1500, UltraDMD_Animation_FadeOut,10
		End If
	End If
End Sub

Sub TiltDecrease_Timer
		TiltLevel=TiltLevel-(TiltLevel*.1)
    If TiltLevel < 1 Then TiltDecrease.Enabled=0:TiltLevel=0
End Sub

Sub TiltRecovery_Timer
	Me.Enabled=0
	If BIP=0 Then
		TiltDelay.Interval=1000
		TiltDelay.Enabled=1
		If UltraDMD.IsRendering Then UltraDMD.CancelRendering
		OnScoreboardChanged
	Else			
		TiltRecovery.Interval=1000
		TiltRecovery.Enabled=1
	End If
End Sub

Sub TiltDelay_Timer
	Me.Enabled=0
	DisableTable 0:Tilted=0:TiltLevel=0:TiltWarnings=0:LightSeqTilt.StopPlay:PlayerCheck
End Sub

Sub SlamTilt_Timer
	Me.Enabled=0
	Tilted=0:kicked=0:TiltWarnings=0
    ' If all the balls have been drained Then.
	If BIP=0 Then
		DisableTable 0:LightSeqTilt.StopPlay
		For each ii in TeamLogos:StopFlash ii,0:Next
		SCFrame.opacity=100:SCFrame.imageA="LCD_Introtxt_00":SCFrame.visible=1
		GameOver.Enabled=1
	Else
		SlamTilt.Interval=1000
		SlamTilt.Enabled=1
	End If
End Sub

Sub LightSeqTilt_PlayDone()
'when finishes the queue it restarts the sequence again
    LightSeqTilt.Play SeqAllOff
End Sub

'************************************************************************
'*KEYS*******************************************************************
'************************************************************************
Sub Table1_KeyDown(ByVal keycode)
	If keycode = LeftFlipperKey AND cAttractMode=0 AND GKMM=0 AND VMOn=0 AND Tilted=0 AND cursorPos=40 Then    
		LeftFlipper.RotateToEnd
		leftFlipper1.RotateToEnd
		PlaySoundAt SoundFXDOF("fx_flipperup", 101, DOFOn, DOFFlippers), LeftFlipper
	End If

	If keycode = RightFlipperKey AND cAttractMode=0 AND GKMM=0 AND VMOn=0 AND Tilted=0 AND cursorPos=40 Then
		RightFlipper.RotateToEnd
		RightFlipper1.RotateToEnd
		PlaySoundAt SoundFXDOF("fx_flipperup", 102, DOFOn, DOFFlippers), RightFlipper
	End If

'****CREDITS************************************************************
    If keycode=AddCreditKey AND Not skipultradmd.Enabled AND Tilted=0 AND Not OptMenuEnabled Then 
		PlaySound "fx_coin"
		If creditgame<MaximumCredits AND FreePlay=0 Then creditgame=creditgame+1
		DOF 150, DOFOn:GiEffect 0
		If cAttractMode=1 Then
			If NOT DisplayStartScreen.Enabled Then
				DisplayIntroHS.Enabled=0:DisplayIntro.Enabled=0:StopMusic
				UltraDMD.CancelRendering
				DisplayStartScreen.Enabled=1
			Else
				If FreePlay=0 Then OnScoreboardChanged
			End If
		Else
			If FreePlay=0 Then OnScoreboardChanged
		End If
    End If

'****ADD NEW PLAYERS ************************************************************
	If keycode=StartGameKey AND cAttractMode=1 AND Not skipultradmd.Enabled AND Tilted=0 AND resetcomplete=1 AND Not OptMenuEnabled Then AddNewPlayers
    If keycode=StartGameKey AND cAttractMode=0 AND Not skipultradmd.Enabled AND Tilted=0 AND ballinplay(0)=1 AND (creditgame>0 or FreePlay=1) Then AddNewPlayers		'new players can be added also when player1 is playing the first ball

'****TEAM SELECTION************************************************************
	If keycode = LeftFlipperKey AND TeamSelection=1 Then
		If TeamLogos(0).timerEnabled OR TeamLogos(1).timerEnabled OR TeamLogos(2).timerEnabled OR TeamLogos(3).timerEnabled OR TeamLogos(4).timerEnabled OR TeamLogos(5).timerEnabled OR TeamLogos(6).timerEnabled Then
			For Each ii in TeamLogos:StopFlash ii,0:Next
		End If
		choiceteam(CurrentPlayer)=choiceteam(CurrentPlayer)-1
		If choiceteam(CurrentPlayer)>32 Then choiceteam(CurrentPlayer)=1
		If choiceteam(CurrentPlayer)<1 Then choiceteam(CurrentPlayer)=32
		screenprim.image="logo" & choiceteam(CurrentPlayer):TeamLogos(3).imageA="logo" & choiceteam(CurrentPlayer):Flash TeamLogos(3),250
		UltraDMD.CancelRendering
		UltraDMD.DisplayScene00Ex "logo" & choiceteam(CurrentPlayer) &".png","SELECT YOUR TEAM", 14, 3, TeamList(choiceteam(CurrentPlayer)-1), 1, 14, UltraDMD_Animation_None, 999999, UltraDMD_Animation_None
	End If

	If keycode = RightFlipperKey AND TeamSelection=1 Then
		If TeamLogos(0).timerEnabled OR TeamLogos(1).timerEnabled OR TeamLogos(2).timerEnabled OR TeamLogos(3).timerEnabled OR TeamLogos(4).timerEnabled OR TeamLogos(5).timerEnabled OR TeamLogos(6).timerEnabled Then
			For Each ii in TeamLogos:StopFlash ii,0:Next
		End If
		choiceteam(CurrentPlayer)=choiceteam(CurrentPlayer)+1
		If choiceteam(CurrentPlayer)>32 Then choiceteam(CurrentPlayer)=1
		If choiceteam(CurrentPlayer)<1 Then choiceteam(CurrentPlayer)=32
		screenprim.image="logo" & choiceteam(CurrentPlayer):TeamLogos(3).imageA="logo" & choiceteam(CurrentPlayer):Flash TeamLogos(3),250
		UltraDMD.CancelRendering
		UltraDMD.DisplayScene00Ex "logo" & choiceteam(CurrentPlayer) &".png","SELECT YOUR TEAM", 14, 3, TeamList(choiceteam(CurrentPlayer)-1) , 1, 14, UltraDMD_Animation_None, 999999, UltraDMD_Animation_None
	End If

'****SHOW STATUS REPORT ******************************************************
	If keycode = LeftFlipperKey AND bip>0 AND cAttractMode=0 AND TeamSelection=0 AND FK=0 AND GKMM=0 AND VMOn=0 AND Tilted=0 Then DisplayInfoTimer.Enabled=1
	If keycode = RightFlipperKey AND bip>0 AND cAttractMode=0 AND TeamSelection=0 AND FK=0 AND GKMM=0 AND VMOn=0 AND Tilted=0 Then DisplayInfoTimer.Enabled=1

'****SHOW GAME RULES *********************************************************
	If keycode = LeftFlipperKey OR keycode = RightFlipperKey Then 
		If cAttractMode=1 OR (cAttractMode=0 AND ballinplunger AND Tilted=0) Then DisplayRulesTimer.Enabled=1
	End If

'****BONUS LIGHTS************************************************************
	If keycode = LeftFlipperKey AND cAttractMode=0 AND TeamSelection=0 AND Tilted=0 Then SwapBonusLights
	If keycode = RightFlipperKey AND cAttractMode=0 AND TeamSelection=0 AND Tilted=0 Then SwapBonusLights

'****GKMOVEMODE************************************************************
    If keycode = LeftFlipperKey AND GKMM=1 AND Tilted=0 Then
		PlaySoundAt SoundFXDOF("fx_DropTargetUp",101,DOFOn,DOFFlippers),headGK
		HEADGK.X=387:bootsGK.X=387:bodyGK.X=387:kitGK.X=387:GKPOST.X=387
		GKWalls(0).IsDropped=0
		For ii=1 to 9:GKWalls(ii).IsDropped=1:Next
	End If

	If keycode = RightFlipperKey AND GKMM=1 AND Tilted=0 Then
		PlaySoundAt SoundFXDOF("fx_DropTargetUp",102,DOFOn,DOFFlippers),headGK
		HEADGK.X=487:bootsGK.X=487:bodyGK.X=487:kitGK.X=487:GKPOST.X=487
		GKWalls(9).IsDropped=0
		For ii=0 to 8:GKWalls(ii).IsDropped=1:Next
	End If

'*****HEAD MOVE**************************************************************
	If keycode = LeftFlipperKey AND Tilted=0 AND VMOn=1 Then HEADL.ENABLED=1
	If keycode = RightFlipperKey AND Tilted=0 AND VMOn=1 Then HEADR.ENABLED=1

'*****PLUNGER**************************************************************
	If keycode = PlungerKey Then
		If TeamSelection=1 Then
			StartSkillShot:Schedule.Enabled=1:exit sub
		End If
		If cAttractMode=0 AND TeamSelection=0 Then
			Plunger.Fire
			If ballInPlunger Then
				PlaySoundAt SoundFXDOF("fx_AutoPlunger", 125, DOFPulse, DOFContactors),Plunger
			End If
		End If
	End If

'*****TILT**************************************************************
	If KeyCode=LeftTiltKey Then
		RndNudge=Rnd(1)/2       ' random number between .0 AND .49
		RndNudge=RndNudge+2.25  ' make it between 2.25 AND 2.749
		Nudge 90,RndNudge
		PlaySoundAt SoundFX("fx_nudge",0),Card1
		If GKMM=0 AND VMOn=0 AND tilted=0 AND BIP>0 Then AddToTilt(RndNudge)
	End If
	If KeyCode=RightTiltKey Then
		RndNudge=Rnd(1)/2
		RndNudge=RndNudge+2.25
		Nudge 270,RndNudge
		PlaySoundAt SoundFX("fx_nudge",0),Card2
		If GKMM=0 AND VMOn=0 AND tilted=0 AND BIP>0 Then AddToTilt(RndNudge)
	End If
	If KeyCode=CenterTiltKey Then
		RndNudge=Rnd(1)/2
		RndNudge=RndNudge+2.25
		Nudge 0,RndNudge
		PlaySoundAt SoundFX("fx_nudge",0),Apron
		If GKMM=0 AND VMOn=0 AND tilted=0 AND BIP>0 Then AddToTilt(RndNudge)
	End If
	If KeyCode=20 Then      'T key
		RndNudge=Rnd(1)/2
		RndNudge=RndNudge+4.5
		Nudge 0,RndNudge
		PlaySoundAt SoundFX("fx_nudge",0),Apron
		If GKMM=0 AND VMOn=0 AND tilted=0 AND BIP>0 Then AddToTilt(RndNudge)
	End If

'*****SLAM TILT**************************************************************
	If KeyCode=199 Then   ' HOME (slam tilt)
		PlaySound "V.red card"
		StopMusic
		DisableTable 1:Tilted=1:bonusP=0:bonus=0
		LightSeqTilt.Play SeqAllOff
		If subwall.Z > 140 Then TabletDown
		subwall.image = "sub_text"
		UDMD_Display "redcard.gif", " SLAM TILT ", 15,0,"",15,0,UltraDMD_Animation_None, 2000, UltraDMD_Animation_None,10
		' start the slam tilt timer which waits for all balls to return
		' before restarting the attract sequence
		SlamTilt.Interval=2000
		SlamTilt.Enabled=1
	End If

'*****NAME ENTERING **********************************************************
	If keycode = LeftFlipperKey AND NOT cursorPos=40 Then
		inChar=inChar-1:Playsound "fx_Next"
		if inChar<65 AND inChar>57 Then inChar=57
		if inChar<46 Then inChar=91
	End If

	If keycode = RightFlipperKey AND NOT cursorPos=40 Then
		inChar=inChar+1:Playsound "fx_Previous"
		if inChar>91 Then inChar=46
		if inChar>57 AND inChar<65 Then inChar=65
	End If

	If keycode = StartGameKey AND NOT cursorPos=40 Then
		if (inChar = 91 and cursorPos > 0) Then				'Set the backspace character
			cursorPos = cursorPos - 1						'Send cursor back
			initials(cursorPos) = 32						'Set that initial back to an empty SPACE
			Playsound "fx_Esc"
		End If
		if (inChar <> 91) Then								'Set a character, as long as it's not a backspace				
			initials(cursorPos) = inChar					'Set the character
			If inChar = 47 Then initials(cursorPos) = 32	'Set the space character
			cursorPos = cursorPos + 1
			Playsound "fx_Enter"
		End If
		if (cursorPos < 4) Then								'write the 3 characters				
			If cursorPos=3 Then nameEntryStart.Enabled=0:cursorPos=40:ExitHS.Interval=100:ExitHS.Enabled=1
		End If
	End If

'*****MUSIC VOLUME ***********************************************************
	If keycode = 9 AND NOT OptMenuEnabled Then					'key 8
		If optMusicVolume>0 Then optMusicVolume=optMusicVolume-0.1 Else optMusicVolume=0 End If
		MusicVolume=optMusicVolume
		If Not OptMusicEnabled AND cAttractMode=0 AND NOT UltraDMD.IsRendering Then
			UltraDMD.DisplayScene00ExWithID "MusVol",false, "black.bmp", "               ", 15, 0, "", 15, 0, UltraDMD_Animation_None, 2000, UltraDMD_Animation_None
			OptMusicEnabled=True
		End If
		If OptMusicEnabled Then UltraDMD.Modifyscene00 "MusVol", "  VOLUME: " &  optMusicVolume*10 & "  ", "":SCReset.Enabled=1
	End If

	If keycode = 10 AND NOT OptMenuEnabled Then					'key 9
		If optMusicVolume<1 Then optMusicVolume=optMusicVolume+0.1 Else optMusicVolume=1 End If
		MusicVolume=optMusicVolume
		If Not OptMusicEnabled AND cAttractMode=0 AND NOT UltraDMD.IsRendering Then
			UltraDMD.DisplayScene00ExWithID "MusVol",false, "black.bmp", "               ", 15, 0, "", 15, 0, UltraDMD_Animation_None, 2000, UltraDMD_Animation_None
			OptMusicEnabled=True
		End If
		If OptMusicEnabled Then UltraDMD.Modifyscene00 "MusVol", "  VOLUME: " &  optMusicVolume*10 & "  ", "":SCReset.Enabled=1
	End If

'*****OPTIONS MENU ***********************************************************
	ManageTableOptions(keycode)
End Sub

'***************************************************************************************************************************************
'***************************************************************************************************************************************

Sub Table1_KeyUp(ByVal keycode)
	If keycode = LeftFlipperKey AND GKMM=0 AND cAttractMode=0 AND VMOn=0 AND Tilted=0 Then
		LeftFlipper.RotateToStart
        LeftFlipper1.RotateToStart
		PlaySoundAt SoundFXDOF("fx_flipperdown", 101, DOFOff, DOFFlippers), LeftFlipper
	End If
    
	If keycode = RightFlipperKey AND GKMM=0 AND cAttractMode=0 AND VMOn=0 AND Tilted=0 Then
		RightFlipper.RotateToStart
        RightFlipper1.RotateToStart
		PlaySoundAt SoundFXDOF("fx_flipperdown", 102, DOFOff, DOFFlippers), RightFlipper
	End If

'****DISPLAY INFO ************************************************************
	If keycode = LeftFlipperKey Then
		DisplayInfoTimer.Enabled=0
		DisplayRulesTimer.Enabled=0
		If cInstantInfo Then
			CheckGameInfo.Enabled=0
			If UltraDMD.IsRendering Then UltraDMD.CancelRendering
			OnScoreboardChanged
			cInstantInfo=False
		End If
		If cGameRules Then cGameRules=False:RulesDT.visible=0:RulesFS.visible=0
	End If

	If keycode = RightFlipperKey Then
		DisplayInfoTimer.Enabled=0
		DisplayRulesTimer.Enabled=0
		If cInstantInfo Then
			CheckGameInfo.Enabled=0
			If UltraDMD.IsRendering Then UltraDMD.CancelRendering
			OnScoreboardChanged
			cInstantInfo=False
		End If
		If cGameRules Then cGameRules=False:RulesDT.visible=0:RulesFS.visible=0
	End If

'****GKMOVEMODE************************************************************
	If keycode = LeftFlipperKey AND GKMM=1 AND Tilted=0 Then 
		PlaySoundAt SoundFXDOF("fx_DropTargetDOWN",101,DOFOff,DOFFlippers),headGK
		headGK.X=437:bootsGK.X=437:bodyGK.X=437:kitGK.X=437:GKPOST.X=437
		For each ii in GkWalls:ii.IsDropped=1:Next
		GKwalls(4).isdropped=0:GKwalls(5).isdropped=0
	End If

	If keycode = RightFlipperKey AND GKMM=1 AND Tilted=0 Then 
		PlaySoundAt SoundFXDOF("fx_DropTargetDOWN",102,DOFOff,DOFFlippers),headGK
		headGK.X=437:bootsGK.X=437:bodyGK.X=437:kitGK.X=437:GKPOST.X=437
		For each ii in GkWalls:ii.IsDropped=1:Next
		GKwalls(4).isdropped=0:GKwalls(5).isdropped=0
	End If

'*HEAD MOVE**************************************************************
	If keycode = LeftFlipperKey AND Tilted=0 AND VMOn=1 Then HEADL.ENABLED=0
	If keycode = RightFlipperKey AND Tilted=0 AND VMOn=1 Then HEADR.ENABLED=0
End Sub

'************************************************************************
'***RELEASE NEW BALLS****************************************************
'************************************************************************
Dim SkillShotMode

Sub ReleaseNewBall
	BIP=BIP+1:maxballs(CurrentPlayer)=maxballs(CurrentPlayer)+1
	BallRelease.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:BallRelease.Kick 90, 7:PlaySoundAt SoundFXDOF("fx_ballrel",121,DOFPulse,DOFContactors),Ballrelease
	If shootagain=1 Then
		If UltraDMD.IsRendering Then UltraDMD.CancelRendering
		UDMD_Display "black.bmp", "SHOOT",14,-1,"AGAIN!",14,-1, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,10
		PlaySound "V.shootagain":kickagain=1
	End If
	Music
End Sub

Sub KGoalExit
	kickergoal.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:PlaySoundAt SoundFXDOF("fx_saucer_exit",122,DOFPulse,DOFContactors),kickergoal:kickergoal.Kick 0,10,1.56
	FlashForMs fl3,300,1000,0:FlashForMs fl3a,600,300,0:FlashForMs dome3,600,300,0:DOF 124,DOFPulse:MisterToyMove 3, 100
End Sub

Sub StartSkillshot
SkillShotMode=1:kickagain=1:kicked=0
'let's do some random eleasticity so the skillshot is not so simple
Gate1.Elasticity=(RndNum(25,40))/10       ' random number between 2.5 and 4
Lx1.state=0:Lx2.state=2
End Sub

'*********************************************************************
'*****KICK AGAIN******************************************************
'*********************************************************************
Dim ballInPlunger,kickcount,kickagain,kicked,BSaverAward:BSaverAward=0

Sub Dokickagain
	If kicked=0 AND kickagain=1 Then kickagain=0:kickagainT.enabled=0:kickcount=0:Lkag.state=1:TriggerKickAgain.enabled=1
End Sub

Sub TriggerKickAgain_Hit:Triggerkickagain.Enabled=0:kickagainT.enabled=1:End Sub			'used at bumpers exit

Sub kickagainT_timer()
    kickcount=kickcount+1
	If Lmultilock.state=1 OR BSaverAward=1 Then												'30 seconds ballsaver
		If Kickcount=250 Then Lkag.BlinkInterval=300:Lkag.state=2							'after 25 seconds
		If Kickcount=280 Then Lkag.BlinkInterval=100										'after 3 seconds
		If kickcount=300 Then Lkag.state=0:kickagaint.enabled=0:kicked=1:BSaverAward=0		'after 2 seconds

	ElseIf Lmultiticket.state=1 OR Lmultiskill.state=1 Then									'20 seconds ballsaver
		If Kickcount=150 Then Lkag.BlinkInterval=300:Lkag.state=2							'after 15 seconds
		If Kickcount=180 Then Lkag.BlinkInterval=100										'after 3 seconds
		If kickcount=200 Then Lkag.state=0:kickagaint.enabled=0:kicked=1					'after 2 seconds

	Else																					'10 seconds ballsaver
		If Kickcount=50 Then Lkag.BlinkInterval=300:Lkag.state=2							'after 5 seconds
		If Kickcount=80 Then Lkag.BlinkInterval=100											'after 3 seconds
		If kickcount=100 Then Lkag.state=0:kickagaint.enabled=0:kicked=1					'after 2 seconds
	End If
End Sub

Sub Drainkick
	BallRelease.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:BallRelease.Kick 90, 7:PlaySoundAt SoundFXDOF("fx_ballrel",121,DOFPulse,DOFContactors),Ballrelease
	'after 1 second fire the autoplunger
	Plunger.TimerInterval=1000:Plunger.TimerEnabled=1
	If Lx1.state=1 AND Lx2.state=1 Then Lx1.state=0:Lx2.state=0
	If Lmultilock.state=1 OR Lmultiticket.state=1 OR Lmultiskill.state=1 Then
		kickagain=0
	Else
		UDMD_Display "ballsaver.gif","",0,0,"",0,0,UltraDMD_Animation_None,3000,UltraDMD_Animation_FadeOut,10
		kickagainT.enabled=0:Lkag.state=0:kicked=1:kickagain=1:BSaverAward=0
	End If
End Sub

Sub Plunger_timer()
	Plunger.TimerEnabled=0
	Plunger.Fire:PlaySoundAt SoundFXDOF("fx_AutoPlunger", 125, DOFPulse, DOFContactors),Plunger
End Sub

Sub swPlunger_Hit:ballInPlunger = True:DOF 159, DOFOn:End Sub
Sub swPlunger_Unhit:ballInPlunger = False:DOF 159, DOFOff:End Sub

'************************************************************************
'* GAME INFO & RULES ****************************************************
'************************************************************************
Dim cInstantInfo, cGameRules
Dim Matches:Matches=Array("","qualify match"," group stage "," round of 16 "," qua. finals "," semifinals  ","    final    ")

Sub DisplayInfoTimer_timer
	'after 7 seconds
	Me.Enabled=0
	cInstantInfo=True
	CheckGameInfo.Enabled=0
	If UltraDMD.IsRendering Then UltraDMD.CancelRendering
	UltraDMD.DisplayScene00Ex ""," STATUS REPORT ",14,-1,"",14,1,UltraDMD_Animation_None,2000,UltraDMD_Animation_None
	CheckGameInfo.Enabled=1
End Sub

Sub CheckGameInfo_Timer
    If cInstantInfo Then
		ShowGameInfo
    ElseIf NOT UltraDMD.IsRendering Then
		Me.Enabled=0
		UltraDMD.CancelRendering
		OnScoreboardChanged
    End If
End Sub

Sub ShowGameInfo
	UltraDMD.DisplayScene00Ex "","  REPLAY AT    ",14,-1,bestscores(0),14,1,UltraDMD_Animation_None,2000,UltraDMD_Animation_None
	UltraDMD.DisplayScene00Ex "","  EXTRABALLS   ",14,-1,extraball(CurrentPlayer),14,1,UltraDMD_Animation_None,2000,UltraDMD_Animation_None
	UltraDMD.DisplayScene00Ex "","  PLAYING THE  ",14,-1,Matches(defencestate(CurrentPlayer)),14,1,UltraDMD_Animation_None,2000,UltraDMD_Animation_None
	UltraDMD.DisplayScene00Ex "","  EXTRABALL AT ",14,-1," THE SEMIFINAL ",14,1,UltraDMD_Animation_None,2000,UltraDMD_Animation_None
	UltraDMD.DisplayScene00Ex "","  FK SCORED " & FKGoal(CurrentPlayer) &"  " ,14,-1," EX.BALL AT 3  ",14,1,UltraDMD_Animation_None,2000,UltraDMD_Animation_None
	UltraDMD.DisplayScene00Ex "","  FK AWARD AT  ",14,-1,"  5 FK SCORES  ",14,1,UltraDMD_Animation_None,2000,UltraDMD_Animation_None
	UltraDMD.DisplayScene00Ex "","  BUMPERS LVL " & JetLevel(CurrentPlayer),14,-1," EX.BALL AT 6  ",14,1,UltraDMD_Animation_None,2000,UltraDMD_Animation_None
	UltraDMD.DisplayScene00Ex "","  BALLON DOR:  ",14,-1," " & (5-completed(CurrentPlayer)) & " MODES TO GO ",14,1,UltraDMD_Animation_None,2000,UltraDMD_Animation_None
End Sub

Sub DisplayRulesTimer_Timer
	'after 5 seconds shows the game rules
	Me.Enabled=0
	cGameRules=True
	If Table1.ShowDT Then RulesDT.visible=1 Else RulesFS.visible=1 End If
End Sub

'************************************************************************
'***ADD NEW PLAYERS******************************************************
'************************************************************************
Sub AddNewPlayers
	If creditgame=0 AND FreePlay=0 Then
		DisplayIntro.Enabled=0:DisplayIntroHS.Enabled=0:DisplayStartScreen.Enabled=0:displaystart=0:StopMusic:UltraDMD.CancelRendering:DOF 150, DOFOff
		UltraDMD.DisplayScene00Ex "coin.gif", "", 10, -1,"", -1, 10, UltraDMD_Animation_ScrollOnUp, 6000, UltraDMD_Animation_ScrollOffDown
		If cAttractMode=1 then DisplayIntro.enabled=1
	End If
	If creditgame>0 or FreePlay=1 Then
		If NewPlayer<4 Then
			CheckTeamSelect.Enabled=0:Stopsound "0_highscore":Playsound "0_highscore"
			If cAttractMode=1 Then DisplayIntroHS.Enabled=0:DisplayIntro.Enabled=0:DisplayStartScreen.Enabled=0:displaystart=0:StopMusic
			If UltraDMD.IsRendering Then UltraDMD.CancelRendering
			If FreePlay=0 Then creditgame=creditgame-1
			NewPlayer=NewPlayer+1
			UltraDMD.DisplayScene00Ex "","WELCOME", 14, -1, "PLAYER " & (NewPlayer), 14, -1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_None
			CheckTeamSelect.Enabled=1
		End If
	End If
End Sub

Sub CheckTeamSelect_Timer
		If NOT UltraDMD.IsRendering AND cAttractMode=0 Then
			Me.Enabled=0
			If TeamSelection=1 Then SelectTheTeam:exit sub
			If TeamSelection=0 Then OnScoreboardChanged:exit sub
		End If
		If NOT UltraDMD.IsRendering AND cAttractMode=1 Then Me.Enabled=0:StopAttractMode:TeamSelection=1:SelectTheTeam:exit sub
End Sub

Sub SelectTheTeam
	For Each ii in TeamLogos:StopFlash ii,0:Next
	screenprim1.visible=1:screenprim.image="logo" & choiceteam(CurrentPlayer):TeamLogos(3).imageA="logo" & choiceteam(CurrentPlayer):Flash TeamLogos(3),250:StopSound "CLAPPING2":PlaySound "CLAPPING2"
	UltraDMD.DisplayScene00Ex "logo" & choiceteam(CurrentPlayer) &".png","SELECT YOUR TEAM", 14, 3, TeamList(choiceteam(CurrentPlayer)-1), 1, 14, UltraDMD_Animation_None, 999999, UltraDMD_Animation_None
End Sub

Sub PlayerCheck
	If shootagain=0 Then
		If canrelease=0 Then
			If cBonusM=1 Then
				DisplayBonus
			Else
				CheckHS
				If HSPlace>=0 Then
					cursorPOS=0:nameEntry:nameEntryStart.Enabled=1
					PlaySound "0_highscore":FlasherEffect 8
					Music
				Else
					If NewPlayer>CurrentPlayer+1 Then
						AdvancePlayer
					Else
						DisplayMatch
					End If
				End If
			End If
		End If
		If canrelease=1 Then
			If cBonusM=1 Then
				DisplayBonus
			Else
				If NewPlayer=CurrentPlayer+1 Then SelectedTeams=1
				AdvancePlayer
			End If
		End If
	Else
		ReleaseNewBall
		If extraball(CurrentPlayer)=0 Then StopFlash TDFL1,0
	End If
End Sub

Sub AdvancePlayer
	If NewPlayer>1 Then ResetPlayerStatus
	If NewPlayer>CurrentPlayer+1 Then CurrentPlayer=CurrentPlayer+1:Else CurrentPlayer=0:End If
	If NewPlayer>1 Then UltraDMD.DisplayScene00 "", "PLAYER " & (CurrentPlayer+1), 15, "IS UP",15,UltraDMD_Animation_None,1500,UltraDMD_Animation_None
	If SelectedTeams=0 Then
		TeamSelection=1:CheckTeamSelect.Enabled=1
		'init multiball lights
		Llock.state=2:Llock1.state=2:Llock2.state=2:Llock3.state=2
		skill1.state=2:skill2.state=2:skill3.state=2
		ticket1.state=2:ticket2.state=2:ticket3.state=2
	Else
		Ballrelease.TimerInterval=100:Ballrelease.TimerEnabled=1
	End If
End Sub

Sub Ballrelease_timer
	If Not UltraDMD.IsRendering AND resetcomplete=1 Then
		Me.TimerEnabled=0
		If NewPlayer>1 Then UpdatePlayerStatus
		ReleaseNewBall:StartSkillshot:OnScoreboardChanged
	End If
End Sub

'************************************************************************
'*BONUS COUNTING*********************************************************
'************************************************************************
Dim cBonusM,bonus,bonuscount,bonusP,fakescore,BonusToAdd,canrelease

Sub DisplayBonus
	BonusToAdd=bonusP:bonusT.enabled=1
	PlaySound "eob-gameover",-1,1,0,0
	If Len(bonusP)<7 Then					'bonus is less than 1 million
		UltraDMD.DisplayScene00ExWithId "bonusdrain",false, "bonus.wmv", formatnumber(scores(CurrentPlayer),0), 15, 0, formatnumber(bonusP,0), 15, 0, UltraDMD_Animation_None, 26000, UltraDMD_Animation_None
	Else
		UltraDMD.DisplayScene00ExWithId "bonusdrain",false, "bonus-ext.wmv", formatnumber(scores(CurrentPlayer),0), 15, 0, formatnumber(bonusP,0), 15, 0, UltraDMD_Animation_None, 52000, UltraDMD_Animation_None
	End If
End Sub

Sub bonusT_timer()
	fakescore=scores(CurrentPlayer)+bonuscount*100
	bonuscount=bonuscount+1
	bonusP=bonusP-bonuscount*100
	If bonusp>0 Then PlaySound "fx_flip_hit_1":UltraDMD.ModifyScene00 "bonusdrain", formatnumber(fakescore,0), formatnumber(bonusP,0) Else bonusfinish:exit sub:End If
End Sub

Sub bonusfinish
	bonusT.enabled=0:StopSound "eob-gameover"
	GiOn:scores(CurrentPlayer)=scores(CurrentPlayer)+BonusToAdd
	bonus=0:bonusP=0:bonuscount=0:FAKESCORE=0:cBonusM=0
	UltraDMD.CancelRendering:PlayerCheck
End Sub

'************************************************************************
'****DRAIN RULES ********************************************************
'************************************************************************
Dim shootagain,ogscene

Sub Drain_timer
	Me.timerEnabled=0
	kicked=0:TiltWarnings=0:PlayerCheck
End Sub

Sub WallDrain_timer
	WallDrain.TimerEnabled=0
	WallDrain.IsDropped=1
End Sub

Sub Drain_Hit()
	PlaySoundAt "fx_drain",ActiveBall
	Drain.DestroyBall
	If GKMM=0 AND Lkag.state=0 Then BIP=BIP-1
	WallDrain.IsDropped=0
	WallDrain.TimerInterval=1500
	WallDrain.TImerEnabled=1
	If BIP<0 Then BIP=0
	If GKMM=0 AND BIP=0 AND extraball(CurrentPlayer)=0 AND maxballs(CurrentPlayer)<(BallsPerGame + extraballmax(CurrentPlayer)) AND Lkag.state=0 Then
		ballinplay(CurrentPlayer)=ballinplay(CurrentPlayer)+1
		canrelease=1:shootagain=0
		If Tilted=0 Then
			ogscene=RndNum(1,3)
			UltraDMD.CancelRendering
			UltraDMD.DisplayScene00Ex "owngoal" & ogscene & ".gif", "",14,-1, "",14,-1, UltraDMD_Animation_None, 1400, UltraDMD_Animation_None
			PlaySound "DelusioneParata"
			Drain.TimerInterval=2000:Drain.TimerEnabled=1
			GiOff:StopMusic:cBonusM=1
		End If
	End If

	If GKMM=0 AND BIP=0 AND extraball(CurrentPlayer)>0 AND maxballs(CurrentPlayer)<(BallsPerGame + extraballmax(CurrentPlayer)) AND Lkag.state=0 Then
		extraball(CurrentPlayer)=extraball(CurrentPlayer)-1
		canrelease=1:shootagain=1
		If Tilted=0 Then PlaySound "DelusioneParata":Drain.TimerInterval=1000:Drain.TimerEnabled=1
	End If

	If GKMM=0 AND BIP=0 AND maxballs(CurrentPlayer)=(BallsPerGame + extraballmax(CurrentPlayer)) AND Lkag.state=0 Then
		canrelease=0:shootagain=0
		If Tilted=0 Then
			ogscene=RndNum(1,3)
			UltraDMD.CancelRendering
			UltraDMD.DisplayScene00Ex "owngoal" & ogscene & ".gif", "",14,-1, "",14,-1, UltraDMD_Animation_None, 1400, UltraDMD_Animation_None
			PlaySound "DelusioneParata"
			Drain.TimerInterval=2000:Drain.TimerEnabled=1
			StopFlash lClWin,0:UpdateB2SLogos
			For each ii in VMFlashers:StopFlash ii,0:Next
			GiOff:StopMusic:cBonusM=1
		End If
	End If

If Tilted=0 Then
 '*MISTER MULTIBALL RULES************************************************************
    If GKMM=0 AND BIP<2 AND Lmultilock.state=1 AND Lkag.state=0 Then
		If lockcomplete.state=0 Then
			If UltraDMD.IsRendering Then UltraDMD.CancelRendering
			UDMD_Display "conte.gif", "",14,-1, "",14,-1, UltraDMD_Animation_None, 2000, UltraDMD_Animation_None,6
		End If
		MisterToyMove 8,100
		superjackpot.state=0 
		lockjackpot.state=0
		ticketjackpot.state=0
		skilljackpot.state=0
		Llock.state=2:Llock1.state=2:llock2.state=2:Llock3.state=2
		Lmultilock.state=0
		TabletDown
		TicketDiverter True
		njack=0:kicked=0:bonus=0
		LockMultiMode=0
		Music
		If LockMScore>LockMScoreBest(CurrentPlayer) Then LockMScoreBest(CurrentPlayer)=LockMScore
		LockMScore=0
    End If

'*TICKET MULTIBALL RULES************************************************************
    If GKMM=0 AND TicketMultiMode=1 AND Lkag.state=0 Then TicketDiverter False
    If GKMM=0 AND BIP<2 AND lmultiticket.state=1 AND Lkag.state=0 Then
		If ticketcomplete.state=0 Then
			If UltraDMD.IsRendering Then UltraDMD.CancelRendering
			UDMD_Display "invader.gif", "",14,-1, "",14,-1, UltraDMD_Animation_None, 2100, UltraDMD_Animation_None,6
		End If
		superjackpot.state=0
		ticketjackpot.state=0
		ticket1.state=2:ticket2.state=2:ticket3.state=2
		lmultiticket.state=0
		TicketDiverter True 
		ticket=0:kicked=0:bonus=0
		TicketMultiMode=0
		Music
    End If 

'*SKILL MULTIBALL RULES************************************************************
    If GKMM=0 AND BIP<2 AND lmultiskill.state=1 AND Lkag.state=0 Then
		If skillcomplete.state=0 Then
			If UltraDMD.IsRendering Then UltraDMD.CancelRendering
			UDMD_Display "fail.gif", "",14,-1, "",14,-1, UltraDMD_Animation_None, 1850, UltraDMD_Animation_None,6
		End If 
		superjackpot.state=0
		skilljackpot.state=0
		skill1.state=2:skill2.state=2:skill3.state=2
		lmultiskill.state=0
		TicketDiverter True
		skill=0:kicked=0:bonus=0
		SkillMultiMode=0
		Music
    End If
'*GK MODE RULES************************************************************
	If GKMM=1 Then Draingkmm

'*KICK AGAIN RULES************************************************************
	If GKMM=0 AND kicked=0 AND Lkag.state<>0 Then DrainKick
End If
End Sub

'************************************************************************
'****SLING***************************************************************
'************************************************************************
Dim RStep, Lstep
Sub LeftSlingShot_Slingshot
If Tilted=0 Then
	FlashForMs fl2,100,50,0:FlashForMs fl2a,100,50,0:FlashForMs dome2,100,50,0:B2SEffect B2SLight2,2,100
	DOF 140, DOFPulse
  	PlaySoundAt SoundFXDOF("fx_slingshotL",103,DOFPulse,DOFContactors),ActiveBall
    scores(CurrentPlayer)=scores(CurrentPlayer)+2580
    LSling.Visible = 0
    LSling1.Visible = 1
    sling1.TransZ = -20
    LStep = 0
    Me.TimerEnabled = 1
	OnScoreboardChanged
End If
End Sub

Sub LeftSlingShot_Timer
    Select Case LStep
        Case 3:LSLing1.Visible = 0:LSLing2.Visible = 1:sling1.TransZ = -10
        Case 4:LSLing2.Visible = 0:LSLing.Visible = 1:sling1.TransZ = 0:Me.TimerEnabled = 0
    End Select
    LStep = LStep + 1
End Sub

Sub RightSlingShot_Slingshot
If Tilted=0 Then
	FlashForMs fl1,100,50,0:FlashForMs fl1a,100,50,0:FlashForMs dome1,100,50,0:B2SEffect B2SLight1,2,100
	DOF 142, DOFPulse
  	PlaySoundAt SoundFXDOF("fx_slingshotR",105,DOFPulse,DOFContactors), ActiveBall
    scores(CurrentPlayer)=scores(CurrentPlayer)+2580
    RSling.Visible = 0
    RSling1.Visible = 1
    sling2.TransZ = -20
    RStep = 0
    Me.TimerEnabled = 1
	OnScoreboardChanged
End If
End Sub

Sub RightSlingShot_Timer
    Select Case RStep
        Case 3:RSLing1.Visible = 0:RSLing2.Visible = 1:sling2.TransZ = -10
        Case 4:RSLing2.Visible = 0:RSLing.Visible = 1:sling2.TransZ = 0:Me.TimerEnabled = 0
    End Select
    RStep = RStep + 1
End Sub

'************************************************************************
'****SPINNER*************************************************************
'************************************************************************
Sub Spinner1_Spin()
	PlaySoundAt "fx_spinner",Spinner1
If Tilted=0 Then
    scores(CurrentPlayer)=scores(CurrentPlayer)+1530
    OnScoreboardChanged
End If
End Sub

Sub Spinner2_Spin
Spinner1_Spin
End Sub

'************************************************************************
'****SIDE LANES**********************************************************
'************************************************************************
Sub LeftOutLane_Hit
PlaySoundAt "fx_sensor",ActiveBall
DOF 153, DOFPulse
If Tilted=0 Then
    scores(CurrentPlayer)=scores(CurrentPlayer)+5000
End If
End Sub

Sub RightOutLane_Hit
PlaySoundAt "fx_sensor",ActiveBall
DOF 156, DOFPulse
If Tilted=0 Then
    scores(CurrentPlayer)=scores(CurrentPlayer)+5000
End If
End Sub

Sub LeftInLane_Hit
PlaySoundAt "fx_sensor",ActiveBall
DOF 154, DOFPulse
If Tilted=0 Then
    If NOT moveGK.Enabled AND NOT (Lmultilock.state=1 OR Lmultiskill.state=1 OR Lmultiticket.state=1) AND HEADGK.Z>0 AND MVPOfTheYear(CurrentPlayer)=0 Then L21.STATE=1
    scores(CurrentPlayer)=scores(CurrentPlayer)+5000:OnScoreboardChanged
    If  L20.STATE=1 AND L21.STATE=1 AND gkmm=0 AND NOT moveGK.Enabled AND NOT (Lmultilock.state=1 OR Lmultiskill.state=1 OR Lmultiticket.state=1) Then
		If UltraDMD.IsRendering Then UltraDMD.CancelRendering
		PlaySound "fischio":PlaySound "V.freekick":waitforkick.Enabled=1:L21.STATE=0:L20.STATE=0:FK=1
		For each ii in TeamLogos:StopFlash ii,0:Next
		SCFrame.opacity=100:SCFrame.imageA="LCD_freekick":SCFrame.visible=1
		lpin.isdropped=0:rpin.isdropped=0:PlaySoundAt SoundFXDOF("fx_postup",133,DOFPulse,DOFDropTargets), Apron
		UltraDMD.DisplayScene00Ex "freekick.png","FREE KICK      ", 14,-1,"",14,-1, UltraDMD_Animation_ScrollOnUp, 2500, UltraDMD_Animation_ScrollOffDown
		UltraDMD.DisplayScene00Ex "crfreekick.gif", "", 14,-1,"",14,-1, UltraDMD_Animation_None, 2500, UltraDMD_Animation_FadeOut
		SaveMatchLampStates:ArrowEffect True
		GiOff
		If FKGoal(CurrentPlayer)=0 Then Flash FKFl1,150:exit sub
		If FKGoal(CurrentPlayer)=1 Then Flash FKFL2,150:exit sub
		If FKGoal(CurrentPlayer)=2 Then Flash FKFL3,150:exit sub
		If FKGoal(CurrentPlayer)=3 Then Flash FKFL4,150:exit sub
		If FKGoal(CurrentPlayer)=4 Then Flash FKFL5,150:exit sub
	End If
End If
End Sub

Sub RightInLane_Hit
PlaySoundAt "fx_sensor", ActiveBall
DOF 155, DOFPulse
If Tilted=0 Then  
    If NOT moveGK.Enabled AND NOT (Lmultilock.state=1 OR Lmultiskill.state=1 OR Lmultiticket.state=1) AND HEADGK.Z>0 AND MVPOfTheYear(CurrentPlayer)=0 Then L20.STATE=1
    If GKMM=0 Then scores(CurrentPlayer)=scores(CurrentPlayer)+5000:OnScoreboardChanged
    If  L20.STATE=1 AND L21.STATE=1 AND gkmm=0 AND NOT moveGK.Enabled AND NOT (Lmultilock.state=1 OR Lmultiskill.state=1 OR Lmultiticket.state=1) Then
		If UltraDMD.IsRendering Then UltraDMD.CancelRendering
		PlaySound "fischio":PlaySound "V.freekick":waitforkick.Enabled=1:L21.STATE=0:L20.STATE=0:FK=1
		For each ii in TeamLogos:StopFlash ii,0:Next
		SCFrame.opacity=100:SCFrame.imageA="LCD_freekick":SCFrame.visible=1
		lpin.isdropped=0:rpin.isdropped=0:PlaySoundAt SoundFXDOF("fx_postup",133,DOFPulse,DOFDropTargets), Apron
		UltraDMD.DisplayScene00Ex "freekick.png","FREE KICK      ", 14,-1,"",14,-1, UltraDMD_Animation_ScrollOnUp, 2500, UltraDMD_Animation_ScrollOffDown
		UltraDMD.DisplayScene00Ex "crfreekick.gif", "", 14,-1,"",14,-1, UltraDMD_Animation_None, 2500, UltraDMD_Animation_FadeOut
		SaveMatchLampStates:ArrowEffect True
		GiOff
		If FKGoal(CurrentPlayer)=0 Then Flash FKFl1,150:exit sub
		If FKGoal(CurrentPlayer)=1 Then Flash FKFL2,150:exit sub
		If FKGoal(CurrentPlayer)=2 Then Flash FKFL3,150:exit sub
		If FKGoal(CurrentPlayer)=3 Then Flash FKFL4,150:exit sub
		If FKGoal(CurrentPlayer)=4 Then Flash FKFL5,150:exit sub
	End If
End If
End Sub

Dim FK,wfk
Sub waitforkick_timer()
    wfk=wfk+1
	If TDExit=1 Then
		If wfk=10 Then tdfcolor=4:OpenTrapDoor True:RightInLane.Enabled=0
		If wfk=15 Then trapkicker.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:trapkicker.Kick 180,25,1.56:TrapKickBall
		If wfk=20 Then OpenTrapDoor False 
		If wfk=60 Then TDExit=0:RightInLane.Enabled=1
	End If
    If wfk=55 Then corner.Enabled=1
    If wfk=65 Then PlaySound "fischio":GiOn:SCFrame.visible=0:SCFrame.imageA="":UpdateTeamLogos:StopFlash TeamLogos(3),1
    If wfk=70 Then lpin.isdropped=1:rpin.isdropped=1:PlaySoundAt SoundFXDOF("fx_postdown",133,DOFPulse,DOFDropTargets),Apron:waitforkick.enabled=0:wfk=0:UltraDMD.CancelRendering:OnScoreboardChanged:exit sub
End Sub

'*********************************************************************
'*****CORNER**********************************************************
'*********************************************************************
Dim dcont,cornvel

Sub CornerModeOn:If NOT moveGK.enabled AND Lgoal2.state=0 Then Lcorner.state=1:End If:End Sub
Sub CornerModeOff:Lcorner.state=0:End Sub

Sub triggercorner_hit
	PlaySoundAt "fx_sensor", ActiveBall
	If NOT moveGK.enabled AND Lgoal2.state=0 AND Lcorner.state=1 Then
		SaveMatchLampStates:ArrowEffect True
		LcornerShoot.state=2:corner.enabled=1:PlaySound "V.corner"
		UDMD_Display "corner.gif", "", 15, 0, "", 15, 0, UltraDMD_Animation_ScrollOnDown, 1300, UltraDMD_Animation_ScrollOffDown,7
		FlashForMs fl3,2000,50,0:FlashForMs fl3a,2000,50,0:FlashForMs dome3,2000,50,0:B2SEffect B2SLight2,2,50
		DOF 144, DOFPulse
	End If
End Sub

Sub corner_timer()
	If liftD.rotx>0 AND headdef1.z<-50 Then liftD.rotx=liftD.rotx-1
	If sup3.z>-120  AND headdef1.z<-50 Then sup3.z=sup3.z-0.4
	If sup4.z>-120 AND headdef1.z<-50  Then sup4.z=sup4.z-0.4
	dcont=dcont+1
	cornvel=cornvel+0.1
	Lshoot.state=2
	moveGK.enabled=1
	If headDEF1.z>-170 Then headDEF1.z=headDEF1.z-cornvel:bodyDEF1.z=bodyDEF1.z-cornvel:bootsDEF1.z=bootsDEF1.z-cornvel:kitDEF1.z=kitDEF1.z-cornvel:defpost.z=defpost.z-cornvel:LdefL.Height=headDEF1.Z+100
	If headDEF2.z>-170 Then headDEF2.z=headDEF2.z-cornvel:bodyDEF2.z=bodyDEF2.z-cornvel:bootsDEF2.z=bootsDEF2.z-cornvel:kitDEF2.z=kitDEF2.z-cornvel:LdefC.Height=headDEF2.Z+100
	If headDEF3.z>-170 Then headDEF3.z=headDEF3.z-cornvel:bodyDEF3.z=bodyDEF1.z-cornvel:bootsDEF3.z=bootsDEF3.z-cornvel:kitDEF3.z=kitDEF3.z-cornvel:LdefR.Height=headDEF3.Z+100
	If headDef1.z<-169 Then defL.state=0:defC.state=0:defR.state=0: defenderL.isdropped=1:defenderC.isdropped=1:defenderR.isdropped=1:Wall35.isdropped=1
	If dcont>100*CornerTime Then corner.enabled=0:cornvel=0:dcont=0:cornerclose.enabled=1:exit sub
End Sub

Sub cornerclose_timer()
	If liftD.rotx<90 Then liftD.rotx=liftD.rotx+2
	If sup3.z<-80 Then sup3.z=sup3.z+0.8
	If sup4.z<-80 Then sup4.z=sup4.z+0.8
	LcornerShoot.state=0
	moveGK.enabled=0:ResetGK
	cornvel=cornvel-0.1
	Lshoot.state=0
	defenderL.isdropped=0:defenderC.isdropped=0:defenderR.isdropped=0::Wall35.isdropped=0
	headDEF1.z=headDEF1.z-cornvel:bodyDEF1.z=bodyDEF1.z-cornvel:bootsDEF1.z=bootsDEF1.z-cornvel:kitDEF1.z=kitDEF1.z-cornvel:defpost.z=defpost.z-cornvel:LdefL.Height=headDEF1.Z+100
	headDEF2.z=headDEF2.z-cornvel:bodyDEF2.z=bodyDEF2.z-cornvel:bootsDEF2.z=bootsDEF2.z-cornvel:kitDEF2.z=kitDEF2.z-cornvel:LdefC.Height=headDEF2.Z+100
	headDEF3.z=headDEF3.z-cornvel:bodyDEF3.z=bodyDEF1.z-cornvel:bootsDEF3.z=bootsDEF3.z-cornvel:kitDEF3.z=kitDEF3.z-cornvel:LdefC.Height=headDEF3.Z+100
	If headDEF1.z>12 Then
		If FK=1 Then FK=0
		ArrowEffect False:RestoreMatchLampStates
		dcont=0:cornvel=0:cornerclose.enabled=0:ResetGKTimer.enabled=0
		If FKGoal(CurrentPlayer)=0 Then StopFlash FKFL1,0:exit sub
		If FKGoal(CurrentPlayer)=1 Then StopFlash FKFL2,0:exit sub
		If FKGoal(CurrentPlayer)=2 Then StopFlash FKFL3,0:exit sub
		If FKGoal(CurrentPlayer)=3 Then StopFlash FKFL4,0:exit sub
		If FKGoal(CurrentPlayer)=4 Then StopFlash FKFL5,0:exit sub
		If FKGoal(CurrentPlayer)>4 Then exit sub
	End If
End Sub

'************************************************************************
'****MULTIPLIER**********************************************************
'************************************************************************
Sub swlx1_hit
	PlaySoundAt "fx_sensor", ActiveBall
	DOF 157, DOFPulse
	If Tilted=0 AND SkillShotMode=0 Then
		scores(CurrentPlayer)=scores(CurrentPlayer)+520:OnScoreboardChanged
		Lx1.state=1
		If lx2.state=1 Then
			FlashForMs Lx1,1500,100,0
			FlashForMs Lx2,1500,100,0
			If bonus<10 Then bonus=bonus+2 
			PlaySound "bumpmult"
			UltraDMD.Clear
			UDMD_Display "bonusX.gif", "BUMPERS", 15,0, "X" & bonus, 15,0 ,UltraDMD_Animation_None, 1500, UltraDMD_Animation_None,3
		End If
	End If
	If Tilted=0 AND SkillShotMode=1 Then
		If lx1.state=2 Then
			SkillShotMade(CurrentPlayer)=SkillShotMade(CurrentPlayer)+1:lx1.state=0
			FlashForMs Lx1,1500,100,0
			FlashForMs Lx2,1500,100,0
			PlaySound "skillgingle"
			If SkillShotMade(CurrentPlayer)>0 AND SkillShotMade(CurrentPlayer)<3 Then
				UDMD_Display "ssleft.gif", "SKILLSHOT", 0,14, formatnumber(150000*ballinplay(CurrentPlayer),0), 0,-1 ,UltraDMD_Animation_None, 2400, UltraDMD_Animation_None,7
				scores(CurrentPlayer)=scores(CurrentPlayer)+150000*ballinplay(CurrentPlayer)
			End If
			If SkillShotMade(CurrentPlayer)=3 Then
				UDMD_Display "ssleft.gif", "", 0,14, " 1 MILLION", 0,-1 ,UltraDMD_Animation_None, 2400, UltraDMD_Animation_None,7
				scores(CurrentPlayer)=scores(CurrentPlayer)+1000000
				SkillShotMade(CurrentPlayer)=0
			End If
		Else
			scores(CurrentPlayer)=scores(CurrentPlayer)+520:OnScoreboardChanged:lx1.state=0:lx2.state=0
		End If
		SkillShotMode=0
	End If
End Sub

Sub swlx2_hit
	PlaySoundAt "fx_sensor", ActiveBall
	DOF 158, DOFPulse
	If Tilted=0 AND SkillShotMode=0 Then
		scores(CurrentPlayer)=scores(CurrentPlayer)+520:OnScoreboardChanged
		Lx2.state=1
		If lx1.state=1 Then 
			FlashForMs Lx1,1500,100,0
			FlashForMs Lx2,1500,100,0
			If bonus<10 Then bonus=bonus+2 
			PlaySound "bumpmult"
			UltraDMD.Clear
			UDMD_Display "bonusX.gif", "BUMPERS", 15,0, "X" & bonus, 15,0, UltraDMD_Animation_None, 1500, UltraDMD_Animation_None,3
		End If
	End If
	If Tilted=0 AND SkillShotMode=1 Then
		If lx2.state=2 Then
			SkillShotMade(CurrentPlayer)=SkillShotMade(CurrentPlayer)+1:lx2.state=0
			FlashForMs Lx1,1500,100,0
			FlashForMs Lx2,1500,100,0
			PlaySound "skillgingle"
			If SkillShotMade(CurrentPlayer)>0 AND SkillShotMade(CurrentPlayer)<3 Then
				UDMD_Display "ssright.gif", "SKILLSHOT", 0,14, formatnumber(150000*ballinplay(CurrentPlayer),0), 0,-1 ,UltraDMD_Animation_None, 2400, UltraDMD_Animation_None,7
				scores(CurrentPlayer)=scores(CurrentPlayer)+150000*ballinplay(CurrentPlayer)
			End If
			If SkillShotMade(CurrentPlayer)=3 Then
				UDMD_Display "ssright.gif", "", 0,14, " 1 MILLION", 0,-1 ,UltraDMD_Animation_None, 2400, UltraDMD_Animation_None,7
				scores(CurrentPlayer)=scores(CurrentPlayer)+1000000
				SkillShotMade(CurrentPlayer)=0
			End If
		Else
			scores(CurrentPlayer)=scores(CurrentPlayer)+520:OnScoreboardChanged:lx1.state=0:lx2.state=0
		End If
		SkillShotMode=0
	End If
End Sub

'************************************************************************
'****BUMPERS*************************************************************
'************************************************************************
Dim num,BumpScore,FormatScore,dmd_bumpers,dmd_bumpersLvl6

Sub CheckFormatScore
Select Case len(formatnumber(scores(CurrentPlayer),0))
Case 1		'x
FormatScore="             " & formatnumber(scores(CurrentPlayer),0)
Case 2		'xx
FormatScore="            " & formatnumber(scores(CurrentPlayer),0)
Case 3		'xxx
FormatScore="           " & formatnumber(scores(CurrentPlayer),0)
Case 5		'x.xxx
FormatScore="         " & formatnumber(scores(CurrentPlayer),0)
Case 6		'xx.xxx
FormatScore="        " & formatnumber(scores(CurrentPlayer),0)
Case 7		'xxx.xxx
FormatScore="       " & formatnumber(scores(CurrentPlayer),0)
Case 9		'x.xxx.xxx
FormatScore="     " & formatnumber(scores(CurrentPlayer),0)
Case 10		'xx.xxx.xxx
FormatScore="    " & formatnumber(scores(CurrentPlayer),0)
Case 11		'xxx.xxx.xxx
FormatScore="   " & formatnumber(scores(CurrentPlayer),0)
Case 13		'x.xxx.xxx.xxx
FormatScore=" " & formatnumber(scores(CurrentPlayer),0)
End Select
End Sub

Sub Bumper1_Hit
    'converts image list to animation
	Dim dmd_bumpers,dmd_bumpersLvl6
	dmd_bumpers=UltraDMD.CreateAnimationFromImages (15, true, "bump1.png,bump2.png,bump3.png")
	dmd_bumpersLvl6=UltraDMD.CreateAnimationFromImages (15, true, "bump6_1.png,bump6_2.png,bump6_3.png,bump6_4.png,bump6_5.png,bump6_6.png")
If Tilted=0 Then
  	PlaySoundAt SoundFXDOF("fx_bumperL",107,DOFPulse,DOFContactors), ActiveBall
	FlashForMs fl2, 100, 50, 0:FlashForMs fl2a, 100, 50, 0:FlashForMs dome2, 100, 50, 0:FlashForMs light30, 100, 50, 0:B2SEffect B2SLight2,1,50

	DOF 140, DOFPulse:CheckFormatScore
    If bonus>0 Then scores(CurrentPlayer)=scores(CurrentPlayer)+BumpScore*bonus:bonusP=bonusP+BumpScore
    If bonus<2 Then scores(CurrentPlayer)=scores(CurrentPlayer)+BumpScore:bonusP=bonusP+BumpScore
    numBump(CurrentPlayer)=numBump(CurrentPlayer)+1
	num=100-numBump(CurrentPlayer)
	If numBump(CurrentPlayer) = 100 Then numBump(CurrentPlayer)=0:JetLevel(CurrentPlayer)=JetLevel(CurrentPlayer)+1
    If JetLevel(CurrentPlayer)<6 Then
		If Not UltraDMD.IsRendering Then
				UltraDMD.DisplayScene00ExWithId "bumper", false, dmd_bumpers,"    " & num & "        " & (JetLevel(CurrentPlayer)+1), 14, 2,FormatScore, 14, 2, UltraDMD_Animation_None, 1900, UltraDMD_Animation_None
			SCReset.Enabled=1
		End If
		'2 digits
		If num>9 Then UltraDMD.ModifyScene00 "bumper","    " & num & "        " & (JetLevel(CurrentPlayer)+1),FormatScore
		'1 digit
		If num<10 Then UltraDMD.ModifyScene00 "bumper","     " & num & "        " & (JetLevel(CurrentPlayer)+1),FormatScore
		FlashForMs Lbump1, 100, 80, 0
		FlashForMs Lbump2, 100, 80, 0
		FlashForMs Lbump3, 100, 80, 0
    End If
	If JetLevel(CurrentPlayer)=1 Then BumpScore=1510
	If JetLevel(CurrentPlayer)=2 Then BumpScore=2530
	If JetLevel(CurrentPlayer)=3 Then BumpScore=5000
	If JetLevel(CurrentPlayer)=4 Then BumpScore=7500
	If JetLevel(CurrentPlayer)>=5 Then BumpScore=10000
	If JetLevel(CurrentPlayer)=2 AND numBump(CurrentPlayer)=0 Then GIEffect 1
	If JetLevel(CurrentPlayer)=3 AND numBump(CurrentPlayer)=0 Then GIEffect 1
	If JetLevel(CurrentPlayer)=4 AND numBump(CurrentPlayer)=0 Then GIEffect 1
	If JetLevel(CurrentPlayer)=5 AND numBump(CurrentPlayer)=0 Then GIEffect 1
	If JetLevel(CurrentPlayer)=6 AND numBump(CurrentPlayer)=0 Then AddExtraBall
	If JetLevel(CurrentPlayer)=6 AND numBump(CurrentPlayer)>0 Then
		Lbump1.state=1:Lbump2.state=1:Lbump3.state=1
		If Not UltraDMD.IsRendering Then
			UltraDMD.DisplayScene00ExWithId "bumper6", FALSE, dmd_bumpersLvl6, "", 14, 2,FormatScore, 14, 2, UltraDMD_Animation_None, 1900, UltraDMD_Animation_None
			SCReset.Enabled=1
		End If
		UltraDMD.ModifyScene00 "bumper6", "", FormatScore
	End If
End If
End Sub

Sub Bumper2_Hit
    'converts image list to animation
	Dim dmd_bumpers,dmd_bumpersLvl6
	dmd_bumpers=UltraDMD.CreateAnimationFromImages (15, true, "bump1.png,bump2.png,bump3.png")
	dmd_bumpersLvl6=UltraDMD.CreateAnimationFromImages (15, true, "bump6_1.png,bump6_2.png,bump6_3.png,bump6_4.png,bump6_5.png,bump6_6.png")
If Tilted=0 Then
  	PlaySoundAt SoundFXDOF("fx_bumperR",109,DOFPulse,DOFContactors),ActiveBall
	FlashForMs fl1, 100, 50, 0:FlashForMs fl1a, 100, 50, 0:FlashForMs dome1, 100, 50, 0:FlashForMs light32, 100, 50, 0:B2SEffect B2SLight1, 1, 50
	DOF 142, DOFPulse:CheckFormatScore
    If bonus>0 Then scores(CurrentPlayer)=scores(CurrentPlayer)+BumpScore*bonus:bonusP=bonusP+BumpScore
    If bonus<2 Then scores(CurrentPlayer)=scores(CurrentPlayer)+BumpScore:bonusP=bonusP+BumpScore
    numBump(CurrentPlayer)=numBump(CurrentPlayer)+1
	num=100-numBump(CurrentPlayer)
	If numBump(CurrentPlayer) = 100 Then numBump(CurrentPlayer)=0:JetLevel(CurrentPlayer)=JetLevel(CurrentPlayer)+1
    If JetLevel(CurrentPlayer)<6 Then
		If Not UltraDMD.IsRendering Then
				UltraDMD.DisplayScene00ExWithId "bumper", false, dmd_bumpers,"    " & num & "        " & (JetLevel(CurrentPlayer)+1), 14, 2,FormatScore, 14, 2, UltraDMD_Animation_None, 1900, UltraDMD_Animation_None
			SCReset.Enabled=1
		End If
		'2 digits
		If num>9 Then UltraDMD.ModifyScene00 "bumper","    " & num & "        " & (JetLevel(CurrentPlayer)+1),FormatScore
		'1 digit
		If num<10 Then UltraDMD.ModifyScene00 "bumper","     " & num & "        " & (JetLevel(CurrentPlayer)+1),FormatScore
		FlashForMs Lbump1, 100, 80, 0
		FlashForMs Lbump2, 100, 80, 0
		FlashForMs Lbump3, 100, 80, 0
    End If
	If JetLevel(CurrentPlayer)=1 Then BumpScore=1510
	If JetLevel(CurrentPlayer)=2 Then BumpScore=2530
	If JetLevel(CurrentPlayer)=3 Then BumpScore=5000
	If JetLevel(CurrentPlayer)=4 Then BumpScore=7500
	If JetLevel(CurrentPlayer)>=5 Then BumpScore=10000
	If JetLevel(CurrentPlayer)=2 AND numBump(CurrentPlayer)=0 Then GIEffect 1
	If JetLevel(CurrentPlayer)=3 AND numBump(CurrentPlayer)=0 Then GIEffect 1
	If JetLevel(CurrentPlayer)=4 AND numBump(CurrentPlayer)=0 Then GIEffect 1
	If JetLevel(CurrentPlayer)=5 AND numBump(CurrentPlayer)=0 Then GIEffect 1
	If JetLevel(CurrentPlayer)=6 AND numBump(CurrentPlayer)=0 Then AddExtraBall
	If JetLevel(CurrentPlayer)=6 AND numBump(CurrentPlayer)>0 Then
		Lbump1.state=1:Lbump2.state=1:Lbump3.state=1
		If Not UltraDMD.IsRendering Then
			UltraDMD.DisplayScene00ExWithId "bumper6", FALSE, dmd_bumpersLvl6, "", 14, 2,FormatScore, 14, 2, UltraDMD_Animation_None, 1900, UltraDMD_Animation_None
			SCReset.Enabled=1
		End If
		UltraDMD.ModifyScene00 "bumper6", "", FormatScore
	End If
End If
End Sub

'*********************************************************************
'***** BOOTS TARGETS *************************************************
'*********************************************************************
Dim bcase,boothit:boothit=1

Sub swb1_Hit
If Tilted=0 Then
	me.timerinterval=1000
	me.timerenabled=1
	PlaySoundAt SoundFXDOF("fx_target", 111, DOFPulse, DOFTargets), ActiveBall
    If headLD.z<0 AND headRD.z<0 AND LMultiLock.state=0 AND lmultiskill.state=0 AND lmultiTicket.state=0 AND MVPOfTheYear(CurrentPlayer)=0 AND FKAward(CurrentPlayer)=0_
		AND BSMODE(CurrentPlayer)=0 AND SemiFinalAward(CurrentPlayer)=0 AND DefenceLocked(CurrentPlayer)=0 AND GKMM=0 AND TrapDoorP.Z=0 Then
		Lbomb1.state=1:scores(CurrentPlayer)=scores(CurrentPlayer)+20000
		If Lbomb1.state=1 AND Lbomb2.state=1 AND Lbomb3.state=1 AND Lbomb4.state=1 Then bomberT
		If Lbomb3.state=0 AND Lbomb2.state=0 AND Lbomb4.state=0 AND boothit=1 Then bcase=1:DisplayBoots:boothit=0			'000
		If Lbomb3.state=1 AND Lbomb2.state=0 AND Lbomb4.state=0 AND boothit=1 Then bcase=2:DisplayBoots:boothit=0			'100
		If Lbomb3.state=1 AND Lbomb2.state=0 AND Lbomb4.state=1 AND boothit=1 Then bcase=3:DisplayBoots:boothit=0			'101
		If Lbomb3.state=1 AND Lbomb2.state=1 AND Lbomb4.state=0 AND boothit=1 Then bcase=4:DisplayBoots:boothit=0			'110
		If Lbomb3.state=0 AND Lbomb2.state=1 AND Lbomb4.state=1 AND boothit=1 Then bcase=5:DisplayBoots:boothit=0			'011
		If Lbomb3.state=0 AND Lbomb2.state=1 AND Lbomb4.state=0 AND boothit=1 Then bcase=6:DisplayBoots:boothit=0			'010
		If Lbomb3.state=0 AND Lbomb2.state=0 AND Lbomb4.state=1 AND boothit=1 Then bcase=7:DisplayBoots:boothit=0			'001
	End If
End If
End Sub

Sub swb2_Hit
If Tilted=0 Then
	me.timerinterval=1000
	me.timerenabled=1
	PlaySoundAt SoundFXDOF("fx_target", 104, DOFPulse, DOFTargets), ActiveBall
    If headLD.z<0 AND headRD.z<0 AND LMultiLock.state=0 AND lmultiskill.state=0 AND lmultiTicket.state=0 AND MVPOfTheYear(CurrentPlayer)=0 AND FKAward(CurrentPlayer)=0_
		AND BSMODE(CurrentPlayer)=0 AND SemiFinalAward(CurrentPlayer)=0 AND DefenceLocked(CurrentPlayer)=0 AND GKMM=0 AND TrapDoorP.Z=0 Then
		Lbomb2.state=1:scores(CurrentPlayer)=scores(CurrentPlayer)+20000
		If Lbomb1.state=1 AND Lbomb2.state=1 AND Lbomb3.state=1 AND Lbomb4.state=1 Then bomberT
		If Lbomb1.state=0 AND Lbomb3.state=0 AND Lbomb4.state=0 AND boothit=1 Then bcase=8:DisplayBoots:boothit=0			'000
		If Lbomb1.state=1 AND Lbomb3.state=0 AND Lbomb4.state=0 AND boothit=1 Then bcase=9:DisplayBoots:boothit=0			'100
		If Lbomb1.state=1 AND Lbomb3.state=0 AND Lbomb4.state=1 AND boothit=1 Then bcase=10:DisplayBoots:boothit=0			'101
		If Lbomb1.state=1 AND Lbomb3.state=1 AND Lbomb4.state=0 AND boothit=1 Then bcase=11:DisplayBoots:boothit=0			'110
		If Lbomb1.state=0 AND Lbomb3.state=1 AND Lbomb4.state=1 AND boothit=1 Then bcase=12:DisplayBoots:boothit=0			'011
		If Lbomb1.state=0 AND Lbomb3.state=1 AND Lbomb4.state=0 AND boothit=1 Then bcase=13:DisplayBoots:boothit=0			'010
		If Lbomb1.state=0 AND Lbomb3.state=0 AND Lbomb4.state=1 AND boothit=1 Then bcase=14:DisplayBoots:boothit=0			'001
	End If
End If
End Sub

Sub swb3_Hit
If Tilted=0 Then
	me.timerinterval=1000
	me.timerenabled=1
	PlaySoundAt SoundFXDOF("fx_target", 106, DOFPulse, DOFTargets), ActiveBall
    If headLD.z<0 AND headRD.z<0 AND LMultiLock.state=0 AND lmultiskill.state=0 AND lmultiTicket.state=0 AND MVPOfTheYear(CurrentPlayer)=0 AND FKAward(CurrentPlayer)=0_
		AND BSMODE(CurrentPlayer)=0 AND SemiFinalAward(CurrentPlayer)=0 AND DefenceLocked(CurrentPlayer)=0 AND GKMM=0 AND TrapDoorP.Z=0 Then
		Lbomb3.state=1:scores(CurrentPlayer)=scores(CurrentPlayer)+20000
		If Lbomb1.state=1 AND Lbomb2.state=1 AND Lbomb3.state=1 AND Lbomb4.state=1 Then bomberT
		If Lbomb1.state=0 AND Lbomb2.state=0 AND Lbomb4.state=0 AND boothit=1 Then bcase=15:DisplayBoots:boothit=0			'000
		If Lbomb1.state=1 AND Lbomb2.state=0 AND Lbomb4.state=0 AND boothit=1 Then bcase=16:DisplayBoots:boothit=0			'100
		If Lbomb1.state=1 AND Lbomb2.state=0 AND Lbomb4.state=1 AND boothit=1 Then bcase=17:DisplayBoots:boothit=0			'101
		If Lbomb1.state=1 AND Lbomb2.state=1 AND Lbomb4.state=0 AND boothit=1 Then bcase=18:DisplayBoots:boothit=0			'110
		If Lbomb1.state=0 AND Lbomb2.state=1 AND Lbomb4.state=1 AND boothit=1 Then bcase=19:DisplayBoots:boothit=0			'011
		If Lbomb1.state=0 AND Lbomb2.state=1 AND Lbomb4.state=0 AND boothit=1 Then bcase=20:DisplayBoots:boothit=0			'010
		If Lbomb1.state=0 AND Lbomb2.state=0 AND Lbomb4.state=1 AND boothit=1 Then bcase=21:DisplayBoots:boothit=0			'001
	End If
End If
End Sub

Sub swb4_Hit
If Tilted=0 Then
	me.timerinterval=1000
	me.timerenabled=1
	PlaySoundAt SoundFXDOF("fx_target", 108, DOFPulse, DOFTargets), ActiveBall
    If headLD.z<0 AND headRD.z<0 AND LMultiLock.state=0 AND lmultiskill.state=0 AND lmultiTicket.state=0 AND MVPOfTheYear(CurrentPlayer)=0 AND FKAward(CurrentPlayer)=0_
		AND BSMODE(CurrentPlayer)=0 AND SemiFinalAward(CurrentPlayer)=0 AND DefenceLocked(CurrentPlayer)=0 AND GKMM=0 AND TrapDoorP.Z=0 Then
		Lbomb4.state=1:scores(CurrentPlayer)=scores(CurrentPlayer)+20000
		If Lbomb1.state=1 AND Lbomb2.state=1 AND Lbomb3.state=1 AND Lbomb4.state=1 Then bomberT
		If Lbomb1.state=0 AND Lbomb2.state=0 AND Lbomb3.state=0 AND boothit=1 Then bcase=22:DisplayBoots:boothit=0			'000
		If Lbomb1.state=1 AND Lbomb2.state=0 AND Lbomb3.state=0 AND boothit=1 Then bcase=23:DisplayBoots:boothit=0			'100
		If Lbomb1.state=1 AND Lbomb2.state=0 AND Lbomb3.state=1 AND boothit=1 Then bcase=24:DisplayBoots:boothit=0			'101
		If Lbomb1.state=1 AND Lbomb2.state=1 AND Lbomb3.state=0 AND boothit=1 Then bcase=25:DisplayBoots:boothit=0			'110
		If Lbomb1.state=0 AND Lbomb2.state=1 AND Lbomb3.state=1 AND boothit=1 Then bcase=26:DisplayBoots:boothit=0			'011
		If Lbomb1.state=0 AND Lbomb2.state=1 AND Lbomb3.state=0 AND boothit=1 Then bcase=27:DisplayBoots:boothit=0			'010
		If Lbomb1.state=0 AND Lbomb2.state=0 AND Lbomb3.state=1 AND boothit=1 Then bcase=28:DisplayBoots:boothit=0			'001
	End If
End If
End Sub

Sub bomberT		'when you collect all boots
	If StrikerMode(CurrentPlayer)<3 Then StrikerMode(CurrentPlayer)=StrikerMode(CurrentPlayer)+1 Else StrikerMode(CurrentPlayer)=1
	If StrikerMode(CurrentPlayer)=1 Then leb1.state=2:leb2.state=2
	If StrikerMode(CurrentPlayer)=2 Then gkmodel.state=2:gkmoder.state=2
	If StrikerMode(CurrentPlayer)=3 Then videomodel.state=2:videomoder.state=2
	scores(CurrentPlayer)=scores(CurrentPlayer)+100000:PlaySoundAt SoundFXDOF("fx_postup",134,DOFPulse,DOFDropTargets),headLD:DOF 135,DOFPulse
	brake=0:perc=perc+3:sbou=(Rndnum(-10,10))/10:brake2=0:perc2=perc2+3:sbou2=(Rndnum(-10,10))/10
	bomberLup.enabled=1:bomberRup.enabled=1
	If DefenceLocked(CurrentPlayer)=0 Then	UltraDMD.CancelRendering:bcase=0:DisplayBoots
End Sub

Sub swb1_timer
me.timerenabled=0
boothit=1
SCReset.enabled=1
End Sub

Sub swb2_timer
me.timerenabled=0
boothit=1
SCReset.enabled=1
End Sub

Sub swb3_timer
me.timerenabled=0
boothit=1
SCReset.enabled=1
End Sub

Sub swb4_timer
me.timerenabled=0
boothit=1
SCReset.enabled=1
End Sub

Sub DisplayBoots
LightEffect 5:Gieffect 0
PlaySound "kick":If UltraDMD.IsRendering Then UltraDMD.CancelRendering
If bcase=0 Then
	UDMD_Display "bombers.gif", "",14,-1,"",14,-1,UltraDMD_Animation_None, 1500, UltraDMD_Animation_None,7:FlasherEffect 6
ElseIf bcase>0 AND bcase<10 Then
	UDMD_Display "B0" & bcase & ".gif", "",14,-1,"",14,-1,UltraDMD_Animation_ScrollOnDown, 1500, UltraDMD_Animation_FadeOut,5:FlasherEffect 3
Else
	UDMD_Display "B" & bcase & ".gif", "",14,-1,"",14,-1,UltraDMD_Animation_ScrollOnDown, 1500, UltraDMD_Animation_FadeOut,5:FlasherEffect 3
End If
End Sub

'************************************************************************
'****STRIKERS HIT *******************************************************
'************************************************************************
Sub hitRD_Hit
If Tilted=0 Then
	If TrapDoorP.Z=0 AND DefenceLocked(CurrentPlayer)=0 Then Brhit(CurrentPlayer)=Brhit(CurrentPlayer)+1:scores(CurrentPlayer)=scores(CurrentPlayer)+50000
	LightEffect 0:GIeffect 0:FlasherEffect 3
    PlaySoundAt SoundFXDOF("fx_hitplayer",119,DOFPulse,DOFShaker),ActiveBall:bouncingR.Enabled = 1:brake=0:perc=perc+3:sbou=(Rndnum(-10,10))/10

	If brhit(CurrentPlayer)=1 Then UDMD_Display "black.bmp", "r. striker", 14,-1,"2 to go",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5
	If brhit(CurrentPlayer)=2 Then UDMD_Display "black.bmp", "r. striker", 14,-1,"1 to go",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5

	If brhit(CurrentPlayer)=3 AND DefenceLocked(CurrentPlayer)=0 Then 
		If StrikerMode(CurrentPlayer)=1 Then
			leb2.state=1
			If leb1.state= 1 Then
				EBAwardTimer.Enabled=1:StrikerModeStart(CurrentPlayer)=1
			Else
				UDMD_Display "black.bmp", "Still One", 14,-1,"Striker Up",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5
			End If
		End If

		If StrikerMode(CurrentPlayer)=2 Then
			gkmoder.state=1
			If gkmodel.state=1 Then
				If UltraDMD.IsRendering Then UltraDMD.CancelRendering
				UltraDMD.DisplayScene00Ex "black.bmp", "G.K. MODE", 14,-1,"IS LIT",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_None
				UltraDMD.DisplayScene00Ex "black.bmp", "Shoot the", 14,-1,"Snack Bar",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut
				tdfcolor=2:OpenTrapDoor True:StrikerModeStart(CurrentPlayer)=1:SCReset.Enabled=1
			Else
				UDMD_Display "black.bmp", "Still One", 14,-1,"Striker Up",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5
			End If
		End If

		If StrikerMode(CurrentPlayer)=3 Then
			videomoder.state=1
			If videomodel.state=1 Then
				If UltraDMD.IsRendering Then UltraDMD.CancelRendering
				UltraDMD.DisplayScene00Ex "black.bmp", "VIDEO MODE", 14,-1,"IS LIT",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_None
				UltraDMD.DisplayScene00Ex "black.bmp", "Shoot the", 14,-1,"Snack Bar",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut
				tdfcolor=3:OpenTrapDoor True:StrikerModeStart(CurrentPlayer)=1:SCReset.Enabled=1
			Else
				UDMD_Display "black.bmp", "Still One", 14,-1,"Striker Up",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5
			End If
		End If
		PlaySoundAt SoundFXDOF("fx_postdown",135,DOFPulse,DOFDropTargets),ActiveBall
		bomberRdown.enabled=1
		hitRD.isdropped=1:WALL33.ISDROPPED=1:BRhit(CurrentPlayer)=0
		scores(CurrentPlayer)=scores(CurrentPlayer)+200000
		bouncingR.Enabled = 1:brake=0:perc=perc+3:sbou=(Rndnum(-10,10))/10
    End If

    If DefenceLocked(CurrentPlayer)=1 Then
		If headLD.Z>0 Then
			UDMD_Display "black.bmp", "Still One", 14,-1,"Striker Up",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5
		Else
			UDMD_Display "black.bmp", "Shoot the", 14,-1,"Defenders",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,7
			DefenceLocked(CurrentPlayer)=2:Me.TimerInterval=100:Me.TimerEnabled=1
		End If
		PlaySoundAt SoundFXDOF("fx_postdown",135,DOFPulse,DOFDropTargets),ActiveBall
		bomberRdown.enabled=1
		hitRD.isdropped=1:WALL33.ISDROPPED=1
		scores(CurrentPlayer)=scores(CurrentPlayer)+200000
		bouncingR.Enabled = 1:brake=0:perc=perc+3:sbou=(Rndnum(-10,10))/10
	End If
End If
End Sub

Sub hitRD_Timer
	If NOT UltraDMD.IsRendering Then
		Me.TimerEnabled=0
		'move the left bomber up because it was up before the player locked the defence
		If BLHit(CurrentPlayer)>0 Then bomberLup.enabled=1:brake2=0:perc2=perc2+3:sbou2=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",134,DOFPulse,DOFDropTargets),headLD
		'move the right bomber up because it was up before the player locked the defence
		If BRHit(CurrentPlayer)>0 Then bomberRup.enabled=1:brake=0:perc=perc+3:sbou=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",135,DOFPulse,DOFDropTargets),headRD
	End If
End Sub

Sub hitLD_Hit
If Tilted=0 Then
	If TrapDoorP.Z=0 AND DefenceLocked(CurrentPlayer)=0 Then Blhit(CurrentPlayer)=Blhit(CurrentPlayer)+1:scores(CurrentPlayer)=scores(CurrentPlayer)+50000
	LightEffect 0:GIeffect 0:FlasherEffect 3
    PlaySoundAt SoundFXDOF("fx_hitplayer",119,DOFPulse,DOFShaker),ActiveBall:bouncingL.Enabled = 1:brake2=0:perc2=perc2+3:sbou2=(Rndnum(-10,10))/10

	If blhit(CurrentPlayer)=1 Then UDMD_Display "black.bmp", "l. Striker", 14,-1,"2 to go",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5
	If blhit(CurrentPlayer)=2 Then UDMD_Display "black.bmp", "l. Striker", 14,-1,"1 to go",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5

    If blhit(CurrentPlayer)=3 AND DefenceLocked(CurrentPlayer)=0 Then
		If StrikerMode(CurrentPlayer)=1 Then
			Leb1.state=1
			If leb2.state= 1 Then
				EBAwardTimer.Enabled=1:StrikerModeStart(CurrentPlayer)=1
			Else
				UDMD_Display "black.bmp", "Still One", 14,-1,"Striker Up",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5
			End If
		End If

		If StrikerMode(CurrentPlayer)=2 Then
			gkmodel.state=1
			If gkmoder.state=1 Then
				If UltraDMD.IsRendering Then UltraDMD.CancelRendering
				UltraDMD.DisplayScene00Ex "black.bmp", "G.K. MODE", 14,-1,"IS LIT",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_None
				UltraDMD.DisplayScene00Ex "black.bmp", "Shoot the", 14,-1,"Snack Bar",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut
				tdfcolor=2:OpenTrapDoor True:StrikerModeStart(CurrentPlayer)=1:SCReset.Enabled=1
			Else
				UDMD_Display "black.bmp", "Still One", 14,-1,"Striker Up",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5
			End If
		End If

       If StrikerMode(CurrentPlayer)=3 Then
			videomodel.state=1
			If videomoder.state=1 Then
				If UltraDMD.IsRendering Then UltraDMD.CancelRendering
				UltraDMD.DisplayScene00Ex "black.bmp", "VIDEO MODE", 14,-1,"IS LIT",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_None
				UltraDMD.DisplayScene00Ex "black.bmp", "Shoot the", 14,-1,"Snack Bar",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut
				tdfcolor=3:OpenTrapDoor True:StrikerModeStart(CurrentPlayer)=1:SCReset.Enabled=1
			Else
				UDMD_Display "black.bmp", "Still One", 14,-1,"Striker Up",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5
			End If
		End If
		PlaySoundAt SoundFXDOF("fx_postdown",134,DOFPulse,DOFDropTargets),ActiveBall
		bomberLdown.enabled=1
		hitLD.isdropped=1:WALL32.ISDROPPED=1:BLhit(CurrentPlayer)=0
		scores(CurrentPlayer)=scores(CurrentPlayer)+200000
		bouncingL.Enabled = 1:brake2=0:perc2=perc2+3:sbou2=(Rndnum(-10,10))/10
	End If

    If DefenceLocked(CurrentPlayer)=1 Then
		If headRD.Z>0 Then
			UDMD_Display "black.bmp", "Still One", 14,-1,"Striker Up",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,5
		Else
			UDMD_Display "black.bmp", "Shoot the", 14,-1,"Defenders",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,7
			DefenceLocked(CurrentPlayer)=2:Me.TimerInterval=100:Me.TimerEnabled=1
		End If
		PlaySoundAt SoundFXDOF("fx_postdown",134,DOFPulse,DOFDropTargets),ActiveBall
		bomberLdown.enabled=1
		hitLD.isdropped=1:WALL32.ISDROPPED=1
		scores(CurrentPlayer)=scores(CurrentPlayer)+200000
		bouncingL.Enabled = 1:brake2=0:perc2=perc2+3:sbou2=(Rndnum(-10,10))/10
	End If
End If
End Sub

Sub hitLD_Timer
	If NOT UltraDMD.IsRendering Then
		Me.TimerEnabled=0
		'move the left bomber up because it was up before the player locked the defence
		If BLHit(CurrentPlayer)>0 Then bomberLup.enabled=1:brake2=0:perc2=perc2+3:sbou2=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",134,DOFPulse,DOFDropTargets),headLD
		'move the right bomber up because it was up before the player locked the defence
		If BRHit(CurrentPlayer)>0 Then bomberRup.enabled=1:brake=0:perc=perc+3:sbou=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",135,DOFPulse,DOFDropTargets),headRD
	End If
End Sub

'************************************************************************
'*EXTRABALL MODE*********************************************************
'************************************************************************
Dim EBAward,EBMode,MBMode,EBAw,sfcc
Sub AddExtraBall
	If UltraDMD.IsRendering Then UltraDMD.CancelRendering
	UDMD_Display "mvp-extraball.gif","",0,0,"",0,0,UltraDMD_Animation_None,4600,UltraDMD_Animation_FadeOut,10
	extraball(CurrentPlayer)=extraball(CurrentPlayer)+1:extraballmax(CurrentPlayer)=extraballmax(CurrentPlayer)+1:EBMode=1
	LightEffect 3:GIEffect 3
	PlaySound "thunder":SJDelay.Interval=2500:SJDelay.Enabled=1
	AddExtraBallTimer.Interval=4800
	AddExtraBallTimer.Enabled=1
	StopFlash TDFL1,1
End Sub

Sub SJDelay_Timer
	Me.Enabled=0
	FlasherEffect 9:B2SOnbkgnd:B2SEffect Array(B2SLight1,B2SLight2,B2SLight3),15,50
	If EBMode=1 Then PlaySound "V.extraball":EBMode=0
	If MBMode=1 Then PlaySound "V.multiball":MBMode=0
End Sub

Sub AddExtraballTimer_timer
	Me.Enabled=0
	'awarded from Strikers
	If EBAward=1 Then KGoalExit:EBAward=0
	'awarded from break spin
	If EBAward=2 Then KGoalExit:EBAward=0
	'awarded from the Free kick
	If EBAward=3 Then KGoalExit:EBAward=0
	'awarded when you reach the semifinal
	If EBAward=4 Then KGoalExit:EBAward=0
End Sub

Sub EBAwardTimer_timer
	sfcc=sfcc+1
	If sfcc=1 Then
		If UltraDMD.IsRendering Then UltraDMD.CancelRendering
		UltraDMD.DisplayScene00Ex "black.bmp", "EXTRA BALL", 14,-1,"IS LIT",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_None
		UltraDMD.DisplayScene00Ex "black.bmp", "Shoot the", 14,-1,"Snack Bar",14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut
	End If
	If sfcc=2 Then Playsound "bell":Fl4.state=1:StopFlash Fl4a,1:StopFlash Fl4,1:Flash Fl4a,150:Flash Fl4,150:DOF 143,DOFPulse:SCReset.Enabled=1
	If sfcc=5 Then Playsound "bell":DOF 143,DOFPulse
	If sfcc=8 Then Playsound "bell":DOF 143,DOFPulse
	If sfcc=11 Then Playsound "bell":DOF 143,DOFPulse
	If sfcc=14 Then Playsound "bell":DOF 143,DOFPulse
	If sfcc=17 Then
		PlaySound "V.go for eb":StopFlash Fl4,1:StopFlash Fl4a,0:Fl4.state=0
		tdfcolor=1:OpenTrapDoor True
		If EBAw=1 Then SemiFinalAward(CurrentPlayer)=1
		If EBAw=2 Then FKAward(CurrentPlayer)=1
	End If
	If sfcc=20 Then Me.Enabled=0:sfcc=0
End Sub

'************************************************************************
'*VIDEO MODE*************************************************************
'************************************************************************
Dim RembMax,ballside,g,ballrot,VMScore,AttemptPause,VMScoreBest,EBMade,VModeBS
Dim startvm, VMOn, Remb, Attempt:startvm=0:VMOn=0:Remb=-1:Attempt=1:VModeBS=0
Dim VMballX,VMBallH
Sub VMode
	Select Case VModeDifficulty
		Case 0	'easy
			SCFrameExtra.imageA="LCD_VMode_15":RembMax=15
		Case 1	'medium
			SCFrameExtra.imageA="LCD_VMode_20":RembMax=20
		Case 2	'hard
			SCFrameExtra.imageA="LCD_VMode_30":RembMax=30
	End Select
	SCFrame.imageA="LCD_Vmode_sc1"
	DisableTable 1:Tilted=1:VMballX=ballprim.x:VMballH=ballprim.y
	UltraDMD.CancelRendering
	UltraDMD.ScrollingCredits "black.bmp", "USE FLIPPERS|TO MOVE THE PLAYER| |DO " & RembMax & " KICK-UPS|TO WIN THE EXTRABALL", 15, UltraDMD_Animation_ScrollOnUp, 100, UltraDMD_Animation_None
	UltraDMD.DisplayScene00ExWithId "ready321", false, "black.bmp", "MOVE PLAYER", 14, 1, "READY?", 10, -1, UltraDMD_Animation_FadeIn, 4000, UltraDMD_Animation_FadeOut
	VIDEOMODE.ENABLED=1
End Sub

Sub VIDEOMODE_TIMER()
	startvm=startvm+1
	If startvm>250 And startvm<300 Then If ScFrame.Opacity>0 Then SCFrame.opacity=ScFrame.opacity-1 End If
	If startvm=300 then SCFrameExtra.visible=1:ScFrame.Opacity=20:SCFrame.imageA="LCD_VMode_sc2"
	If startvm>550 And startvm<600 Then If ScFrame.Opacity>0 Then SCFrame.opacity=ScFrame.opacity-1:SCFrameExtra.opacity=SCFrameExtra.opacity-1 End If
	If startvm=600 Then PlaySound "bumpmult":headp.visible=1:SCFrameExtra.visible=0:ScFrameExtra.Opacity=20:ScFrame.Opacity=20:SCFrame.imageA="LCD_VMode_sc3"
	If startvm>700 AND startvm<800 Then UltraDMD.ModifyScene00 "ready321", "MOVE PLAYER", "  3"
	If startvm=701 Then PlaySound "beep":DisableTable 0:Tilted=0
	If startvm>800 AND startvm<900 Then UltraDMD.ModifyScene00 "ready321", "MOVE PLAYER", "  2"
	If startvm=801 Then PlaySound "beep"
	If startvm>900 AND startvm<1000 Then UltraDMD.ModifyScene00 "ready321", "MOVE PLAYER", "  1"
	If startvm=901 Then PlaySound "beep"
	If startvm=950 Then SCFrame.imageA="LCD_VMode_sc4"
	If startvm=1000 Then UltraDMD.CancelRendering:PlaySound "fischio":VMOn=1:Music:ballprim.visible=1:SCFrame.visible=0
	If startvm>1000 Then
		If ballprim.y<(VMballH+10) Then ballprim.y=ballprim.y-3
		ballprim.y=ballprim.y+g:g=g+0.1
		If ballprim.y>(VMballH+3) AND ballprim.x-headp.x<25 AND ballprim.x-headp.x>-25 Then g=0

		If g>0.1 AND g<0.3 AND ballprim.y<(VMballH+15) Then 
			Remb=Remb+1:VMScore=100000*Remb
			On Error Resume Next
			UltraDMD.DisplayScoreboard00 1, 1, VMscore, VMscore, VMscore, VMscore, "attempt" & Attempt, "hits " & Remb
			If Err.number <> 0 Then UltraDMD.DisplayScoreboard 1, 1, VMscore, VMscore, VMscore, VMscore, "attempt" & Attempt, "hits " & Remb    
			PlaySound "headhit":DOF 118,DOFPulse
			If VMScore>=HighScore(4) Then HighScore(4)=VMScore:VMChamp(CurrentPlayer)=VMScore
			If Remb=RembMax AND EBMade=0 Then AddExtraBall:EBMade=1
		End If

		If ballprim.y>(VMballH+2) AND ballprim.y<(VMballH+4) Then ballside=((ballprim.x-headp.x)/10):ballrot=ballside*5
		If ballprim.y<(VMballH+4) Then ballprim.x=ballprim.x+ballside :ballprim.roty=ballprim.roty+ballrot
		If ballprim.x<(VMballX-130) Then ballside=ballside*-1
		If ballprim.x>(VMballX+130) Then ballside=ballside*-1

		If ballprim.y>=(VMballH+15) Then
			ballrot=0:ballside=0:AttemptPause=AttemptPause+1:Remb=-1:g=0
			HEADL.ENABLED=0:HEADR.ENABLED=0:headp.x=VMballX+0.1:ballprim.visible=0
			If Attempt<3 Then SCFrame.imageA="LCD_VMode_sc3":SCFrame.visible=1
			If Attempt=3 Then SCFrame.imageA="LCD_VMode_sc00":SCFrame.visible=1:headp.visible=0:If AttemptPause=10 Then PlaySound "DelusioneParata"
			If VMScore>VMScoreBest Then VMScoreBest=VMScore
			If AttemptPause>150 and Attempt<3 Then SCFrame.imageA="LCD_VMode_sc4"
			If AttemptPause>200 Then
				AttemptPause=0:Attempt=Attempt+1:SCFrame.visible=0
				ballprim.x=VMballX:headp.x=VMballX+0.1:ballprim.y=VMballH
				If Attempt<=3 Then PlaySound "fischio":ballprim.visible=1
			End If
			If Attempt>3 Then
				VIDEOMODE.ENABLED=0:HEADL.ENABLED=0:HEADR.ENABLED=0
				scores(CurrentPlayer)=scores(CurrentPlayer)+VMScoreBest
				UDMD_Display "black.bmp", "BEST SCORE", 14,-1,formatnumber(VMScoreBest,0),14,-1, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut,10
				headp.visible=0:ballprim.visible=0:screenprim.visible=0
				VMOn=0:ballside=0:g=0:ballrot=0:Remb=-1:UpdateTeamLogos:StopFlash TeamLogos(3),1
				Attempt=1:AttemptPause=0:startvm=0:EBMade=0:VMScoreBest=0
				ballprim.x=VMballX:headp.x=VMballX+0.1:ballprim.y=VMballH
				ballrelease.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:Ballrelease.kick 90,7:PlaySoundAt SoundFXDOF("fx_ballrel",121,DOFPulse,DOFContactors),Ballrelease:kicked=0:Music
				If VModeBS=0 Then Leb1.state=0:Leb2.state=0:gkmodel.state=0:gkmoder.state=0:videomodel.state=0:videomoder.state=0:Else VModeBS=0:videomodel.state=0:videomoder.state=0:End If
				If Lx1.state=1 AND Lx2.state=1 Then Lx1.state=0:Lx2.state=0
			End If
		End If
	End If
End Sub

Sub HEADR_Timer:If HEADP.X<VMballX+116 Then HEADP.X=HEADP.X+3:End If:End Sub
Sub HEADL_Timer:If HEADP.X>VMballX-116 Then HEADP.X=HEADP.X-3:End If:End Sub

'************************************************************************
'*GK MODE ***************************************************************
'************************************************************************
Dim GKMM,SDIR,moveback,GKMScore,firstballout
Dim CPUCOUNT, BALLOFF, gkmmballs, vmcount, GKModeBS:CPUCOUNT=0:BALLOFF=0:gkmmballs=0:vmcount=0:GKModeBS=0

Sub GKMODE
	Select Case GKModeDifficulty
		Case 0	'easy
			RightFlipper.Strength=1400
		Case 1	'medium
			RightFlipper.Strength=1700
		Case 2	'hard
			RightFlipper.Strength=2000
	End Select
If gkmodel.state=1 AND gkmoder.state=1 Then
	SCFrame.imageA="LCD_GKMode_sc1"
	RInlane.collidable=0:RInlaneGK.collidable=1
	Lbomb1.state=0:Lbomb2.state=0:Lbomb3.state=0:Lbomb4.state=0
	MOVEGK.enabled=0:ResetGK
	GKHOLEin.enabled=1:GKcount.Interval=2000:GKcount.enabled=1
	SaveMatchLampStates
	defencedown.enabled=1:If Lshoot.state=2 Then Lshoot.state=0
	DisableTable 1:Tilted=1
	UltraDMD.CancelRendering
	UltraDMD.ScrollingCredits "black.bmp", "USE FLIPPERS|TO MOVE GOALKEEPER| |BLOCK ALL THE SHOTS|TO WIN THE EXTRABALL", 15, UltraDMD_Animation_ScrollOnUp, 100, UltraDMD_Animation_None
	UltraDMD.DisplayScene00ExWithId "ready321a", false, "black.bmp", "MOVE G.K.", 14, 1, "READY?", 10, -1, UltraDMD_Animation_FadeIn, 4000, UltraDMD_Animation_FadeOut
	CPUTIMER.enabled=1
End If
End Sub

Sub CPUTIMER_TIMER()
	vmcount=vmcount+1
	If vmcount>250 And vmcount<300 Then If ScFrame.Opacity>0 Then SCFrame.opacity=ScFrame.opacity-1 End If
	If vmcount=300 then ScFrame.Opacity=20:SCFrame.imageA="LCD_GKMode_sc2"
	If vmcount>400 AND vmcount<450 Then HEADGK.X=387:bootsGK.X=387:bodyGK.X=387:kitGK.X=387:GKPOST.X=387	'left
	If vmcount=401 Then PlaySoundAt SoundFXDOF("fx_DropTargetUp",101,DOFOn,DOFFlippers),headGK
	If vmcount>450 AND vmcount<500 Then HEADGK.X=437:bootsGK.X=437:bodyGK.X=437:kitGK.X=437:GKPOST.X=437	'center
	If vmcount=451 Then PlaySoundAt SoundFXDOF("fx_DropTargetDOWN",101,DOFOff,DOFFlippers),headGK
	If vmcount>500 AND vmcount<550 Then HEADGK.X=487:bootsGK.X=487:bodyGK.X=487:kitGK.X=487:GKPOST.X=487	'right
	If vmcount=501 Then PlaySoundAt SoundFXDOF("fx_DropTargetUp",102,DOFOn,DOFFlippers),headGK
	If vmcount>550 AND vmcount<600 Then
		HEADGK.X=437:bootsGK.X=437:bodyGK.X=437:kitGK.X=437:GKPOST.X=437	'center
		If ScFrame.Opacity>0 Then SCFrame.opacity=ScFrame.opacity-1
	End If
	If vmcount=551 Then PlaySoundAt SoundFXDOF("fx_DropTargetDOWN",102,DOFOff,DOFFlippers),headGK
	If vmcount=600 Then PlaySound "bumpmult":ScFrame.Opacity=20:SCFrame.imageA="LCD_VMode_sc3"

	If vmcount>700 AND vmcount<800 Then UltraDMD.ModifyScene00 "ready321a", "MOVE G.K", "  3"
	If vmcount=701 Then PlaySound "beep":DisableTable 0:Tilted=0:LeftSlingshot.Disabled=1:RightSlingshot.Disabled=1
	If vmcount>800 AND vmcount<900 Then UltraDMD.ModifyScene00 "ready321a", "MOVE G.K", "  2"
	If vmcount=801 Then PlaySound "beep"
	If vmcount>900 AND vmcount<1000 Then UltraDMD.ModifyScene00 "ready321a", "MOVE G.K", "  1"
	If vmcount=901 Then PlaySound "beep"
	If vmcount=950 Then SCFrame.imageA="LCD_VMode_sc4"
	If vmcount=1000 Then UltraDMD.CancelRendering:SCreset.Enabled=1:PlaySound "fischio":Music:SCFrame.visible=0:screenprim.image="GKMode_bg"
	If vmcount>900  Then
		CPUCOUNT=CPUCOUNT+1
		If CPUCOUNT=20 Then tdfcolor=4:OpenTrapDoor True:GKMHelper1.IsDropped=0:GKMHelper2.IsDropped=0
		If CPUCOUNT>100 AND BALLOFF= 0 AND firstballout=1 Then
			trapkicker.CreateSizedBallWithMass 25,1.1:UpdateBall:trapkicker.Kick 180,25,1.56:TrapKickBall
			wkl1.isdropped=1:Wkl2.isdropped=1:wkc1.isdropped=1:Wkc2.isdropped=1:wkr1.isdropped=1:Wkr2.isdropped=1
			SDIR=RndNum(1,3):BALLOFF=1
			If sdir=1 Then wkl1.isdropped=0:wkl2.isdropped=0
			If sdir=2 Then wkc1.isdropped=0:wkc2.isdropped=0
			If sdir=3 Then wkr1.isdropped=0:wkr2.isdropped=0
		End If 
		If  CPUCOUNT>110 AND firstballout=1 Then rpin.isdropped=0
		If  CPUCOUNT=120 Then OpenTrapDoor False
		If  CPUCOUNT>300 AND firstballout=1 Then rpin.isdropped=1
		If  CPUCOUNT=368 AND firstballout=1 Then RightFlipper.RotateToEnd:PlaySoundAt SoundFXDOF("fx_flipperup", 102, DOFOn, DOFFlippers), RightFlipper
		If  CPUCOUNT>400 AND firstballout=1 Then wkl1.isdropped=1:Wkl2.isdropped=1:wkc1.isdropped=1:Wkc2.isdropped=1:wkr1.isdropped=1:wkr2.isdropped=1
		If  CPUCOUNT=401 AND firstballout=1 Then RightFlipper.RotateToStart:PlaySoundAt SoundFXDOF("fx_flipperdown", 102, DOFOff, DOFFlippers), RightFlipper
	End If
End Sub

Sub DrainGKmm
	CPUCOUNT=0:BALLOFF=0:gkwhit=0
	gkmmballs=gkmmballs+1
	If gkmmballs<5 OR GKMMSAVE>=5 Then CPUTIMER.enabled=1
	If gkmmballs>=5 AND GKMMSAVE<5 Then
		GKMScore=500000*GKMMSave
		CPUTIMER.enabled=0
		vmcount=0:firstballout=0:gkmmballs=0:GKMMSAVE=0:StopMusic
		UDMD_Display "black.bmp", "TOTAL SCORE", 14, -1, formatnumber(GKMScore,0), 14, -1, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,10
		GKHOLEin.ENABLED=1:GoalType=2:SCFrame.imageA="LCD_GKMode_sc00":SCFrame.visible=1
		LBOMB1.STATE=0:LBOMB2.STATE=0:LBOMB3.STATE=0:LBOMB4.STATE=0
		triggergoal.TimerInterval=2000:triggergoal.TimerEnabled=1
	End If
End Sub

Sub GoalGKmm
	PlaySound "DelusioneParata"
	CPUCOUNT=0:BALLOFF=0:gkwhit=0
	gkmmballs=gkmmballs+1
	If gkmmballs<5 Then
		CPUTIMER.enabled=1
		If gkmmballs=4 Then GKMode_4.image="GKMode_r":GKMode_4.visible=1
		If gkmmballs=3 Then GKMode_3.image="GKMode_r":GKMode_3.visible=1
		If gkmmballs=2 Then GKMode_2.image="GKMode_r":GKMode_2.visible=1
		If gkmmballs=1 Then GKMode_1.image="GKMode_r":GKMode_1.visible=1
	End If
	If gkmmballs>=5 Then
		GKMScore=500000*GKMMSave
		If GKMScore>=HighScore(5) Then HighScore(5)=GKMScore:GKMChamp(CurrentPlayer)=GKMScore
		CPUTIMER.enabled=0
		GKMode_5.image="GKMode_r":GKMode_5.visible=1
		vmcount=0:firstballout=0:gkmmballs=0:GKMMSAVE=0:StopMusic
		UDMD_Display "black.bmp", "TOTAL SCORE", 14, -1, formatnumber(GKMScore,0), 14, -1, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,10
		GKHOLEin.ENABLED=1:SCFrame.imageA="LCD_GKMode_sc00":SCFrame.visible=1
		LBOMB1.STATE=0:LBOMB2.STATE=0:LBOMB3.STATE=0:LBOMB4.STATE=0
		triggergoal.TimerInterval=2000:triggergoal.TimerEnabled=1
	End If
End Sub

Sub EndGKmm
	CPUTIMER.enabled=0:If Lx1.state=1 AND Lx2.state=1 Then Lx1.state=0:Lx2.state=0
	If GKModeBS=1 Then
		GKModeBS=0:If StrikerMode(CurrentPlayer)=1 Then gkmodel.state=0:gkmoder.state=0
	End If
	RestoreMatchLampStates:UpdateTeams:RightFlipper.Strength=flforce:LeftSlingshot.Disabled=0:RightSlingshot.Disabled=0
	screenprim.visible=0:SCFrame.visible=0:RInlane.collidable=1:RInlaneGK.collidable=0:UpdateTeamLogos:StopFlash TeamLogos(3),1
	GKMode_1.visible=0:GKMode_2.visible=0:GKMode_3.visible=0:GKMode_4.visible=0:GKMode_5.visible=0:GKMHelper1.IsDropped=1:GKMHelper2.IsDropped=1
	If win(CurrentPlayer)>defencestate(CurrentPlayer) Then win(CurrentPlayer)=defencestate(CurrentPlayer)
	If win(CurrentPlayer)=defencestate(CurrentPlayer) Then
		moveback=2:GKcount.Interval=2000:GKcount.enabled=1
	Else
		defenceup.enabled=1:GKcount.Interval=2000:GKcount.enabled=1
	End If
End Sub

'*********************************************************************
'*****GOAL KEEPER UP-DOWN************************************************
'*********************************************************************
Sub GKHOLEin_TIMER()
	If GKHOLEdown.rotx<90 Then gkholedown.rotx=gkholedown.rotx+3
	gkholeup.rotx=gkholeup.rotx-0.5
	headGK.z=headGK.z-1.5
	bootsGK.z=bootsGK.z-1.5
	kitGK.z=kitGK.z-1.5
	bodyGK.z=bodyGK.z-1.5
	GKpost.z=GKpost.z-1.5
    If GKHOLEup.rotx=-5 Then PlaySoundAt SoundFXDOF("fx_postup",130,DOFPulse,DOFGear),headGK
    If GKHOLEup.rotx<-90 Then
		gkholein.enabled=0
		If gkmm=1 Then
			kitgk.image="GK" & choiceteam(CurrentPlayer):headgk.image="T" & choiceteam(CurrentPlayer) & "F1":bodyGK.image="skinGK_" & SkinColor (choiceteam(CurrentPlayer))(0)
		End If
	End If
End Sub

Sub GKcount_timer
	GKcount.enabled=0:GKHOLEout.enabled=1
	If moveback=2 AND GKMM=1 Then
		GKMM=0:Music:MoveGK.Enabled=1:moveback=0:Lshoot.state=2
		ballrelease.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:Ballrelease.kick 90,7:PlaySoundAt SoundFXDOF("fx_ballrel",121,DOFPulse,DOFContactors),Ballrelease:kicked=0
	End If
	If GKMM=1 Then ResetGKTimer.Enabled=0
End Sub

Sub GKHOLEout_TIMER()
	If GKHOLEdown.rotx>0 Then gkholedown.rotx=gkholedown.rotx-3
	gkholeup.rotx=gkholeup.rotx+0.5
	headGK.z=headGK.z+1.5
	bootsGK.z=bootsGK.z+1.5
	kitGK.z=kitGK.z+1.5
	bodyGK.z=bodyGK.z+1.5
	GKpost.z=GKpost.z+1.5
	If GKHOLEup.rotx>0 Then
		gkholeout.enabled=0
		If moveback=99 Then
			moveback=0:MoveGK.Enabled=1
		End If
	End If
	If GKHOLEup.rotx=-85 Then PlaySoundAt SoundFXDOF("fx_postup",130,DOFPulse,DOFGear),headGK
End Sub 

'*********************************************************************
'****GOAL KEEPER BALL UNLOCK *****************************************
'*********************************************************************
Dim checkballT
Sub unlockball_Hit:checkballT=0:Me.timerenabled=1:End Sub
Sub unlockball_Unhit:Me.timerenabled=0:checkballT=0:End Sub

Sub unlockball_timer()
	checkballT=checkballT+1
	If checkballT=60 Then Me.timerenabled=0:checkballT=0:dcont=350:corner.enabled=1
End Sub

'************************************************************************
'*SCHEDULE***************************************************************
'************************************************************************
Dim TeamList,skillcount:TeamList=Array(_
"Real Madrid","Atl. Madrid","Barcelona","B. Munchen","Juventus","Sevilla","Paris S.G.","Manch. City","Borussia D.","Benfica","Arsenal","Porto","Napoli","Chelsea","Man. United",_
"Ajax","Bayer Lev.", "Schalke 04","Monaco","Liverpool","Wolfsburg","Tottenham","Feyenoord","PSV","Ol. Lyonnais","Ol. Marseille","Celtic","Milan","Roma","Salzburg","Rapid Wien","Inter")

Sub Schedule_timer
	me.enabled=0
	MakeOppontents
	qualifyprim.image="logo" & teamone(CurrentPlayer):vs1(CurrentPlayer)=TeamList(teamone(CurrentPlayer)-1)
	groupprim.image="logo" & teamtwo(CurrentPlayer):vs2(CurrentPlayer)=TeamList(teamtwo(CurrentPlayer)-1)
	firstprim.image="logo" & teamthree(CurrentPlayer):vs3(CurrentPlayer)=TeamList(teamthree(CurrentPlayer)-1)
	quarterprim.image="logo" & teamfour(CurrentPlayer):vs4(CurrentPlayer)=TeamList(teamfour(CurrentPlayer)-1)
	semiprim.image="logo" & teamfive(CurrentPlayer):vs5(CurrentPlayer)=TeamList(teamfive(CurrentPlayer)-1)
	finalprim.image="logo" & teamsix(CurrentPlayer):vs6(CurrentPlayer)=TeamList(teamsix(CurrentPlayer)-1)
	UpdateTeams:UpdateTeamLogos:StopFlash TeamLogos(3),1
	firstdefenceup.enabled=1:PlayLoopSoundAt SoundFXDOF("fx_motorD",128,DOFOn,DOFGear),defpost
	GKHOLEout.enabled=1:defencestate(CurrentPlayer)=1:Lwinqualify.state=2:LqualifyG.state=2
	If TeamSelection=1 Then
		UltraDMD.CancelRendering:ScheduleTS.Enabled=1:TeamSelection=0
		UltraDMD.SetScoreboardBackgroundImage "BACK" & choiceteam(CurrentPlayer) & ".png", 15, 10
	Else
		PlaySound "V.QUALIFY"		
		UDMD_Display "schedule.gif","qualify match", 14, 0, vs1(CurrentPlayer), 1, 14, UltraDMD_Animation_None, 1400, UltraDMD_Animation_FadeOut,7
	End If
End Sub

Sub ScheduleTS_Timer
	skillcount=skillcount+1
	If skillcount=1 Then
		UltraDMD.DisplayScene00Ex "logo" & choiceteam(CurrentPlayer) &".png"," ", 14, -1, TeamList(choiceteam(CurrentPlayer)-1), 14, 2, UltraDMD_Animation_None, 700, UltraDMD_Animation_FadeOut
		UltraDMD.DisplayScene00Ex "schedule.gif","qualify match", 14, 0, vs1(CurrentPlayer), 1, 14, UltraDMD_Animation_None, 1400, UltraDMD_Animation_FadeOut
	End If
	If skillcount=8 Then PlaySound "V.QUALIFY":SCReset.Enabled=1
	If skillCount=24 Then PlaySound "fischio":ReleaseNewBall
	If skillcount=55 Then UltraDMD.CancelRendering:Me.Enabled=0:skillcount=0
End Sub

Sub MakeOppontents
	Dim tstep:tstep=0
	Do
	tstep=tstep+1
	Select Case tstep
		Case 1
		teamone(CurrentPlayer)=RndNum(23,32)
		If teamone(CurrentPlayer)=choiceteam(CurrentPlayer) Then tstep=0
		Case 2
		teamtwo(CurrentPlayer)=RndNum(17,32)
		If teamtwo(CurrentPlayer)=choiceteam(CurrentPlayer) or teamtwo(CurrentPlayer)=teamone(CurrentPlayer) Then tstep=1
		Case 3
		teamthree(CurrentPlayer)=RndNum(12,27)
		If teamthree(CurrentPlayer)=choiceteam(CurrentPlayer) or teamthree(CurrentPlayer)=teamone(CurrentPlayer) or teamthree(CurrentPlayer)=teamtwo(CurrentPlayer) Then tstep=2
		Case 4
		teamfour(CurrentPlayer)=RndNum(7,22)
		If teamfour(CurrentPlayer)=choiceteam(CurrentPlayer) or teamfour(CurrentPlayer)=teamone(CurrentPlayer) or teamfour(CurrentPlayer)=teamtwo(CurrentPlayer) or teamfour(CurrentPlayer)=teamthree(CurrentPlayer) Then tstep=3
		Case 5
		teamfive(CurrentPlayer)=RndNum(1,17)
		If teamfive(CurrentPlayer)=choiceteam(CurrentPlayer) or teamfive(CurrentPlayer)=teamtwo(CurrentPlayer) or teamfive(CurrentPlayer)=teamthree(CurrentPlayer) or teamfive(CurrentPlayer)=teamfour(CurrentPlayer) Then tstep=4
		Case 6
		teamsix(CurrentPlayer)=RndNum(1,11)
		If teamsix(CurrentPlayer)=choiceteam(CurrentPlayer) or teamsix(CurrentPlayer)=teamfour(CurrentPlayer) or teamsix(CurrentPlayer)=teamfive(CurrentPlayer) Then tstep=5
	End Select
	Loop Until tstep = 7
End Sub

'************************************************************************
'*FIRST DEFENCE UP*******************************************************
'************************************************************************
Dim fuvel,dfup
Sub firstdefenceup_timer()
	dfup=dfup+1
	If dfup>100 Then	'move defenders after 1 second(s) so DMD can display opponent
		ResetGKTimer.enabled=0
		If liftD.rotx<90 Then liftD.rotx=liftD.rotx+1
		If sup3.z<-80 Then sup3.z=sup3.z+0.4
		If sup4.z<-80 Then sup4.z=sup4.z+0.4
		fuvel=fuvel-0.01
		headDEF1.z=headDEF1.z-fuvel:bodyDEF1.z=bodyDEF1.z-fuvel:bootsDEF1.z=bootsDEF1.z-fuvel:kitDEF1.z=kitDEF1.z-fuvel:defpost.z=defpost.z-fuvel:LdefL.Height=headDEF1.Z+100
		headDEF2.z=headDEF2.z-fuvel:bodyDEF2.z=bodyDEF2.z-fuvel:bootsDEF2.z=bootsDEF2.z-fuvel:kitDEF2.z=kitDEF2.z-fuvel:LdefC.Height=headDEF2.Z+100
		headDEF3.z=headDEF3.z-fuvel:bodyDEF3.z=bodyDEF1.z-fuvel:bootsDEF3.z=bootsDEF3.z-fuvel:kitDEF3.z=kitDEF3.z-fuvel:LdefR.Height=headDEF3.Z+100
		If headDEF1.z>-50 Then defenderL.isdropped=0:defenderC.isdropped=0:defenderR.isdropped=0:Wall35.ISDROPPED=0
		If headDEF1.z>12 Then firstdefenceup.enabled=0:PlaySound "laser":screenprim.visible=0:screenprim1.visible=0:StopSound "fx_motorD":fuvel=0:dfup=0:DOF 128,DOFOff:exit Sub 
	End If
End Sub

'************************************************************************
'*UPDATE TEAM KITS, FACES, SKIN COLOR ***********************************
'************************************************************************
Dim SkinColor:SkinColor=Array("",_
Array(1,1,0,1,0,0), Array(0,0,0,0,0,0), Array(0,0,0,0,0,0), Array(0,0,1,2,0,0), Array(0,0,0,1,0,0), Array(0,0,0,0,0,0), Array(1,1,0,1,1,1), Array(1,1,0,2,0,1),_
Array(0,0,0,0,0,2), Array(0,0,1,0,0,0), Array(0,0,0,0,0,1), Array(0,2,0,0,2,1), Array(0,0,2,0,0,0), Array(0,0,0,0,0,0), Array(0,2,0,2,2,0), Array(2,0,0,0,0,0),_
Array(0,1,1,0,0,0), Array(0,1,0,0,0,0), Array(0,0,2,2,2,0), Array(0,1,1,0,0,0), Array(0,1,0,0,0,2), Array(0,0,0,0,0,0), Array(2,0,2,0,0,0), Array(0,0,2,2,0,0),_
Array(0,0,0,2,0,1), Array(2,0,2,0,0,1), Array(0,0,0,0,0,2), Array(0,0,0,0,0,0), Array(0,0,0,0,0,0), Array(0,2,0,0,0,0), Array(0,0,0,0,0,0), Array(0,1,0,0,0,0))

Sub UpdateTeams
Select Case progress(CurrentPlayer)
	Case 0
		'update kits
		kitdef1.image="kit" & teamone(CurrentPlayer):kitDEF2.image="kit" & teamone(CurrentPlayer):kitDEF3.image="kit" & teamone(CurrentPlayer):kitGK.image="gk" & teamone(CurrentPlayer)
		If HeadLD.Z<0 Then kitLD.image="kit" & teamone(CurrentPlayer):kitRD.image="kit" & teamone(CurrentPlayer)
		'update faces
		headGK.image="T" & teamone(CurrentPlayer) &"F1": headDEF1.image="T" & teamone(CurrentPlayer) &"F2":headDEF2.image="T" & teamone(CurrentPlayer) &"F3":headDEf3.image="T" & teamone(CurrentPlayer) &"F4"
		If HeadLD.Z<0 Then headLD.image="T" & teamone(CurrentPlayer) &"F5":headRD.image="T" & teamone(CurrentPlayer) &"F6"
		'update skins
		bodyGK.image="skinGK_" & SkinColor (teamone(CurrentPlayer))(0)
		bodyDEF1.image="skin_" & SkinColor (teamone(CurrentPlayer))(1)
		bodyDEF2.image="skin_" & SkinColor (teamone(CurrentPlayer))(2)
		bodyDEF3.image="skin_" & SkinColor (teamone(CurrentPlayer))(3)
		If HeadLD.Z<0 Then bodyRD.image="skin_" & SkinColor (teamone(CurrentPlayer))(4):bodyLD.image="skin_" & SkinColor (teamone(CurrentPlayer))(5)
    Case 1
		'update kits
		kitdef1.image="kit" & teamtwo(CurrentPlayer):kitDEF2.image="kit" & teamtwo(CurrentPlayer):kitDEF3.image="kit" & teamtwo(CurrentPlayer)::kitGK.image="gk" & teamtwo(CurrentPlayer)
		If HeadLD.Z<0 Then kitLD.image="kit" & teamtwo(CurrentPlayer):kitRD.image="kit" & teamtwo(CurrentPlayer)
		'update faces
		headGK.image="T" & teamtwo(CurrentPlayer) &"F1": headDEF1.image="T" & teamtwo(CurrentPlayer) &"F2":headDEF2.image="T" & teamtwo(CurrentPlayer) &"F3":headDEf3.image="T" & teamtwo(CurrentPlayer) &"F4"
		If HeadLD.Z<0 Then headLD.image="T" & teamtwo(CurrentPlayer) &"F5":headRD.image="T" & teamtwo(CurrentPlayer) &"F6"
		'update skins
		bodyGK.image="skinGK_" & SkinColor (teamtwo(CurrentPlayer))(0)
		bodyDEF1.image="skin_" & SkinColor (teamtwo(CurrentPlayer))(1)
		bodyDEF2.image="skin_" & SkinColor (teamtwo(CurrentPlayer))(2)
		bodyDEF3.image="skin_" & SkinColor (teamtwo(CurrentPlayer))(3)
		If HeadLD.Z<0 Then bodyRD.image="skin_" & SkinColor (teamtwo(CurrentPlayer))(4):bodyLD.image="skin_" & SkinColor (teamtwo(CurrentPlayer))(5)
	Case 2
		'update kits
		kitdef1.image="kit" & teamthree(CurrentPlayer):kitDEF2.image="kit" & teamthree(CurrentPlayer):kitDEF3.image="kit" & teamthree(CurrentPlayer):kitGK.image="gk" & teamthree(CurrentPlayer)
		If HeadLD.Z<0 Then kitLD.image="kit" & teamthree(CurrentPlayer):kitRD.image="kit" & teamthree(CurrentPlayer)
		'update faces
		headGK.image="T" & teamthree(CurrentPlayer) &"F1": headDEF1.image="T" & teamthree(CurrentPlayer) &"F2":headDEF2.image="T" & teamthree(CurrentPlayer) &"F3":headDEf3.image="T" & teamthree(CurrentPlayer) &"F4"
		If HeadLD.Z<0 Then headLD.image="T" & teamthree(CurrentPlayer) &"F5":headRD.image="T" & teamthree(CurrentPlayer) &"F6"
		'update skins
		bodyGK.image="skinGK_" & SkinColor (teamthree(CurrentPlayer))(0)
		bodyDEF1.image="skin_" & SkinColor (teamthree(CurrentPlayer))(1)
		bodyDEF2.image="skin_" & SkinColor (teamthree(CurrentPlayer))(2)
		bodyDEF3.image="skin_" & SkinColor (teamthree(CurrentPlayer))(3)
		If HeadLD.Z<0 Then bodyRD.image="skin_" & SkinColor (teamthree(CurrentPlayer))(4):bodyLD.image="skin_" & SkinColor (teamthree(CurrentPlayer))(5)
	Case 3
		'update kits
		kitdef1.image="kit" & teamfour(CurrentPlayer):kitDEF2.image="kit" & teamfour(CurrentPlayer):kitDEF3.image="kit" & teamfour(CurrentPlayer):kitGK.image="gk" & teamfour(CurrentPlayer)
		If HeadLD.Z<0 Then kitLD.image="kit" & teamfour(CurrentPlayer):kitRD.image="kit" & teamfour(CurrentPlayer)
		'update faces
		headGK.image="T" & teamfour(CurrentPlayer) &"F1": headDEF1.image="T" & teamfour(CurrentPlayer) &"F2":headDEF2.image="T" & teamfour(CurrentPlayer) &"F3":headDEf3.image="T" & teamfour(CurrentPlayer) &"F4"
		If HeadLD.Z<0 Then headLD.image="T" & teamfour(CurrentPlayer) &"F5":headRD.image="T" & teamfour(CurrentPlayer) &"F6"
		'update skins
		bodyGK.image="skinGK_" & SkinColor (teamfour(CurrentPlayer))(0)
		bodyDEF1.image="skin_" & SkinColor (teamfour(CurrentPlayer))(1)
		bodyDEF2.image="skin_" & SkinColor (teamfour(CurrentPlayer))(2)
		bodyDEF3.image="skin_" & SkinColor (teamfour(CurrentPlayer))(3)
		If HeadLD.Z<0 Then bodyRD.image="skin_" & SkinColor (teamfour(CurrentPlayer))(4):bodyLD.image="skin_" & SkinColor (teamfour(CurrentPlayer))(5)
	Case 4
		'update kits
		kitdef1.image="kit" & teamfive(CurrentPlayer):kitDEF2.image="kit" & teamfive(CurrentPlayer):kitDEF3.image="kit" & teamfive(CurrentPlayer):kitGK.image="gk" & teamfive(CurrentPlayer)
		If HeadLD.Z<0 Then kitLD.image="kit" & teamfive(CurrentPlayer):kitRD.image="kit" & teamfive(CurrentPlayer)
		'update faces
		headGK.image="T" & teamfive(CurrentPlayer) &"F1": headDEF1.image="T" & teamfive(CurrentPlayer) &"F2":headDEF2.image="T" & teamfive(CurrentPlayer) &"F3":headDEf3.image="T" & teamfive(CurrentPlayer) &"F4"
		If HeadLD.Z<0 Then headLD.image="T" & teamfive(CurrentPlayer) &"F5":headRD.image="T" & teamfive(CurrentPlayer) &"F6"
		'update skins
		bodyGK.image="skinGK_" & SkinColor (teamfive(CurrentPlayer))(0)
		bodyDEF1.image="skin_" & SkinColor (teamfive(CurrentPlayer))(1)
		bodyDEF2.image="skin_" & SkinColor (teamfive(CurrentPlayer))(2)
		bodyDEF3.image="skin_" & SkinColor (teamfive(CurrentPlayer))(3)
		If HeadLD.Z<0 Then bodyRD.image="skin_" & SkinColor (teamfive(CurrentPlayer))(4):bodyLD.image="skin_" & SkinColor (teamfive(CurrentPlayer))(5)
	Case 5
		'update kits
		kitdef1.image="kit" & teamsix(CurrentPlayer):kitDEF2.image="kit" & teamsix(CurrentPlayer):kitDEF3.image="kit" & teamsix(CurrentPlayer):kitGK.image="gk" & teamsix(CurrentPlayer)
		If HeadLD.Z<0 Then kitLD.image="kit" & teamsix(CurrentPlayer):kitRD.image="kit" & teamsix(CurrentPlayer)
		'update faces
		headGK.image="T" & teamsix(CurrentPlayer) &"F1": headDEF1.image="T" & teamsix(CurrentPlayer) &"F2":headDEF2.image="T" & teamsix(CurrentPlayer) &"F3":headDEf3.image="T" & teamsix(CurrentPlayer) &"F4"
		If HeadLD.Z<0 Then headLD.image="T" & teamsix(CurrentPlayer) &"F5":headRD.image="T" & teamsix(CurrentPlayer) &"F6"
		'update skins
		bodyGK.image="skinGK_" & SkinColor (teamsix(CurrentPlayer))(0)
		bodyDEF1.image="skin_" & SkinColor (teamsix(CurrentPlayer))(1)
		bodyDEF2.image="skin_" & SkinColor (teamsix(CurrentPlayer))(2)
		bodyDEF3.image="skin_" & SkinColor (teamsix(CurrentPlayer))(3)
		If HeadLD.Z<0 Then bodyRD.image="skin_" & SkinColor (teamsix(CurrentPlayer))(4):bodyLD.image="skin_" & SkinColor (teamsix(CurrentPlayer))(5)
End Select
End Sub

'**********************************************************************
'****GOAL KEEPER*******************************************************
'**********************************************************************
Dim move,posGK,posWALL,GKMMSAVE
Dim gkwhit:gkwhit=0

Sub moveGK_timer()
	If gkmm=0 Then
		DOF 129, DOFPulse
		For each ii in GkWalls:ii.IsDropped=1:Next
		move=move+0.035
		posGK=sin(move)*60
		headGK.transx=posGK
		bootsGK.transx=posGK
		kitGK.transx=posGK
		bodyGK.transx=posGK
		GKpost.transx=posGK
		posWALL=posGK/60
		If poswall<-0.8 AND poswall>-1 Then GKwall1.isdropped=0:StopSound "fx_motorGK":DOF 160,DOFOff:PlaySound SoundFXDOF("fx_motorGK",129,DOFOn,DOFGear),1,0.2, -0.5
		If poswall<-0.6 AND poswall>-0.8 Then GKwall2.isdropped=0
		If poswall<-0.4 AND poswall>-0.6 Then GKwall3.isdropped=0
		If poswall<-0.2 AND poswall>-0.4 Then GKwall4.isdropped=0
		If poswall<-0.0 AND poswall>-0.2 Then GKwall5.isdropped=0
		If poswall>0.0 AND poswall <0.2 Then GKwall6.isdropped=0
		If poswall>0.2 AND poswall <0.4 Then GKwall7.isdropped=0
		If poswall>0.4 AND poswall <0.6 Then GKwall8.isdropped=0
		If poswall>0.6 AND poswall <0.8 Then GKwall9.isdropped=0
		If poswall>0.8 AND poswall <1 Then GKwall10.isdropped=0:StopSound "fx_motorGK":DOF 160,DOFOff:PlaySound SoundFXDOF("fx_motorGK",129,DOFOn,DOFGear),1,0.2, 0.5
	End If
End Sub

Sub GKWalls_Hit(idx)
If Tilted=0 Then
	PlaySoundAt SoundFXDOF("fx_hitplayer",117,DOFPulse,DOFShaker),ActiveBall
	GKWalls(idx).TimerInterval=500:GKWalls(idx).TimerEnabled=1
	If gkmm=0 Then
		If gkwhit=0 Then
			gkwhit=1
			PlaySound "DelusioneParata":scores(CurrentPlayer)=scores(CurrentPlayer)+13540:RandomSoundGKSave
			UDMD_Display "buffon.gif", "    SAVED    ", -1, 15, "", 15, 0, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,4
		End If
	End If
    If gkmm=1 Then
		If gkwhit=0 Then
			gkwhit=1
			scores(CurrentPlayer)=scores(CurrentPlayer)+500000
			UDMD_Display "buffon.gif", "SAVED!!!", 0, 14, "500.000", 14, -1, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,4
			GKMMSAVE=GKMMSAVE+1:DOF 118,DOFPulse
			If GKMMSAVE=5 Then PlaySound "5_five":AddExtraBall
			If GKMMSAVE=4 Then PlaySound "4_four"
			If GKMMSAVE=3 Then PlaySound "3_three"
			If GKMMSAVE=2 Then PlaySound "2_two"
			If GKMMSAVE=1 Then PlaySound "1_one"
			'first shot
			If gkmmballs=0 Then GKMode_1.image="GKMode_g":GKMode_1.visible=1:FlasherEffect 3:exit sub
			'2nd shot
			If gkmmballs=1 Then GKMode_2.image="GKMode_g":GKMode_2.visible=1:FlasherEffect 3:exit sub
			'3rd shot
			If gkmmballs=2 Then GKMode_3.image="GKMode_g":GKMode_3.visible=1:FlasherEffect 3:exit sub
			'4th shot
			If gkmmballs=3 Then GKMode_4.image="GKMode_g":GKMode_4.visible=1:FlasherEffect 3:exit sub
			'5th shot
			If gkmmballs=4 Then GKMode_5.image="GKMode_g":GKMode_5.visible=1:FlasherEffect 3:exit sub
		End If
	End If
End If
End Sub

Sub GKWall1_timer:Me.TimerEnabled=0:gkwhit=0:End Sub
Sub GKWall2_timer:Me.TimerEnabled=0:gkwhit=0:End Sub
Sub GKWall3_timer:Me.TimerEnabled=0:gkwhit=0:End Sub
Sub GKWall4_timer:Me.TimerEnabled=0:gkwhit=0:End Sub
Sub GKWall5_timer:Me.TimerEnabled=0:gkwhit=0:End Sub
Sub GKWall6_timer:Me.TimerEnabled=0:gkwhit=0:End Sub
Sub GKWall7_timer:Me.TimerEnabled=0:gkwhit=0:End Sub
Sub GKWall8_timer:Me.TimerEnabled=0:gkwhit=0:End Sub
Sub GKWall9_timer:Me.TimerEnabled=0:gkwhit=0:End Sub
Sub GKWall10_timer:Me.TimerEnabled=0:gkwhit=0:End Sub

Sub Rpalo_Hit
PlaySoundAt "palo1",ActiveBall
If Tilted=0 Then
	scores(CurrentPlayer)=scores(CurrentPlayer)+540
	OnScoreboardChanged
End If
End Sub

Sub Lpalo_Hit
PlaySoundAt "palo1",ActiveBall
If Tilted=0 Then
	scores(CurrentPlayer)=scores(CurrentPlayer)+540
	OnScoreboardChanged
End If
End Sub

Sub RandomSoundGKSave()
	Select Case Int(Rnd*7)+1
		Case 1 : PlaySound "V.great hands"
		Case 2 : PlaySound "V.great save"
		Case 3 : PlaySound "V.how he"
		Case 4 : PlaySound "V.i cant believe"
		Case 5 : PlaySound "V.Incredible save"
		Case 6 : PlaySound "V.is a wall"
		Case 7 : PlaySound "V.unbeatable"
	End Select
End Sub

Sub StopSoundGKSave:StopSound "V.great hands":StopSound "V.great save":StopSound "V.how he":StopSound "V.i cant believe":StopSound "V.Incredible save":StopSound "V.is a wall":StopSound "V.unbeatable":End Sub

'************************************************************************
'*MOVE MISTER TOY *******************************************************
'************************************************************************
Dim mtc
'move the toy 'ntimes' at 'MoveSpeed' speed
Sub MisterToyMove(ntimes,MoveSpeed)
	mtc=ntimes*2-1
	MisterMove.Interval=MoveSpeed:MisterMove.Enabled=1
End Sub

Sub MisterMove_timer
	Dim nsteps
	If mtc>1 Then nsteps=mtc MOD 2 Else nsteps=mtc End If
	If nsteps=1 Then MisterHead.transZ=35:PlaySoundAt SoundFXDOF("fx_postup",133,DOFPulse,DOFDropTargets),MisterHead Else MisterHead.transZ=0 End If
	mtc=mtc-1
	If mtc<0 Then Me.Enabled=0:MisterHead.transZ=0
End Sub

'************************************************************************
'*STRIKER BOUNCING*******************************************************
'************************************************************************
Dim bou,brake,perc,sbou,bou2,brake2,perc2,sbou2
Sub bouncingR_timer()
    bou=bou+0.3:brake=brake+0.02 
    If (perc-(brake*(perc/6)))<0 Then bouncingR.Enabled = 0 :bou=0 :brake=0 :perc=0
    headRD.rotx=sin(bou)*(perc-(brake*(perc/6)))
    bodyRD.rotx=sin(bou)*(perc-(brake*(perc/6)))
    bootsRD.rotx=sin(bou)*(perc-(brake*(perc/6)))
    kitRD.rotx=sin(bou)*(perc-(brake*(perc/6))) 
    baseRD.rotx=sin(bou)*(perc-(brake*(perc/6)))  
    headRD.roty=cos((bou)*sbou)*(perc-(brake*(perc/6)))
    bodyRD.roty=cos((bou)*sbou)*(perc-(brake*(perc/6)))
    bootsRD.roty=cos((bou)*sbou)*(perc-(brake*(perc/6)))
    kitRD.roty=cos((bou)*sbou)*(perc-(brake*(perc/6)))
    baseRD.roty=cos((bou)*sbou)*(perc-(brake*(perc/6)))
End Sub

Sub bouncingL_timer()
    bou2=bou2+0.3:brake2=brake2+0.02 
    If (perc2-(brake2*(perc2/6)))<0 Then bouncingL.Enabled = 0 :bou2=0 :brake2=0 :perc2=0
	headLD.rotx=sin(bou2)*(perc2-(brake2*(perc2/6)))
	bodyLD.rotx=sin(bou2)*(perc2-(brake2*(perc2/6)))
	bootsLD.rotx=sin(bou2)*(perc2-(brake2*(perc2/6)))
	kitLD.rotx=sin(bou2)*(perc2-(brake2*(perc2/6)))
	baseLD.rotx=sin(bou2)*(perc2-(brake2*(perc2/6)))   
    headLD.roty=cos((bou2)*sbou2)*(perc2-(brake2*(perc2/6)))
    bodyLD.roty=cos((bou2)*sbou2)*(perc2-(brake2*(perc2/6)))
    bootsLD.roty=cos((bou2)*sbou2)*(perc2-(brake2*(perc2/6)))
    kitLD.roty=cos((bou2)*sbou2)*(perc2-(brake2*(perc2/6)))
    baseLD.roty=cos((bou2)*sbou2)*(perc2-(brake2*(perc2/6)))
End Sub

'************************************************************************
'*LEFT STRIKER UP********************************************************
'************************************************************************
Dim shakeL
Sub bomberLup_timer()
	shakeL=shakeL+0.5
    If lift1.rotx<90 Then lift1.rotx=lift1.rotx+10
    hitLD.isdropped=0:WALL32.ISDROPPED=0
	If headLD.Z<0 then headLD.z=headLD.z+25:kitLD.z=headLD.z:bootsLD.z=headLD.z:bodyLD.z=headLD.z:baseLD.z=headLD.z:sup1.z=-60
	If headLD.Z>-25 Then bouncingL.Enabled=1
	If shakeL<16 Then
		headLD.transz=10*Sin(shakeL):kitLD.transz=headLD.transz:bootsLD.transz=headLD.transz:bodyLD.transz=headLD.transz
	Else
		 Me.enabled=0:shakeL=0:LbombL.Height=140
		If DefenceLocked(CurrentPlayer)=0 Then	Lbomb1.state=0:Lbomb2.state=0:Lbomb3.state=0:Lbomb4.state=0
	End If
 End Sub

'************************************************************************
'*RIGHT STRIKER UP*******************************************************
'************************************************************************
Dim shakeR
Sub bomberRup_timer()
    shakeR=shakeR+0.5
    If lift2.rotx<90 Then lift2.rotx=lift2.rotx+10
    hitRD.isdropped=0:WALL33.ISDROPPED=0
    If headRD.Z<0 then headRD.z=headRD.z+25:kitRD.z=headRD.z:bootsRD.z=headRD.z:bodyRD.z=headRD.z:baseRD.z=headRD.z:sup2.z=-60
	If headLD.Z>-25 Then bouncingR.Enabled=1
    If shakeR<16 Then
		headRD.transz=10*Sin(shakeR):kitRD.transz=headRD.transz:bootsRD.transz=headRD.transz:bodyRD.transz=headRD.transz
	Else
		Me.enabled=0:shakeR=0:LbombR.Height=140
		If DefenceLocked(CurrentPlayer)=0 Then	Lbomb1.state=0:Lbomb2.state=0:Lbomb3.state=0:Lbomb4.state=0
	End If
End Sub

'************************************************************************
'*LEFT STRIKER DOWN******************************************************
'************************************************************************
Sub bomberLdown_timer()
    headLD.z=-170:kitLD.z=-170:bootsLD.z=-170:bodyLD.z=-170:baseLD.z=-170:sup1.z=-120:LbombL.Height=-140
	lift1.rotx=lift1.rotx-10
    If lift1.rotx<=0 Then
		bomberLdown.enabled=0:If BomberLState=1 Then Wall32.TimerInterval=300:Wall32.TimerEnabled=1
	End If
End Sub

Sub Wall32_timer:Me.TimerEnabled=0:UpdateTeams:bomberLup.Enabled=1:BomberLState=0:End Sub

'************************************************************************
'*RIGHT STRIKER DOWN*****************************************************
'************************************************************************
Sub bomberRdown_timer()
	headRD.z=-170:kitRD.z=-170:bootsRD.z=-170:bodyRD.z=-170:baseRD.z=-170:sup2.z=-120:LbombR.Height=-140
	lift2.rotx=lift2.rotx-10
	If lift2.rotx<=0 Then
		bomberRdown.enabled=0:If BomberRState=1 Then Wall33.TimerInterval=300:Wall33.TimerEnabled=1
	End If
End Sub

Sub Wall33_timer:Me.TimerEnabled=0:UpdateTeams:bomberRup.Enabled=1:BomberRState=0:End Sub

'************************************************************************
'*DEFENDERS**************************************************************
'************************************************************************
Dim defenderhit:defenderhit=0
Sub defenderL_timer:me.timerenabled=0:defenderhit=0:OnScoreboardChanged:End Sub
Sub defenderR_timer:me.timerenabled=0:defenderhit=0:OnScoreboardChanged:End Sub
Sub defenderC_timer:me.timerenabled=0:defenderhit=0:OnScoreboardChanged:End Sub

Sub Defenders_hit(idx)
If Tilted= 0 Then
	scores(CurrentPlayer)=scores(CurrentPlayer)+10000:defenderhit=1
	StopSound "fx_hitplayer":PlaySoundAt SoundFXDOF("fx_hitplayer",115,DOFPulse,DOFShaker), ActiveBall
	LightEffect 0:GIeffect 0:FlasherEffect 3:DOF 116,DOFPulse
	Select case idx
	Case 0	'left defender
		If defL.state=0 AND defenderhit=0 AND MVPOfTheYear(CurrentPlayer)=0 Then
			UDMD_Display "black.bmp", "DEFENDER", 0, 14, "HIT!!!", 14, -1, UltraDMD_Animation_ScrollOnDown, 1000, UltraDMD_Animation_ScrollOffDown,4
		End If
		If NOT defL.state=2 AND MVPOfTheYear(CurrentPlayer)=0 Then defL.state=1
		percdefL=percdefL+3:defLbouncing.enabled=1
		defenderL.timerinterval=800:defenderL.timerenabled=1

	Case 1	'center defender
		If defC.state=0 AND defenderhit=0 AND MVPOfTheYear(CurrentPlayer)=0 Then
			UDMD_Display "black.bmp", "DEFENDER", 0, 14, "HIT!!!", 14, -1, UltraDMD_Animation_ScrollOnDown, 1000, UltraDMD_Animation_ScrollOffDown,4
		End If
		If NOT defC.state=2 AND MVPOfTheYear(CurrentPlayer)=0 Then defC.state=1
		percdefC=percdefC+3:defCbouncing.enabled=1
		defenderC.timerinterval=800:defenderC.timerenabled=1

	Case 2	'right defender
		If defR.state=0 AND defenderhit=0 AND MVPOfTheYear(CurrentPlayer)=0 Then
			UDMD_Display "black.bmp", "DEFENDER", 0, 14, "HIT!!!", 14, -1, UltraDMD_Animation_ScrollOnDown, 1000, UltraDMD_Animation_ScrollOffDown,4
		End If
		If NOT defR.state=2 AND MVPOfTheYear(CurrentPlayer)=0 Then defR.state=1
		percdefR=percdefR+3:defRbouncing.enabled=1
		defenderR.timerinterval=800:defenderR.timerenabled=1

	End Select

	If defC.state=1 AND defR.state=1 AND defL.state=1 AND FK=0 AND MVPOfTheYear(CurrentPlayer)=0 Then
		If win(CurrentPlayer)<5 OR (win(CurrentPlayer)=5 AND defencestate(CurrentPlayer)<6)then
			If NOT defencedown.Enabled Then win(CurrentPlayer)=win(CurrentPlayer)+1:UpdateMatchLevelLights 1:CheckMatchLevel
		End If
		If win(CurrentPlayer)=5 AND defencestate(CurrentPlayer)=6 AND DefenceLocked(CurrentPlayer)=0 Then
			'lock the defence, you need to hit Strikers to proceed to the final
			DefenceLocked(CurrentPlayer)=1
			'move Strikers up
			If headLD.Z<0 Then bomberLup.enabled=1:brake2=0:perc2=perc2+3:sbou2=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",134,DOFPulse,DOFDropTargets),headLD
			If headRD.Z<0 Then bomberRup.enabled=1:brake=0:perc=perc+3:sbou=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",135,DOFPulse,DOFDropTargets),headRD
		End If
		If win(CurrentPlayer)=5 AND defencestate(CurrentPlayer)=6 AND DefenceLocked(CurrentPlayer)=2 Then
			win(CurrentPlayer)=6:UpdateMatchLevelLights 1:CheckMatchLevel:DefenceLocked(CurrentPlayer)=0:UpdateB2SLogos
			For each ii in VMFlashers:Flash ii,75:Next:Flash lClWin,75
		End If
	End If
End If
End Sub

Dim boudefL,brakedefL,percdefL
Sub defLbouncing_timer()
	boudefL=boudefL+0.4:brakedefL=brakedefL+0.02 
	If (percdefL-(brakedefL*(percdefL/6)))<0 Then defLbouncing.Enabled = 0 :boudefL=0 :brakedefL=0 :percdefL=0
	headDEF1.rotx=sin(boudefL)*(percdefL-(brakedefL*(percdefL/6)))
	bodyDEF1.rotx=sin(boudefL)*(percdefL-(brakedefL*(percdefL/6)))
	bootsDEF1.rotx=sin(boudefL)*(percdefL-(brakedefL*(percdefL/6)))
	kitDEF1.rotx=sin(boudefL)*(percdefL-(brakedefL*(percdefL/6))) 
End Sub

Dim boudefC,brakedefC,percdefC
Sub defCbouncing_timer()
	boudefC=boudefC+0.5:brakedefC=brakedefC+0.02 
	If (percdefC-(brakedefC*(percdefC/6)))<0 Then defCbouncing.Enabled = 0 :boudefC=0 :brakedefC=0 :percdefC=0
	headDEF2.rotx=sin(boudefC)*(percdefC-(brakedefC*(percdefC/6)))
	bodyDEF2.rotx=sin(boudefC)*(percdefC-(brakedefC*(percdefC/6)))
	bootsDEF2.rotx=sin(boudefC)*(percdefC-(brakedefC*(percdefC/6)))
	kitDEF2.rotx=sin(boudefC)*(percdefC-(brakedefC*(percdefC/6))) 
End Sub

Dim boudefR,brakedefR,percdefR
Sub defRbouncing_timer()
    boudefR=boudefR+0.4:brakedefR=brakedefR+0.02 
    If (percdefR-(brakedefR*(percdefR/6)))<0 Then defRbouncing.Enabled = 0 :boudefR=0 :brakedefR=0 :percdefR=0
    headDEF3.rotx=sin(boudefR)*(percdefR-(brakedefR*(percdefR/6)))
    bodyDEF3.rotx=sin(boudefR)*(percdefR-(brakedefR*(percdefR/6)))
    bootsDEF3.rotx=sin(boudefR)*(percdefR-(brakedefR*(percdefR/6)))
    kitDEF3.rotx=sin(boudefR)*(percdefR-(brakedefR*(percdefR/6))) 
End Sub

'*********************************************************************
'*****MATCH LEVEL*****************************************************
'*********************************************************************
Sub CheckMatchLevel
	If win(CurrentPlayer)=defencestate(CurrentPlayer) Then
		defL.state=2:defC.state=2:defR.state=2:Lshoot.state=2
		FlashForMs fl1,3000,100,0:FlashForMs fl1a,3000,100,0:FlashForMs dome1,3000,100,0
		FlashForMs fl2,3000,100,0:FlashForMs fl2a,3000,100,0:FlashForMs dome2,3000,100,0
		CornerModeOff:DOF 145, DOFPulse
		defencedown.enabled=1:MoveGK.enabled=1:PlaySound "bassdown":PlayLoopSoundAt SoundFXDOF("fx_motorD",128,DOFOn,DOFGear),defpost
		If MVPOfTheYear(CurrentPlayer)=0 Then scores(CurrentPlayer)=scores(CurrentPlayer)+100000*win(CurrentPlayer)
		If MVPOfTheYear(CurrentPlayer)=0 Then UDMD_Display "black.bmp", "DEFENCE", 0, 14, "DEFEATED", 14, -1, UltraDMD_Animation_ScrollOnDown, 1000, UltraDMD_Animation_ScrollOffDown,4
		ArrowEffect True
	Else
		defL.state=0:defC.state=0:defR.state=0
	End If
End Sub

Sub CheckOpponent_Timer
Me.Enabled=0:CornerModeOn
If defencestate(CurrentPlayer)=2 Then UDMD_Display "schedule.gif", "group stage", 14,0,vs2(CurrentPlayer),1,14, UltraDMD_Animation_None, 2500, UltraDMD_Animation_FadeOut,7:PlaySound "V.GROUPMATCH"
If defencestate(CurrentPlayer)=3 Then UDMD_Display "schedule.gif", "round of 16", 14,0,vs3(CurrentPlayer),1,14, UltraDMD_Animation_None, 2500, UltraDMD_Animation_FadeOut,7:PlaySound "V.FROUNDMATCH"
If defencestate(CurrentPlayer)=4 Then UDMD_Display "schedule.gif", "qua. finals", 14,0,vs4(CurrentPlayer),1,14, UltraDMD_Animation_None, 2500, UltraDMD_Animation_FadeOut,7:PlaySound "V.QUARTEFMATCH"
If defencestate(CurrentPlayer)=5 Then
	UltraDMD.DisplayScene00Ex "schedule.gif", "semifinals", 14,0,vs5(CurrentPlayer),1,14, UltraDMD_Animation_None, 1500, UltraDMD_Animation_FadeOut:PlaySound "V.SEMIFMATCH"
End If
If defencestate(CurrentPlayer)=6 Then
	PlaySound "jackpotgingle":PlaySound "V.FINAL"
	UltraDMD.DisplayScene00Ex "schedule_f.gif", "", 14,0,"",1,14, UltraDMD_Animation_None, 2500, UltraDMD_Animation_FadeOut
	UltraDMD.DisplayScene00Ex "schedule.gif", "final", 14,0,vs6(CurrentPlayer),1,14, UltraDMD_Animation_None, 400, UltraDMD_Animation_FadeOut:SCReset.Enabled=1
End If
End Sub

Sub SemiFinalAwardTimer_timer
    If Not UltraDMD.IsRendering Then				
        Me.Enabled=0											'When the scene finishes rendering ...	
		If TrapDoorP.Z=0 AND headLD.z<0 AND headRD.z<0 Then		'If Snack Bar and bombers are down
			EBAwardTimer.Enabled=1:EBAw=1						'Start the EB award and opens the Snack Bar
		Else
			AddExtraBall										'Get the EB directly
		End If
	End If
End Sub

'*********************************************************************
'*****DEFENDER MOVE***************************************************
'*********************************************************************
Dim dvel,uvel,resetcomplete

Sub defencedown_timer()
	resetcomplete=0
	If liftD.rotx>0 AND headdef1.z<-50 Then liftD.rotx=liftD.rotx-0.5
	If sup3.z>-120  AND headdef1.z<-50 Then sup3.z=sup3.z-0.2
	If sup4.z>-120 AND headdef1.z<-50  Then sup4.z=sup4.z-0.2
	dcont=dcont+1
	dvel=dvel+0.005
	If headDEF1.z>-170 Then headDEF1.z=headDEF1.z-dvel:bodyDEF1.z=bodyDEF1.z-dvel:bootsDEF1.z=bootsDEF1.z-dvel:kitDEF1.z=kitDEF1.z-dvel:defpost.z=defpost.z-dvel:LdefL.Height=headDEF1.Z+100
	If headDEF2.z>-170 Then headDEF2.z=headDEF2.z-dvel:bodyDEF2.z=bodyDEF2.z-dvel:bootsDEF2.z=bootsDEF2.z-dvel:kitDEF2.z=kitDEF2.z-dvel:LdefC.Height=headDEF2.Z+100
	If headDEF3.z>-170 Then headDEF3.z=headDEF3.z-dvel:bodyDEF3.z=bodyDEF1.z-dvel:bootsDEF3.z=bootsDEF3.z-dvel:kitDEF3.z=kitDEF3.z-dvel:LdefR.Height=headDEF3.Z+100
	If headDef1.z<-169 Then StopSound "fx_motorD":defenderL.isdropped=1:defenderC.isdropped=1:defenderR.isdropped=1:Wall35.ISDROPPED=1:defL.state=0:defC.state=0:defR.state=0:DOF 128,DOFOff
	If dcont>350 Then
		If win(CurrentPlayer)>defencestate(CurrentPlayer) Then win(CurrentPlayer)=defencestate(CurrentPlayer)
		dcont=0:dvel=0:defencedown.enabled=0:resetcomplete=1:exit sub
	End If
End Sub

Sub defenceup_timer()
If gkmm=0 Then
	If liftD.rotx<90 Then liftD.rotx=liftD.rotx+1
	If sup3.z<-80 Then sup3.z=sup3.z+0.4
	If sup4.z<-80 Then sup4.z=sup4.z+0.4
	uvel=uvel-0.02
	Lshoot.state=0
	headDEF1.z=headDEF1.z-uvel:bodyDEF1.z=bodyDEF1.z-uvel:bootsDEF1.z=bootsDEF1.z-uvel:kitDEF1.z=kitDEF1.z-uvel:defpost.z=defpost.z-uvel:LdefL.Height=headDEF1.Z+100
	headDEF2.z=headDEF2.z-uvel:bodyDEF2.z=bodyDEF2.z-uvel:bootsDEF2.z=bootsDEF2.z-uvel:kitDEF2.z=kitDEF2.z-uvel:LdefC.Height=headDEF2.Z+100
	headDEF3.z=headDEF3.z-uvel:bodyDEF3.z=bodyDEF1.z-uvel:bootsDEF3.z=bootsDEF3.z-uvel:kitDEF3.z=kitDEF3.z-uvel:LdefR.Height=headDEF3.Z+100
	If headDEF1.z>-50 Then defenderL.isdropped=0:defenderC.isdropped=0:defenderR.isdropped=0:Wall35.ISDROPPED=0
	If headDEF1.z>12 Then
		defenceup.enabled=0:StopSound "fx_motorD":defencestate(CurrentPlayer)=defencestate(CurrentPlayer)+1:win(CurrentPlayer)=0:UpdateMatchLevelLights 0:DOF 128,DOFOff
		uvel=0:ResetGKTimer.enabled=0:CheckOpponent.Interval=1500:CheckOpponent.Enabled=1:exit sub
	End If
Else
	If liftD.rotx<90 Then liftD.rotx=liftD.rotx+1
	If sup3.z<-80 Then sup3.z=sup3.z+0.4
	If sup4.z<-80 Then sup4.z=sup4.z+0.4
	uvel=uvel-0.02
	Lshoot.state=0
	headDEF1.z=headDEF1.z-uvel:bodyDEF1.z=bodyDEF1.z-uvel:bootsDEF1.z=bootsDEF1.z-uvel:kitDEF1.z=kitDEF1.z-uvel:defpost.z=defpost.z-uvel:LdefL.Height=headDEF1.Z+100
	headDEF2.z=headDEF2.z-uvel:bodyDEF2.z=bodyDEF2.z-uvel:bootsDEF2.z=bootsDEF2.z-uvel:kitDEF2.z=kitDEF2.z-uvel:LdefC.Height=headDEF2.Z+100
	headDEF3.z=headDEF3.z-uvel:bodyDEF3.z=bodyDEF1.z-uvel:bootsDEF3.z=bootsDEF3.z-uvel:kitDEF3.z=kitDEF3.z-uvel:LdefR.Height=headDEF3.Z+100
	If headDEF1.z>-50 Then defenderL.isdropped=0:defenderC.isdropped=0:defenderR.isdropped=0:Wall35.ISDROPPED=0
	If headDEF1.z>12 Then
		defenceup.enabled=0:StopSound "fx_motorD":DOF 128,DOFOff
		uvel=0:ResetGKTimer.enabled=0:GKMM=0:Music
		ballrelease.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:Ballrelease.kick 90,7:PlaySoundAt SoundFXDOF("fx_ballrel",121,DOFPulse,DOFContactors),Ballrelease:kicked=0
		exit sub
	End If
End If
End Sub

'*********************************************************************
'*****MISTER MULTIBALL************************************************
'*********************************************************************
Dim LockMScore,ticket,skill,njack,thcc:thcc=0
Sub triggerlock_hit()
Me.DestroyBall
If Tilted=0 Then
	If Llock3.state=1 AND bip=1 Then PlaySound "V.MISTERMISLIT":PlaySound "PIZZ":UDMD_Display "multiball.gif", "MULTIBALL", 14, 2, "IS LIT", 14,2, UltraDMD_Animation_ScrollOnUp, 3000, UltraDMD_Animation_FadeOut,6 
	If Llock2.state=1 AND LLOCK3.state=2 AND GKMM=0 AND Lmultilock.state=0 AND Lmultiticket.state=0 AND lmultiskill.state=0 AND lockjackpot.state=0 AND headLD.z<0 AND headRD.z<0 AND TrapDoorP.Z=0 Then
		subwall.image = "sub_textSUB3":PlaySound "V.MISTERMISLIT":PlaySound "PIZZ":llock3.state=1
		lmultilock.state=2:lmultiskill.state=2:lmultiticket.state=2:superjackpot.state=2:LockMultiMode=1:If DiverterP.Z>50 Then TicketDiverter False
		UDMD_Display "multiball.gif", "MULTIBALL", 14, 2, "IS LIT", 14,2, UltraDMD_Animation_ScrollOnUp, 3000, UltraDMD_Animation_FadeOut,6
	End If
	If Llock1.state=1 AND Llock2.state=2 AND Llock3.state=2 AND bip=1 Then
		subwall.image = "sub_textSUB2":PlaySound "V.SECONDCHANGE":PlaySound "PIZZ":llock2.state=1
		UDMD_Display "substitution2.gif", "", 14, 2, "", 14, 2, UltraDMD_Animation_ScrollOnUp, 2200, UltraDMD_Animation_FadeOut,6
	End If
	If Llock.state=1 AND Llock1.state=2 AND Llock2.state=2 AND Llock3.state=2 AND bip=1 Then
		subwall.image = "sub_textSUB1":PlaySound "V.FIRSTCHANGE":PlaySound "PIZZ":llock1.state=1
		UDMD_Display "substitution1.gif", "", 14, 2, "", 14, 2, UltraDMD_Animation_ScrollOnUp, 2500, UltraDMD_Animation_FadeOut,6
	End If
	If Lmultilock.state=1 AND lockjackpot.state=2 Then
		scores(CurrentPlayer)=scores(CurrentPlayer)+500000:PlaySound "jackpotgingle":PlaySound "V.jackpot":lockjackpot.state=1:multilockCheck:LockMScore=LockMScore+500000
		UDMD_Display "jackpot.gif", "JackPot", 15, 2, "500.000", 0, 15, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
		Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
	End If
	If Llock3.state=2 AND BIP=1 AND TrapDoorP.Z=0 Then TrapHole.TimerInterval=100:TrapHole.TimerEnabled=1
    If (Llock3.state=2 AND BIP>1) OR Llock3.state=1 or TrapDoorP.Z>0 Then KGoalExit
	DOF 151, DOFPulse:MisterToyMove 3,100
End If
End Sub

Sub TrapHole_timer
	thcc=thcc+1
	If thcc=15 Then trapkickerLock.Enabled=1:trapkickerLock.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall					'after 1.5 second(s) create the ball																	
	If thcc=20 Then	tdfcolor=4:TDExit=2:OpenTrapDoor True:traphole.Enabled=0														'after 2.0 second(s) open the Snack Bar																		
	If thcc=21 Then trapkickerLock.Kick 180,25,1.56:TrapKickBall																	'after 2.1 second(s) kick the ball
	If thcc=22 Then OpenTrapDoor False																								'after 2.2 second(s) close the Snack Bar
	If thcc=23 Then
		Me.TimerEnabled=0:thcc=0:trapkickerLock.Enabled=0:TDExit=0																	'after 2.3 second(s) stop the timer
	End If
End Sub

Sub triggerjackpotlock1_hit
'used when ball exits the right ramp and jackpot is lit during Mister Multiball
triggerjackpotlock1P.RotX=-25
If Lmultilock.state=1 AND ticketjackpot.state=2 Then
	scores(CurrentPlayer)=scores(CurrentPlayer)+500000:TicketDiverter True:PlaySound "jackpotgingle":PlaySound "V.jackpot":ticketjackpot.state=1:multilockCheck:LockMScore=LockMScore+500000
	UDMD_Display "jackpot.gif", "JackPot", 15, 2, "500.000", 0, 15, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
	Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
End If
End Sub

Sub triggerjackpotlock1_unhit:triggerjackpotlock1P.RotX=0:End Sub

'*********************************************************************
'*****TICKET MULTIBALL************************************************
'*********************************************************************
Sub triggerTicket_hit
triggerTicketP.RotX=-25
If Tilted=0 Then
	If ticket2.state=1 AND ticket3.state=2 AND GKMM=0 AND lmultilock.state=0 AND Lmultiticket.state=0 AND lmultiskill.state=0 AND ticketjackpot.state=0 AND headLD.z<0 AND headRD.z<0 AND TrapDoorP.Z=0 Then
		lmultilock.state=2:lmultiskill.state=2:lmultiticket.state=2:superjackpot.state=2:TicketMultiMode=1:If DiverterP.Z>50 Then TicketDiverter False
		PlaySound "V.TICKETMISLIT":PlaySound "PIZZ":ticket3.state=1
		UDMD_Display "multiball.gif", "MULTIBALL", 14, 2, " IS LIT", 14, 2, UltraDMD_Animation_ScrollOnUp, 3000, UltraDMD_Animation_FadeOut,6
	End If
	If ticket1.state=1 AND ticket2.state=2 AND ticket3.state=2 AND bip=1 Then
		PlaySound "V.CHECKINGTICKET":PlaySound "PIZZ":ticket2.state=1
		UDMD_Display "ticket-check.gif", "", 0, 14, "", 0, 14, UltraDMD_Animation_ScrollOnLeft, 1000, UltraDMD_Animation_ScrollOffLeft,6
	End If
	If ticket1.state=2 AND bip=1 Then
		PlaySound "V.TICKETPLEASE":PlaySound "PIZZ":ticket1.state=1
		UDMD_Display "ticket-please.gif", "", 0, 14, "", 0, 14, UltraDMD_Animation_ScrollOnLeft, 1000, UltraDMD_Animation_ScrollOffLeft,6
	End If
	If MVPOfTheYear(CurrentPlayer)=1 Then
		PlaySound "V.TRYAGAIN":If UltraDMD.IsRendering Then UltraDMD.CancelRendering
		UDMD_Display "MVP.gif", "NEXT TIME",15,2,"PLEASE",15,2,UltraDMD_Animation_None,1500,UltraDMD_Animation_FadeOut,6
	End If
	If Lmultiticket.state=1 Then
		If ticketjackpot.state=2 AND ticket>1 Then
			scores(CurrentPlayer)=scores(CurrentPlayer)+500000:ticket=ticket+1:PlaySound "jackpotgingle":PlaySound "V.jackpot"
			superjackpot.state=2:ticketjackpot.state=1:TicketDiverter False
			UDMD_Display "jackpot.gif", "JackPot", 15, 2, "500.000", 0, 15, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
			Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
		End If
		If ticketjackpot.state=2 AND ticket=1 Then
			scores(CurrentPlayer)=scores(CurrentPlayer)+300000:ticket=ticket+1:PlaySound "jackpotgingle":PlaySound "V.jackpot"
			UDMD_Display "jackpot.gif", "JackPot", 15, 2, "300.000", 0, 15, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
			Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
		End If
		If ticketjackpot.state=2 AND ticket=0 Then
			scores(CurrentPlayer)=scores(CurrentPlayer)+200000:ticket=ticket+1:PlaySound "jackpotgingle":PlaySound "V.jackpot"
			UDMD_Display "jackpot.gif", "JackPot", 15, 2, "200.000", 0, 15, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
			Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
		End If
	End If
End If
End Sub

Sub triggerTicket_unhit:triggerTicketP.RotX=0:End Sub

'*********************************************************************
'*****SKILL MULTIBALL*************************************************
'*********************************************************************
Sub triggerskill_hit
PlaySoundAt "fx_sensor",ActiveBall
If Tilted=0 Then
	If skill3.state=1 AND bip=1 Then PlaySound "V.SKILLMISLIT":PlaySound "PIZZ":UDMD_Display "multiball.gif", "MULTIBALL", 14, 2, "IS LIT", 14, 2, UltraDMD_Animation_ScrollOnUp, 3000, UltraDMD_Animation_FadeOut,6
	If skill2.state=1 AND skill3.state=2 AND GKMM=0 AND lmultilock.state=0 AND Lmultiticket.state=0 AND lmultiskill.state=0 AND skilljackpot.state=0 AND headLD.z<0 AND headRD.z<0 AND TrapDoorP.Z=0 Then
		PlaySound "V.SKILLMISLIT":PlaySound "PIZZ":skill3.state=1
		lmultilock.state=2:lmultiskill.state=2:lmultiticket.state=2:superjackpot.state=2:SkillMultiMode=1:If DiverterP.Z>50 Then TicketDiverter False
		UDMD_Display "multiball.gif", "MULTIBALL", 14, 2, "IS LIT", 14, 2, UltraDMD_Animation_ScrollOnUp, 3000, UltraDMD_Animation_FadeOut,6
	End If
	If skill1.state=1 AND SKILL2.STATE=2 AND SKILL3.STATE=2 AND bip=1 Then
		PlaySound "V.AMAZINGSKILL":PlaySound "PIZZ":skill2.state=1
		UDMD_Display "skill2.gif", "", 0, 14, "", 2, 12, UltraDMD_Animation_ScrollOnLeft, 2200, UltraDMD_Animation_ScrollOffLeft,6
	End If
	If skill1.state=2 AND bip=1 Then
		PlaySound "V.SKILL":PlaySound "PIZZ":skill1.state=1
		UDMD_Display "skill1.gif", "", 0, 14, "", 2, 12, UltraDMD_Animation_ScrollOnLeft, 2200, UltraDMD_Animation_ScrollOffLeft,6
	End If
	If MVPOfTheYear(CurrentPlayer)=1 Then
		PlaySound "V.TRYAGAIN":If UltraDMD.IsRendering Then UltraDMD.CancelRendering
		UDMD_Display "MVP.gif", "NEXT TIME",15,2,"PLEASE",15,2,UltraDMD_Animation_None,1500,UltraDMD_Animation_FadeOut,6
	End If
	If Lmultilock.state=1 AND skilljackpot.state=2 Then
		scores(CurrentPlayer)=scores(CurrentPlayer)+500000:PlaySound "jackpotgingle":PlaySound "V.jackpot":skilljackpot.state=1:multilockCheck:LockMScore=LockMScore+500000
		UDMD_Display "jackpot.gif", "JackPot", 15, 2, "500.000", 0, 15, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
		Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
	End If
	If Lmultiskill.state=1 Then
		If skilljackpot.state=2 AND BIP>1 AND skill>1 Then
			scores(CurrentPlayer)=scores(CurrentPlayer)+500000:skill=skill+1:PlaySound "jackpotgingle":PlaySound "V.jackpot"
			superjackpot.state=2:SKILLjackpot.state=1:TicketDiverter False
			UDMD_Display "jackpot.gif", "JackPot", 15, 2, "500.000", 0, 15, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
			Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
		End If
		If skilljackpot.state=2 AND BIP>1 AND skill=1 Then
			scores(CurrentPlayer)=scores(CurrentPlayer)+300000:skill=skill+1:PlaySound "jackpotgingle":PlaySound "V.jackpot"
			UDMD_Display "jackpot.gif", "JackPot", 15, 2, "300.000", 0, 15, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
			Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
		End If
		If skilljackpot.state=2 AND BIP>1 AND skill=0 Then
			scores(CurrentPlayer)=scores(CurrentPlayer)+200000:skill=skill+1:PlaySound "jackpotgingle":PlaySound "V.jackpot"
			UDMD_Display "jackpot.gif", "JackPot", 15, 2, "200.000", 0, 15, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
			Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
		End If
	End If
End If
End Sub

'*********************************************************************
'***** MULTIBALL MODES - TRIGGER EVENTS ******************************
'*********************************************************************
Dim HoleType
'no multiball						---->HoleType=0		--->KGoalExit
'multiball starts					---->HoleType=1		--->add a ball in the plunger lane and kick it
'multiball running (no SJ)			---->HoleType=2		--->KGoalExit
'mister multi running (with SJ)		---->HoleType=3		--->KGoalExit

Sub triggermultiball_timer
	If (HoleType=1 or HoleType=3) And NOT UltraDMD.IsRendering Then
		Me.TimerEnabled=0
		'Multiball starts: add a new ball in the plunger lane and kick it out
		If HoleType=1 Then
			BallRelease.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:BallRelease.Kick 90, 7:PlaySoundAt SoundFXDOF("fx_ballrel",121,DOFPulse,DOFContactors),Ballrelease
			If Lx1.state=1 AND Lx2.state=1 Then Lx1.state=0:Lx2.state=0
			kicked=0:lkag.state=0:kickagain=1:Music
			'after 1 second fire the autoplunger
			Plunger.TimerInterval=1000
			Plunger.TimerEnabled=1
		End If
		'Mister Multiball is running with superjackpot: this will eject the ball from the kickergoal
		If HoleType=3 and MVPOfTheYear(CurrentPlayer)=0 Then KGoalExit
	End If

		'No Multiball or Multiball is running without superjackpot: this will eject the ball from the kickergoal
		If HoleType=0 or HoleType=2 Then Me.TimerEnabled=0:KGoalExit
End Sub

Sub triggermultiBall_hit()
	Me.destroyball
'used when ball enters the right hole (multiball hole) and Multiball Lights are on: this will eject the ball from the kickergoal
    If (LockMultiMode=2 or TicketMultiMode=2 or SkillMultiMode=2) AND superjackpot.state=0 Then
		scores(CurrentPlayer)=scores(CurrentPlayer)+10000:OnScoreboardChanged:HoleType=2
		Me.TimerInterval=2000:Me.TimerEnabled=1
	End If

'used when ball enters the right hole (multiball hole) and Multiball Lights are blinking: this will start Multiball Animation Sequence
    If (LockMultiMode=1 or TicketMultiMode=1 or SkillMultiMode=1) Then
		LightEffect 2:GiEffect 2:PlaySound "thunder"
		UDMD_Display "mvp-multiball.gif","",0,0,"",0,0,UltraDMD_Animation_None,4000,UltraDMD_Animation_FadeOut,10
		MBMode=1:SJDelay.Interval=2500:SJDelay.Enabled=1:DOF 151, DOFPulse:HoleType=1
		Me.TimerInterval=100:Me.TimerEnabled=1

		'Mister Multiball is blinking: this will start Mister Multiball
		If LockMultiMode=1 Then
			LockMScore=0
			lmultilock.state=1:lmultiticket.state=0:lmultiskill.state=0:superjackpot.state=0
			LockMultiMode=2
		End If

		'Ticket Multiball is blinking: this will start Ticket Multiball
		If TicketMultiMode=1 Then
			lmultilock.state=0:lmultiticket.state=1:lmultiskill.state=0:superjackpot.state=0
			TicketMultiMode=2
		End If

		'Skill Multiball is blinking: this will start Skill Multiball
		If SkillMultiMode=1 Then
			lmultilock.state=0:lmultiticket.state=0:lmultiskill.state=1:superjackpot.state=0
			SkillMultiMode=2
		End If
	End If

'used when ball enters the right hole (multiball hole) and Multiball Lights are off: this will eject the ball from the kickergoal
	If LockMultiMode=0 AND TicketMultiMode=0 AND SkillMultiMode=0 Then
		scores(CurrentPlayer)=scores(CurrentPlayer)+10000:OnScoreboardChanged:HoleType=0
		Me.TimerInterval=2000:Me.TimerEnabled=1
	End If

'***** MISTER MULTIBALL SUPER JACKPOT *************************

'used when ball enters the right hole (multiball hole) and Superjackpot is lit:this will Award SuperJackpot
	If BIP>1 AND lmultilock.state=1 AND superjackpot.state=2 AND finaljackpot.state=0 Then
		If lockcomplete.state=0 Then lockcomplete.state=1:completed(CurrentPlayer)=completed(CurrentPlayer)+1
		If njack=0 Then scores(CurrentPlayer)=scores(CurrentPlayer)+5000000:UDMD_Display "jackpot.gif", "Super JACKPOT", 15, 2, "5.000.000", 15, 2, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6:LockMScore=LockMScore+1000000
		If njack=1 Then scores(CurrentPlayer)=scores(CurrentPlayer)+8000000:UDMD_Display "jackpot.gif", "Super JACKPOT", 15, 2, "8.000.000", 15, 2, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6:LockMScore=LockMScore+2000000
		If njack>1 Then scores(CurrentPlayer)=scores(CurrentPlayer)+12000000:UDMD_Display "jackpot.gif", "Super JACKPOT", 15, 2, "12.000.000", 15, 2, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6:LockMScore=LockMScore+5000000
		PlaySound "jackpotgingle":PlaySound "V.jackpot":HoleType=3:Me.TimerInterval=100:Me.TimerEnabled=1
		superjackpot.state=0:lockjackpot.state=2:ticketjackpot.state=2:skilljackpot.state=2
		llock.state=1:Llock1.state=1:Llock2.state=1:Llock3.state=1
		njack=njack+1
		FinalJackpotCheck 2
		If MVPOfTheYear(CurrentPlayer)=1 Then BIP=BIP-1:StopMusic:njack=0
		Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
	End If
	If BIP=1 AND lmultilock.state=1 AND superjackpot.state=2 AND finaljackpot.state=0 Then
		If lockcomplete.state=0 Then lockcomplete.state=1:completed(CurrentPlayer)=completed(CurrentPlayer)+1
		scores(CurrentPlayer)=scores(CurrentPlayer)+5000000
		UDMD_Display "jackpot.gif", "Super JACKPOT", 15, 2, "5.000.000", 15, 2, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6:LockMScore=LockMScore+1000000
		PlaySound "jackpotgingle":PlaySound "V.jackpot"
		superjackpot.state=0:lockjackpot.state=0:ticketjackpot.state=0:skilljackpot.state=0
		lmultilock.state=0:LockMultiMode=0:HoleType=3:Me.TimerInterval=100:Me.TimerEnabled=1
		llock.state=2:Llock1.state=2:Llock2.state=2:Llock3.state=2
		TabletDown:TicketDiverter True:njack=0
		FinalJackpotCheck 2
		If MVPOfTheYear(CurrentPlayer)=1 Then BIP=BIP-1:StopMusic
		If MVPOfTheYear(CurrentPlayer)=0 Then Music
		Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
	End If

'***** TICKET MULTIBALL SUPER JACKPOT *************************

'used when ball enters the right hole (multiball hole) and Superjackpot is lit:this will Award SuperJackpot and ends multiball
    If Lmultiticket.state=1 AND superjackpot.state=2 AND finaljackpot.state=0 Then
		BIP=BIP-1
		If ticketcomplete.state=0 Then ticketcomplete.state=1:completed(CurrentPlayer)=completed(CurrentPlayer)+1
		superjackpot.state=0
		scores(CurrentPlayer)=scores(CurrentPlayer)+5000000:PlaySound "jackpotgingle":PlaySound "V.jackpot"
		UDMD_Display "jackpot.gif", "Super JACKPOT", 15, 2, "5.000.000", 15, 2, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
		ticketjackpot.state=0:ticket1.state=2:ticket2.state=2:ticket3.state=2
		Lmultiticket.state=0
		TicketMultiMode=0
		TicketDiverter True:ticket=0
		FinalJackpotCheck 5
		If MVPOfTheYear(CurrentPlayer)=1 Then StopMusic:ticket=0
		If MVPOfTheYear(CurrentPlayer)=0 Then Music
		Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
    End If

'***** SKILL MULTIBALL SUPER JACKPOT *************************

'used when ball enters the right hole (multiball hole) and Superjackpot is lit:this will Award SuperJackpot and ends multiball
	If Lmultiskill.state=1 AND superjackpot.state=2 AND finaljackpot.state=0 Then
		BIP=BIP-1
		If skillcomplete.state=0 Then skillcomplete.state=1:completed(CurrentPlayer)=completed(CurrentPlayer)+1
		superjackpot.state=0
		scores(CurrentPlayer)=scores(CurrentPlayer)+5000000:PlaySound "jackpotgingle":PlaySound "V.jackpot"
		UDMD_Display "jackpot.gif", "Super JACKPOT", 15, 2, "5.000.000", 15, 2, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
		skilljackpot.state=0:skill1.state=2:skill2.state=2:skill3.state=2
		lmultiskill.state=0
		SkillMultiMode=0
		TicketDiverter True:skill=0
		FinalJackpotCheck 1
		If MVPOfTheYear(CurrentPlayer)=1 Then StopMusic:skill=0
		If MVPOfTheYear(CurrentPlayer)=0 Then Music
		Lighteffect 4:GIEffect 0:FlasherEffect 6:MisterToyMove 4,100
	End If

'***** MVP SUPER JACKPOT *************************

'used when ball enters the right hole (multiball hole) and MVP Award is lit:this will award 50 millions!
	If finaljackpot.state=2 Then
		finaljackpot.state=1
		DOF 146, DOFPulse
		PlayMusic MusicList(18),optMusicVolume
		scores(CurrentPlayer)=scores(CurrentPlayer)+50000000:PlaySound "jackpotgingle":PlaySound "V.MVPmade"
		MVPwin.Enabled=1:BIP=BIP-1
		FinalMode.Interval=100:FinalMode.Enabled=1	'wait the MVPList video is complete
		DisableTable 1:Tilted=1:MVPGI.Enabled=0:mvpgicc=0
		LightEffect 1:FlasherEffect 12:B2SEffect Array(B2SLight1,B2SLight2,B2SLight3),12,100
		LightSeqMVP.UpdateInterval = 4
		LightSeqMVP.Play SeqCircleOutOn, 5, 6
		ticket1.state=0:ticket2.state=0:ticket3.state=0:ticketjackpot.state=0
		superjackpot.state=0:LmultiLock.state=0:Lmultiticket.state=0:Lmultiskill.state=0
		UltraDMD.CancelRendering
		UltraDMD.DisplayScene00Ex "MVP.gif", "AMAZING!!", 15, 2, "BALLON DOR", 15, 2, UltraDMD_Animation_None, 2500, UltraDMD_Animation_FadeOut
		UltraDMD.DisplayScene00Ex "MVPList.wmv", "", 15, 0, "", 15, 0, UltraDMD_Animation_None, 139000, UltraDMD_Animation_FadeOut
		dim CrStr:Crstr="ALL RIGHTS BELONG TO|UEFA| | | |IT WAS A LONG EFFORT| | |FOR BOTH YOU| | |AND US CREATORS| | | |WE ENJOYED DURING| |THE DEVELOPING PHASE| | | |WE HOPE THAT| |YOU ENJOYED TOO..| | | |AUTHORS| | | |NINUZZU| | |TOM TOWER| | | | |THANKS TO THE| |VISUAL PINBALL| |DEV TEAM FOR| |THE AMAZING VPX"
		UltraDMD.ScrollingCredits "credits.png", Crstr, 15, UltraDMD_Animation_ScrollOnUp, 100, UltraDMD_Animation_FadeOut	
	End If
End Sub

'*********************************************************************
'***** MULTIBALL MODES - ADD BALLS ***********************************
'*********************************************************************
Sub MultiBallStart_hit()
If Tilted=0 Then
	CornerModeOn
	Dokickagain
	If TicketMultiMode=1 AND DiverterP.Z>50 Then TicketDiverter False
'used after the ball is plunged and Mister Multiball is running: this will add a ball and make the jackpots blinking
    If lmultilock.state=1 AND BIP=1 Then
		subwall.image="sub_textSUBmult"
		KGoalExit:BIP=BIP+1
		lockjackpot.state=2:ticketjackpot.state=2:skilljackpot.state=2
		'this will add the 3rd ball after 3 seconds
		MultiBallStart.timerinterval=3000
		MultiBallStart.timerenabled=1
    End If
'used after the ball is plunged and and Ticket Multiball is running: this will add a ball
	If Lmultiticket.state=1 AND BIP=1 Then 
		BIP=BIP+1
		KGoalExit
		TicketDiverter True
		ticketjackpot.state=2
	End If
'used after the ball is plunged and Skill Multiball is running: this will add a ball
	If Lmultiskill.state=1 AND BIP=1 Then
		BIP=BIP+1 
		KGoalExit
		TicketDiverter True
		skilljackpot.state=2
	End If
End If
End Sub

Sub MultiBallStart_timer()
	MultiBallStart.timerenabled=0
	KGoalExit:BIP=BIP+1
End Sub

'*********************************************************************
'*****SUPER JACKPOT FOR THE 3 MULTIBALL MODES*************************
'*********************************************************************
Dim FinalJackpotAward

Sub FinalJackpotCheck(n)
	If lockcomplete.state=1 AND skillcomplete.state=1 AND ticketcomplete.state=1 AND championcomplete.state=1 AND fkcomplete.state=1 Then
		MVPOfTheYear(CurrentPlayer)=1:FinalMode.Interval=100:FinalMode.Enabled=1:FinalJackpotAward=n
	End If
End Sub

Sub multilockCheck
	triggerlock.timerinterval=200
	triggerlock.timerenabled=1
End Sub

Sub triggerlock_timer
	me.timerenabled=0
	If lockjackpot.state=1 AND ticketjackpot.state=1 AND skilljackpot.state=1 Then superjackpot.state=2:TicketDiverter False
End Sub

'*********************************************************************
'*****CHAMPIONS LEAGUE WIN AND MVP MODE ******************************
'*********************************************************************
Sub WinTheCLFinal
	Lshoot.state=0:ResetGKTimer.Enabled=0:StopFlash lClWin,1:UpdateB2SLogos:For each ii in VMFlashers:StopFlash ii,0:Next
	If championcomplete.state=0 Then championcomplete.state=1:completed(CurrentPlayer)=completed(CurrentPlayer)+1
	screenprim.visible=1:screenprim.image="logoCL"
	For Each ii in TeamLogos:StopFlash ii,0:Next:SCFrame.imageA="LCD_INTROTXT_0":SCFrame.opacity=50:SCFrame.visible=1
	PlayMusic MusicList(19),optMusicVolume
	cupbase.image="cuplighton":CLwin.enabled=1:cuplights.visible=1
	CLWinWait.Interval=55000		'55 seconds to wait the CLwin video is complete
	CLWinWait.enabled=1
	DisableTable 1:Tilted=1
	If UltraDMD.IsRendering Then UltraDMD.CancelRendering
	UltraDMD.DisplayScene00Ex "CLWin.wmv", "", 15, 0, "", 15, 0, UltraDMD_Animation_FadeIn, 54500, UltraDMD_Animation_FadeOut
	LightSeqCLWin.Play SeqBlinking, , 6, 100
	LightSeqCLWin.Play SeqWiperRightOn,10
	LightSeqCLWin.Play SeqWiperLeftOn,10
	LightSeqCLWin.Play SeqCircleInOn, 15, 2
	LightSeqCLWin.Play SeqCircleOutOn, 15, 2
End Sub

Sub CLwinWait_timer()
	Me.Enabled=0
	StopMusic:cupbase.image="cuplightoff":CLWin.Enabled=0:cuplights.visible=0:fcount=0:SCFrame.visible=0
	defencestate(CurrentPlayer)=0:win(CurrentPlayer)=0:progress(CurrentPlayer)=0:CLChamp(CurrentPlayer)=CLChamp(CurrentPlayer)+1
	LqualifyG.state=0:LgroupG.state=0:LfirstG.state=0:LquarterG.state=0:LsemiG.state=0:LfinalG.state=0
	Lwinfinal.state=0:Lwinsemi.state=0:Lwinquarter.state=0:Lwinfirst.state=0:Lwingroup.state=0:Lwinqualify.state=0:StopFlash lClWin,0:UpdateB2SLogos
	MVPEffectType=1:MVPEffect.Enabled=1
	UltraDMD.CancelRendering
	UltraDMD.DisplayScene00Ex "black.bmp", "CONGRATULATIONS!", 14,-1,"",14,-1,UltraDMD_Animation_FadeIn,1000,UltraDMD_Animation_FadeOut
	UltraDMD.DisplayScene00Ex "black.bmp", "YOU WON..", 14,-1,"THE FINAL!!",14,-1,UltraDMD_Animation_FadeIn,1500,UltraDMD_Animation_FadeOut
	UltraDMD.DisplayScene00Ex "black.bmp", "AWARDED", 14,-1,"20 MILLIONS!",14,-1,UltraDMD_Animation_None,2500,UltraDMD_Animation_ScrollOffDown
	If lockcomplete.state=1 AND skillcomplete.state=1 AND ticketcomplete.state=1 AND championcomplete.state=1 AND fkcomplete.state=1 Then MVPOfTheYear(CurrentPlayer)=1:FinalJackpotAward=3
	FinalMode.Interval=100:FinalMode.Enabled=1
End Sub

Sub CLwin_timer()
    cup.rotz=cup.rotz+0.2
    cuplights.rotz=cuplights.rotz+0.1
    cupbase.rotz=cupbase.rotz+0.1
	fcount=fcount+1
	If fcount=100 Then
		FlashForMs Fl2,100,100,0
		FlashForMs Fl2a,200,100,0
		FlashForMs dome2,200,100,0
		DOF 140, DOFPulse		
	End If
	If fcount=150 Then
		FlashForMs Fl3,100,100,0
		FlashForMs Fl3a,200,100,0
		FlashForMs dome3,200,100,0
		DOF 141, DOFPulse
	End If
	If fcount=200 Then
		FlashForMs Fl1,100,100,0
		FlashForMs Fl1a,200,100,0
		FlashForMs dome1,200,100,0
		DOF 142, DOFPulse
	End If
	If fcount = 400 Then fcount=0 
End Sub

Dim fcount
Sub MVPwin_timer()
	fcount=fcount+1
	If fcount=30 Then
		FlashForMs Fl2,100,50,0
		FlashForMs Fl2a,100,50,0
		FlashForMs dome2,100,50,0
		DOF 140, DOFPulse
	End If
	If fcount=45 Then
		FlashForMs Fl3,100,50,0
		FlashForMs Fl3a,100,50,0
		FlashForMs dome3,100,50,0
		DOF 141, DOFPulse
	End If
	If fcount=60 Then
		FlashForMs Fl1,100,50,0
		FlashForMs Fl1a,100,50,0
		FlashForMs dome1,100,50,0
		DOF 142, DOFPulse
	End If
	If fcount = 70 Then fcount=10 
End Sub

Sub LightSeqCLWin_PlayDone()
'when finishes the queue it restarts the sequence again
	LightSeqCLWin.Play SeqWiperRightOn,10
	LightSeqCLWin.Play SeqWiperLeftOn,10
	LightSeqCLWin.Play SeqUpOn, 30, 1
	LightSeqCLWin.Play SeqDownOn, 30, 1
	LightSeqCLWin.Play SeqRightOn, 25, 1
	LightSeqCLWin.Play SeqLeftOn, 25, 1
End Sub

Sub LightSeqMVP_PlayDone()
'when finishes the queue it restarts the sequence again
    LightSeqMVP.UpdateInterval = 4
    LightSeqMVP.Play SeqCircleOutOn, 5, 6
End Sub

Sub FinalMode_timer
	If NOT UltraDMD.IsRendering Then
		Me.Enabled=0
		'after you win the CL and MVP Mode is disabled
		If MVPOfTheYear(CurrentPlayer)=0 Then
			LightSeqCLWin.StopPlay
			DisableTable 0:Tilted=0
			Schedule.enabled=1					'reset the groups and create a new schedule
			BallRelease.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:BallRelease.Kick 90, 7:PlaySoundAt SoundFXDOF("fx_ballrel",121,DOFPulse,DOFContactors),Ballrelease
			BIP=BIP+1:Music:DOF 152, DOFPulse:If Lx1.state=1 AND Lx2.state=1 Then Lx1.state=0:Lx2.state=0
		Else
			'after you win the CL or other modes:this will start MVP Mode (will also finish all MultiModes if they are running or lit!)
			If finaljackpot.state=0 Then
				MVPTimer.Interval=9000:MVPTimer.Enabled=1:MVPEffectType=2:MVPEffect.Enabled=1:SCReset.Enabled=1
				For Each ii in TeamLogos:StopFlash ii,0:Next
				If Tilted=0 Then DisableTable 1:Tilted=1
				UltraDMD.DisplayScene00Ex "black.bmp", "CONGRATULATIONS!", 14,-1,"",14,-1,UltraDMD_Animation_FadeIn,1000,UltraDMD_Animation_FadeOut
				UltraDMD.DisplayScene00Ex "black.bmp", "YOU COMPLETED", 14,-1,"ALL MODES",14,-1,UltraDMD_Animation_FadeIn,1500,UltraDMD_Animation_FadeOut
				UltraDMD.DisplayScene00Ex "black.bmp", "SHOOT THE", 14,-1,"Snack Bar",14,-1,UltraDMD_Animation_FadeIn,1500,UltraDMD_Animation_FadeOut
				UltraDMD.DisplayScene00Ex "black.bmp", "TO LIGHT THE", 14,-1,"BALLON DOR!!!",14,-1,UltraDMD_Animation_FadeIn,1500,UltraDMD_Animation_FadeOut
				'this will finish all the Multiball Modes and reset FK Mode
				StopFlash FKFL1,0:StopFlash FKFL2,0:StopFlash FKFL3,0:StopFlash FKFL4,0:StopFlash FKFL1,0:StopFlash FKFL5,0:FKGoal(CurrentPlayer)=0
				LockMultiMode=0:TicketMultiMode=0:SkillMultiMode=0:If subwall.Z>140 Then TabletDown:subwall.image = "sub_text"
				LmultiLock.state=0:Lmultiticket.state=0:Lmultiskill.state=0
				lockjackpot.state=0:skilljackpot.state=0:ticketjackpot.state=0:superjackpot.state=0:TicketDiverter True
				lockcomplete.state=2:skillcomplete.state=2:ticketcomplete.state=2:championcomplete.state=2:fkcomplete.state=2
				Llock.state=0:Llock1.state=0:Llock2.state=0:Llock3.state=0:skill1.state=0:skill2.state=0:skill3.state=0:ticket1.state=0:ticket2.state=0:ticket3.state=0
			Else
				'after you complete the MVP Mode and video is over
				UltraDMD.DisplayScene00Ex "black.bmp", "CONGRATULATIONS!", 14,-1,"",14,-1,UltraDMD_Animation_FadeIn,1000,UltraDMD_Animation_FadeOut
				UltraDMD.DisplayScene00Ex "black.bmp", "YOU WON THE", 14,-1,"BALLON DOR!!!",14,-1,UltraDMD_Animation_FadeIn,1500,UltraDMD_Animation_FadeOut
				UltraDMD.DisplayScene00Ex "black.bmp", "AWARDED", 14,-1,"50 MILLIONS!",14,-1,UltraDMD_Animation_None,2500,UltraDMD_Animation_ScrollOffDown
				lockcomplete.state=0:skillcomplete.state=0:ticketcomplete.state=0:championcomplete.state=0:fkcomplete.state=0:finaljackpot.state=0
				LightSeqMVP.StopPlay:MVPwin.Enabled=0:fcount=0:completed(currentplayer)=0
				TicketDiverter True:If TDState(CurrentPlayer)>0 Then TDState(CurrentPlayer)=0:StopMusic
				MVPWait.Interval=100:MVPWait.Enabled=1:MVPEffectType=1:MVPEffect.Enabled=1:SCReset.Enabled=1
				For Each ii in TeamLogos:StopFlash ii,0:Next:SCFrame.visible=0:SCFrame.X=429.215
				'reset multiball lights
				ticket1.BlinkPattern="000100":ticket2.BlinkPattern="000010":ticket3.BlinkPattern="000001"
				ticket1.BlinkInterval=100:ticket2.BlinkInterval=100:ticket3.BlinkInterval=100:ticketjackpot.BlinkInterval=100
				Llock.state=2:Llock1.state=2:Llock2.state=2:Llock3.state=2:skill1.state=2:skill2.state=2:skill3.state=2:ticket1.state=2:ticket2.state=2:ticket3.state=2
				superjackpot.BlinkPattern="1000":LmultiLock.BlinkPattern="0001":Lmultiticket.BlinkPattern="0100":Lmultiskill.BlinkPattern="0010"
				superjackpot.BlinkInterval=100:LmultiLock.BlinkInterval=100:Lmultiticket.BlinkInterval=100:Lmultiskill.BlinkInterval=100
			End If
		End If
	End If
End Sub

Sub MVPTimer_timer
	Me.Enabled=0
	If BIP=0 Then
		DisableTable 0:Tilted=0
		Select Case FinalJackpotAward
			Case 1	'after you complete the Skill Multiball
					FinalJackpotAward=0
			Case 2	'after you complete the Mister Multiball
					FinalJackpotAward=0
			Case 3	'after you complete the Champions League
					LightSeqCLWin.StopPlay
					schedule.enabled=1		'reset the groups and create a new schedule
			Case 4	'after you complete the Free Kick
					FinalJackpotAward=0
			Case 5	'after you complete the Ticket Multiball
					FinalJackpotAward=0
		End Select
		tdfcolor=5:TDExit=3:OpenTrapDoor True:GiEffect 4							'open the Snack Bar to start MVP
		If win(CurrentPlayer)=defencestate(CurrentPlayer) Then						'move defenders up if they are down
			moveback=3:MOVEGK.enabled=0:ResetGK:firstdefenceup.enabled=1:PlayLoopSoundAt SoundFXDOF("fx_motorD",128,DOFOn,DOFGear),defpost:Lshoot.state=0:ArrowEffect False
		End If
		BallRelease.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:BallRelease.Kick 90, 7:PlaySoundAt SoundFXDOF("fx_ballrel",121,DOFPulse,DOFContactors),Ballrelease:kicked=0:BIP=BIP+1:Music:DOF 152, DOFPulse
		If Lx1.state=1 AND Lx2.state=1 Then Lx1.state=0:Lx2.state=0
		SCFrame.X=399.215:SCFrame.imageA="LCD_ballondor":SCFrame.opacity=50:SCFrame.visible=1:Teamlogos(3).imageA="Logo_BallonDor":StopFlash Teamlogos(3),1
	Else
		MVPTimer.Interval=1000
		MVPTimer.Enabled=1
	End If
End Sub

Sub MVPWait_timer
If NOT UltraDMD.IsRendering Then
	Me.Enabled=0
	If moveback=3 Then moveback=0:CheckMatchLevel
	MVPOfTheYear(CurrentPlayer)=0:DisableTable 0:Tilted=0:Music:If Lx1.state=1 AND Lx2.state=1 Then Lx1.state=0:Lx2.state=0
	StopFlash Teamlogos(3),0:SCFrame.visible=0:SCFrame.X=429.215:UpdateTeamLogos:StopFlash Teamlogos(3),1
	ballrelease.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:ballrelease.Kick 90, 7:PlaySoundAt SoundFXDOF("fx_ballrel",121,DOFPulse,DOFContactors),Ballrelease:BIP=BIP+1
End If
End Sub

Dim MVPEffectcc,MVPEffectType
Sub MVPEffect_timer
	MVPEffectcc=MVPEffectcc+1
	Select Case MVPEffectType
		Case 1	'after cl win or mvp win
			If MVPEffectcc=1 Then FlasherEffect 12
			If MVPEffectcc=3 Then Playsound "0_highscore"
			If MVPEffectcc=4 Then Me.Enabled=0:MVPEffectcc=0
		Case 2	'at mvp start
			If MVPEffectcc=1 Then FlasherEffect 12
			If MVPEffectcc=3 Then Playsound "0_highscore"
			If MVPEffectcc=54 Then Playsound "explosion"
			If MVPEffectcc=76 Then Playsound "explosion"
			If MVPEffectcc=77 Then Me.Enabled=0:MVPEffectcc=0
		Case 3	'during mpv after you hit the snackbar
			If MVPEffectcc=5 Then
				Playsound "bell":DOF 146,DOFPulse
				finaljackpot.state=1:StopFlash finaljackpot,1:Flash finaljackpot,150
				superjackpot.state=1:StopFlash superjackpot,1:Flash superjackpot,150
				LmultiLock.state=1:StopFlash LmultiLock,1:Flash LmultiLock,150
				Lmultiticket.state=1:StopFlash Lmultiticket,1:Flash Lmultiticket,150
				Lmultiskill.state=1:StopFlash Lmultiskill,1:Flash Lmultiskill,150
			End If
			If MVPEffectcc=8 Then Playsound "bell":DOF 146,DOFPulse
			If MVPEffectcc=11 Then Playsound "bell":DOF 146,DOFPulse
			If MVPEffectcc=14 Then Playsound "bell":DOF 146,DOFPulse
			If MVPEffectcc=17 Then Playsound "bell":DOF 146,DOFPulse
			If MVPEffectcc=20 Then
				PlaySound "V.MVPISLIT":StopFlash finaljackpot,1:StopFlash superjackpot,1:StopFlash LmultiLock,1:StopFlash Lmultiticket,1:StopFlash Lmultiskill,1
				UltraDMD.CancelRendering:UDMD_Display "MVP.gif", "BALLON DOR",14,-1,"IS LIT!!!",14,-1,UltraDMD_Animation_None,2000,UltraDMD_Animation_FadeOut,10
			End If
			If MVPEffectcc=45 Then
				Me.Enabled=0:MVPEffectcc=0:TicketDiverter False:finaljackpot.state=2:KGoalExit
				ticket1.BlinkPattern="10":ticket2.BlinkPattern="10":ticket3.BlinkPattern="10"
				ticket1.BlinkInterval=200:ticket2.BlinkInterval=200:ticket3.BlinkInterval=200:ticketjackpot.BlinkInterval=200
				ticket1.state=2:ticket2.state=2:ticket3.state=2:ticketjackpot.state=2
				superjackpot.BlinkPattern="10":LmultiLock.BlinkPattern="10":Lmultiticket.BlinkPattern="10":Lmultiskill.BlinkPattern="10"
				superjackpot.BlinkInterval=500:LmultiLock.BlinkInterval=500:Lmultiticket.BlinkInterval=500:Lmultiskill.BlinkInterval=500
				superjackpot.state=2:LmultiLock.state=2:Lmultiticket.state=2:Lmultiskill.state=2
				If TDState(CurrentPlayer)>0 Then									'reopen the Snack Bar if it was already opened before
					OpenTD
					Select Case TDstate(CurrentPlayer)
						Case 1	'reopen for striker mode 1: eb
								ScoopLight.color=RGB(255,0,0):ScoopLight.colorfull=RGB(255,100,100):Flash TDFL1,180
						Case 2	'reopen for striker mode 2: GKMode
								ScoopLight.color=RGB(0,255,0):ScoopLight.colorfull=RGB(100,255,100):Flash TDFL2,180
						Case 3	'reopen for striker mode 3: Video Mode
								ScoopLight.color=RGB(255,128,0):ScoopLight.colorfull=RGB(255,128,60):Flash TDFL3,180
						Case 4	'reopen for semifinal award: eb
								ScoopLight.color=RGB(255,0,0):ScoopLight.colorfull=RGB(255,100,100):Flash TDFL1,180
						Case 5	'reopen for Break Spin Mode
								ScoopLight.color=RGB(255,200,150):ScoopLight.colorfull=RGB(255,230,200):Flash TDFL1,50:Flash TDFL2,100:Flash TDFL3,150
					End Select
					ScoopLight.state=2
				End If
			End If
	End Select
End Sub

'*********************************************************************
'****TRAP DOOR********************************************************
'*********************************************************************
Dim tdfcolor,TDExit:TDExit=0
Sub OpenTrapDoor(enabled)
	If Enabled Then
		If TDExit=3 Then	'open trap in MVP,if it's already opened (Strikers,semifinal,break spin)
			If TrapDoorP.Z>0 AND StrikerMode(CurrentPlayer)=1 AND FKAward(CurrentPlayer)=0 AND SemiFinalAward(CurrentPlayer)=0 AND BSMODE(CurrentPlayer)=0 AND GKMM=0 AND FK=0 Then TDState(CurrentPlayer)=1
			If TrapDoorP.Z>0 AND StrikerMode(CurrentPlayer)=2 AND FKAward(CurrentPlayer)=0 AND SemiFinalAward(CurrentPlayer)=0 AND BSMODE(CurrentPlayer)=0 AND GKMM=0 AND FK=0 Then TDState(CurrentPlayer)=2:StopFlash TDFL2,0
			If TrapDoorP.Z>0 AND StrikerMode(CurrentPlayer)=3 AND FKAward(CurrentPlayer)=0 AND SemiFinalAward(CurrentPlayer)=0 AND BSMODE(CurrentPlayer)=0 AND GKMM=0 AND FK=0 Then TDState(CurrentPlayer)=3:StopFlash TDFL3,0
			If TrapDoorP.Z>0 AND SemiFinalAward(CurrentPlayer)=1 Then TDState(CurrentPlayer)=4
			If TrapDoorP.Z>0 AND BSMODE(CurrentPlayer)=1 Then StopFlash TDFL1,0:StopFlash TDFL2,0:StopFlash TDFL3,0:TDState(CurrentPlayer)=5
			TDExit=0
		End If
		OpenTD
		Select Case tdfcolor
			Case 1		'RED-Strikers mode 1 and extraball
				ScoopLight.color=RGB(255,0,0):ScoopLight.colorfull=RGB(255,100,100)
				Flash TDFL1,180
			Case 2		'GREEN-Strikers mode 2
				ScoopLight.color=RGB(0,255,0):ScoopLight.colorfull=RGB(100,255,100)
				Flash TDFL2,180
			Case 3		'YELLOW-Strikers mode 3
				ScoopLight.color=RGB(255,128,0):ScoopLight.colorfull=RGB(255,128,60)
				Flash TDFL3,180
			Case 4		'LIGHT BLUE-ball exiting the trap
				ScoopLight.color=RGB(113,113,255):ScoopLight.colorfull=RGB(80,255,255)
			Case 5		'PINK-during MVP Mode
				ScoopLight.color=RGB(255,0,255):ScoopLight.colorfull=RGB(255,128,200)
			Case 6		'YELLOW-during Break Spin Mode
				ScoopLight.color=RGB(255,200,150):ScoopLight.colorfull=RGB(255,230,200)
				Flash TDFL1,50:Flash TDFL2,100:Flash TDFL3,150
		End Select
		ScoopLight.state=2
	Else
		TrapDoorP.z=0
		traphole.enabled=0:wall61.isdropped=1
		PlaySoundAt SoundFXDOF("fx_td-down",131,DOFPulse,DOFContactors),TrapDoorP
		lextraball.state=0:lgkmode.state=0:lvideomode.state=0
		ScoopLight.state=0
	End If
End Sub

Sub OpenTD
	TrapDoorP.z=100:wall61.isdropped=0:PlaySoundAt SoundFXDOF("fx_td-up",131,DOFPulse,DOFContactors),TrapDoorP
	if GKMM=0 AND TDExit=0 Then traphole.enabled=1
	lextraball.state=2:lgkmode.state=2:lvideomode.state=2
End Sub

Sub TRAPKICKER_HIT
	PlaySoundAt "fx_hole_enter",ActiveBall
	trapkicker.destroyball
	OpenTrapDoor False
	If Tilted=0 Then
		If MVPOfTheYear(CurrentPlayer)=0 OR (MVPOfTheYear(CurrentPlayer)=1 AND finaljackpot.state=2) Then
			If TDState(CurrentPlayer)>0 Then TDState(CurrentPlayer)=0
			If FKAward(CurrentPlayer)=1 Then StopFlash TDFL1,1:EbAward=3:AddExtraball:FKAward(CurrentPlayer)=0:Exit Sub
			If SemiFinalAward(CurrentPlayer)=1 Then StopFlash TDFL1,1:EbAward=4:AddExtraball:SemiFinalAward(CurrentPlayer)=0:Exit Sub
			If BSMODE(CurrentPlayer)=1 Then BREAKSPIN.ENABLED=1:BSMODE(CurrentPlayer)=0:Exit Sub
			If StrikerMode(CurrentPlayer)=3 AND FKAward(CurrentPlayer)=0 AND BSMODE(CurrentPlayer)=0 AND SemiFinalAward(CurrentPlayer)=0 Then
				StopFlash TDFL3,0
				trapkicker.TimerInterval=4000:trapkicker.TimerEnabled=1
				UltraDMD.CancelRendering:PlaySound "vmode":For each ii in TeamLogos:StopFlash ii,0:Next
				UltraDMD.DisplayScene00Ex "videomode.gif", "",14,-1,"",14,-1,UltraDMD_Animation_FadeIn,2900,UltraDMD_Animation_None
				SCFrame.imageA="LCD_VMode_sc0":SCFrame.opacity=20:SCFrame.visible=1:screenprim.image="LogoCL":screenprim.visible=1
				FlashForMs VMFlasher,8000,50,0:DOF 148, DOFPulse
				LeftFlipper.RotatetoStart:RightFlipper.RotatetoStart
				LeftFlipper1.RotatetoStart:RightFlipper1.RotatetoStart
				Tilted=1:StrikerModeStart(CurrentPlayer)=0
				Exit Sub
			End If
			If StrikerMode(CurrentPlayer)=2 AND FKAward(CurrentPlayer)=0 AND BSMODE(CurrentPlayer)=0 AND SemiFinalAward(CurrentPlayer)=0 Then
				StopFlash TDFL2,0
				GKMM=1:firstballout=1
				trapkicker.TimerInterval=7000:trapkicker.TimerEnabled=1
				UltraDMD.CancelRendering:PlaySound "gkmode":For each ii in TeamLogos:StopFlash ii,0:Next
				UltraDMD.DisplayScene00Ex "gkmode.gif", "",14,-1,"",14,-1,UltraDMD_Animation_FadeIn,6300,UltraDMD_Animation_None
				SCFrame.imageA="LCD_GKMode_sc0":SCFrame.opacity=20:SCFrame.visible=1:screenprim.image="LogoCL":screenprim.visible=1
				LeftFlipper.RotatetoStart:RightFlipper.RotatetoStart
				LeftFlipper1.RotatetoStart:RightFlipper1.RotatetoStart
				Tilted=1:StrikerModeStart(CurrentPlayer)=0
				Exit Sub
			End If
			If StrikerMode(CurrentPlayer)=1 AND FKAward(CurrentPlayer)=0 AND BSMODE(CurrentPlayer)=0 AND SemiFinalAward(CurrentPlayer)=0 Then
				StopFlash TDFL1,1
				EBAward=1:AddExtraBall:StrikerModeStart(CurrentPlayer)=0
				Lbomb1.state=0:Lbomb2.state=0:Lbomb3.state=0:Lbomb4.state=0
				Exit Sub
			End If
		End If
		'starts the mvp mode
		If MVPOfTheYear(CurrentPlayer)=1 AND finaljackpot.state=0 Then MVPEffectType=3:MVPEffect.Enabled=1:Exit Sub
	End If
End Sub 

Sub TRAPKICKER_timer
	Me.TimerEnabled=0
	StopMusic
	If GKMM=1 Then GKMODE:Else VMODE:End If
End Sub

Sub TrapKickBall:PlaySoundAt SoundFXDOF("fx_td-exit",123,DOFPulse,DOFContactors),TrapDoorP:FlashForMs fl4,150,150,0:StopFlash fl4a,1:FlashForMs fl4a,300,150,0:DOF 143,DOFPulse:End Sub

'*********************************************************************
'*****SUBSTITUTION BOARD**********************************************
'*********************************************************************
Sub walllock_Hit()
If Tilted=0 Then
	If MVPOfTheYear(CurrentPlayer)=0 Then
		TabletUp:subwall.image = "sub_textSUB":PlaySound "V.BOARDISUP":PlaySound "PIZZ":Llock.state=1
		UDMD_Display "substitution-rule.png", "", 14, 0, "SUBSTITUTION", 14, 0, UltraDMD_Animation_ScrollOnUp,1500, UltraDMD_Animation_FadeOut,6
	Else
		PlaySound "V.TRYAGAIN":If UltraDMD.IsRendering Then UltraDMD.CancelRendering
		UDMD_Display "MVP.gif", "NEXT TIME",15,2,"PLEASE",15,2,UltraDMD_Animation_None,1500,UltraDMD_Animation_FadeOut,6
	End If
	PlaySoundAt SoundFXDOF("fx_board_hit",117,DOFPulse,DOFShaker),ActiveBall:DOF 118,DOFPulse
	scores(CurrentPlayer)=scores(CurrentPlayer)+10000
	FlashForMs fl3,300,1000,0
	FlashForMs fl3a,600,300,0
	FlashForMs dome3,600,300,0
	DOF 147, DOFPulse
	B2SEffect B2SLight3,3,100
End If
End Sub

Sub TabletUp
	tspeed=0.5:tcase=1:tablet.enabled=1
	walllock.isdropped=1
	PlaySoundAt SoundFXDOF("fx_motorT",127,DOFOn,DOFGear),subwall
End Sub

Sub TabletDown
	tcase=2:tablet.enabled=1
	walllock.isdropped=0
	PlaySoundAt SoundFXDOF("fx_motorT",127,DOFOn,DOFGear),subwall
	subwall.image = "sub_text"
End Sub
Dim tabletstate,tcase,tspeed:tspeed=0.5
Sub tablet_timer()
	Select Case tcase
		Case 1		'Up
			subwall.z=subwall.z+tspeed
			If subwall.z>=142 Then tablet.enabled=0:StopSound "fx_motorT":DOF 127,DOFOff:exit sub
		Case 2		'Down
			subwall.z=subwall.z-tspeed
			If subwall.z<=65 Then tablet.enabled=0:StopSound "fx_motorT":DOF 127,DOFOff:exit sub
	End Select
End Sub

'*********************************************************************
'*****TICKET DIVERTER*************************************************
'*********************************************************************
Sub TicketDiverter(enabled)
	If Enabled Then
		PlaySoundAt SoundFXDOF("fx_DiverterUp",136,DOFPulse,DOFContactors),DiverterP
		wallticket.IsDropped=0
		DiverterP.Z=83.35
	Else
		PlaySoundAt SoundFXDOF("fx_DiverterDown",136,DOFPulse,DOFContactors),DiverterP
		wallticket.IsDropped=1
		DiverterP.Z=40
	End If
End Sub

'*********************************************************************
'*****GOAL************************************************************
'*********************************************************************
Dim BomberLState,BomberRState,GoalType,gdhit:gdhit=0:BomberLState=0:BomberRState=0

Sub Wall39_timer()
	Me.TimerEnabled=0
	GoalScene:DOF 118, DOFPulse
End Sub

Sub Kickergoal_timer
	If NOT UltraDMD.IsRendering Then
		Me.TimerEnabled=0										'When the scene finishes rendering ...
		If TrapDoorP.Z=0 AND headLD.z<0 AND headRD.z<0 Then		'If Snack Bar and bombers are down
			EBAwardTimer.Enabled=1:EBAw=2						'Starts the EB award and opens the Snack Bar
		Else
			AddExtraBall										'Get the EB directly
		End If
	End If
End Sub

Sub GoalHoles_hit(idx):RandomSoundHole:Wall39.TimerInterval=200:Wall39.TimerEnabled=1:End Sub

Sub triggergoal_hit()
	PlaySoundAt "fx_Moat_enter",ActiveBall:Me.DestroyBall
	If GoalType=1 Then Me.TimerInterval=2000:Me.TimerEnabled=1
	If GoalType=2 Then goalGKmm
	If GoalType=3 Then
		If FKGoal(CurrentPlayer)=3 Then
			Kickergoal.TimerInterval=100:Kickergoal.TimerEnabled=1:Me.TimerInterval=5500:Me.TimerEnabled=1
		Else
			Me.TimerInterval=2000:Me.TimerEnabled=1
		End If
	End If
End Sub

Sub GoalScene
MisterToyMove 5, 150
'first goal
	If Lgoal1.state=0 AND lgoal2.state=0 AND FK=0 AND GKMM=0 Then
		Lgoal1.state=1:PlaySound "goal":StopSoundGKSave:PlaySound "V.goal1":scores(CurrentPlayer)=scores(CurrentPlayer)+150000*(progress(CurrentPlayer)+1)
		GoalType=1:gdhit=gdhit+1
		FlashForMs fl1,3000,100,0:FlashForMs fl1a,3000,100,0:FlashForMs dome1,3000,100,0
		FlashForMs fl2,3000,100,0:FlashForMs fl2a,3000,100,0:FlashForMs dome2,3000,100,0
		FlashForMs fl3,3000,100,0:FlashForMs fl3a,3000,100,0:FlashForMs dome3,3000,100,0
		DOF 145, DOFPulse
		UltraDMD.CancelRendering:UDMD_Display "goal1.gif", "GOAL!!!", 0, 14, formatnumber(150000*(progress(CurrentPlayer)+1),0), 14, -1, UltraDMD_Animation_None, 3500, UltraDMD_Animation_None,10
		LightEffect 1:GiEffect 1
		exit sub
	End If
'second goal
	If Lgoal1.state=1 AND lgoal2.state=0 AND FK=0 AND GKMM=0 Then
		Lgoal2.state=1:CornerModeOff:StopSoundGKSave: PlaySound "goal":PlaySound "V.goal1":scores(CurrentPlayer)=scores(CurrentPlayer)+300000*(progress(CurrentPlayer)+1)
		GoalType=1:gdhit=gdhit+1
		FlashForMs fl1,3000,100,0:FlashForMs fl1a,3000,100,0:FlashForMs dome1,3000,100,0
		FlashForMs fl2,3000,100,0:FlashForMs fl2a,3000,100,0:FlashForMs dome2,3000,100,0
		FlashForMs fl3,3000,100,0:FlashForMs fl3a,3000,100,0:FlashForMs dome3,3000,100,0
		DOF 145, DOFPulse
		UltraDMD.CancelRendering:UDMD_Display "goal2.gif", "GOAL!!!", 0, 14, formatnumber(300000*(progress(CurrentPlayer)+1),0), 14, -1, UltraDMD_Animation_None, 3300, UltraDMD_Animation_None,10
		LightEffect 1:GiEffect 1
		exit sub
	End If
'third goal
	If Lgoal2.state=1 AND Lgoal3.state=0 AND FK=0 AND GKMM=0 Then
		For each ii in GoalHoles:ii.enabled=0:next					'temporary disable holes when you score the third goal
		Lgoal3.state=1:CornerModeOff:StopSoundGKSave:PlaySound "goal":PlaySound "V.goal2":scores(CurrentPlayer)=scores(CurrentPlayer)+500000*(progress(CurrentPlayer)+1)
		GoalType=1:gdhit=gdhit+1
		FlashForMs fl1,3000,100,0:FlashForMs fl1a,3000,100,0:FlashForMs dome1,3000,100,0
		FlashForMs fl2,3000,100,0:FlashForMs fl2a,3000,100,0:FlashForMs dome2,3000,100,0
		FlashForMs fl3,3000,100,0:FlashForMs fl3a,3000,100,0:FlashForMs dome3,3000,100,0
		DOF 145, DOFPulse
		UltraDMD.CancelRendering:UltraDMD.DisplayScene00Ex "goal3.gif", "WIN!!!", 0, 14, formatnumber(500000*(progress(CurrentPlayer)+1),0), 14, -1, UltraDMD_Animation_None, 3500, UltraDMD_Animation_None
		LightEffect 1:GiEffect 1
		If HeadLD.Z>0 Then BomberLState=1:bomberLdown.Enabled=1:hitLD.isdropped=1:WALL32.ISDROPPED=1:PlaySoundAt SoundFXDOF("fx_postdown",134,DOFPulse,DOFDropTargets),headLD
		If HeadRD.Z>0 Then BomberRState=1:bomberRdown.Enabled=1:hitRD.isdropped=1:WALL33.ISDROPPED=1:PlaySoundAt SoundFXDOF("fx_postdown",135,DOFPulse,DOFDropTargets),headRD
		GKHOLEin.enabled=1:moveGK.enabled=0:ResetGK
		If progress(CurrentPlayer)<6 Then
			If progress(CurrentPlayer)<=4 Then GKcount.Interval=2000:GKcount.enabled=1:defenceup.enabled=1:PlayLoopSoundAt SoundFXDOF("fx_motorD",128,DOFOn,DOFGear),defpost
			progress(CurrentPlayer)=progress(CurrentPlayer)+1:UpdateMatchLevelLights 2:UpdateTeams:UpdateTeamLogos
			If progress(CurrentPlayer)=4 Then SemiFinalAwardTimer.Enabled=1
		End If
		ArrowEffect False
		exit sub
	End If
'GK Mode Goal
	If GKMM=1 Then GoalType=2:exit sub   
'free kick goal
	If FK=1 Then
		FKGoal(CurrentPlayer)=FKGoal(CurrentPlayer)+1:FKChamp(CurrentPlayer)=FKChamp(CurrentPlayer)+1:GoalType=3
		scores(CurrentPlayer)=scores(CurrentPlayer)+1000000*FKGoal(CurrentPlayer):StopSoundGKSave:PlaySound "goal":PlaySound "V.He scores"
		FlashForMs fl1,3000,100,0:FlashForMs fl1a,3000,100,0:FlashForMs dome1,3000,100,0
		FlashForMs fl2,3000,100,0:FlashForMs fl2a,3000,100,0:FlashForMs dome2,3000,100,0
		FlashForMs fl3,3000,100,0:FlashForMs fl3a,3000,100,0:FlashForMs dome3,3000,100,0
		DOF 145, DOFPulse
		UltraDMD.CancelRendering
		UDMD_Display "fkgoal.gif", "FK GOAL!!!", 0, 14, formatnumber(1000000*FKGoal(CurrentPlayer),0), 14, -1, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None,10
		LightEffect 1:GiEffect 1
		If FKGoal(CurrentPlayer)=1 Then StopFlash FKFL1,1:exit sub
		If FKGoal(CurrentPlayer)=2 Then StopFlash FKFL2,1:exit sub
		If FKGoal(CurrentPlayer)=3 Then StopFlash FKFL3,1:exit sub
		If FKGoal(CurrentPlayer)=4 Then StopFlash FKFL4,1:exit sub
		If FKGoal(CurrentPlayer)=5 and fkcomplete.state=0 then
			StopFlash FKFL5,1
			fkcomplete.state=1:completed(CurrentPlayer)=completed(CurrentPlayer)+1
			FinalJackpotCheck 4
			If MVPOfTheYear(CurrentPlayer)=1 Then BIP=BIP-1:StopMusic
			exit sub
		End If
		If FKGoal(CurrentPlayer)=5 Then StopFlash FKFL5,1:exit sub
   End If
End Sub

Sub triggergoal_timer
	Me.TimerEnabled=0
	For each ii in GoalHoles:ii.enabled=1:next					're-enable holes after you score the third goal
	If GoalType=1 Then
		If Lgoal1.state=1 AND Lgoal2.state=1 AND Lgoal3.state=1 Then Lgoal1.state=0:Lgoal2.state=0:Lgoal3.state=0
		If gdhit=1 Then
			gdhit=0
		'after you score a goal and you are not playing the final match
			If progress(CurrentPlayer)<6 Then KGoalExit
		'after you score the 3rd goal and you are playing the final match
			If progress(CurrentPlayer)=6 Then BIP=BIP-1:scores(CurrentPlayer)=scores(CurrentPlayer)+20000000:WinTheCLFinal
		End If
		'used to release more than one ball when you score two consecutive goals
		'in a time interval of 2 seconds and you are not playing the final match
		If gdhit>1 Then
			gdhit=gdhit-1
			If progress(CurrentPlayer)<6 Then
				KGoalExit
				'to release a new ball after 1 second
				Me.TimerInterval=1000:Me.TimerEnabled=1
			End If
		'used to release more than one ball when you score two consecutive goals
		'in a time interval of 2 seconds  and you are playing the final match
			If progress(CurrentPlayer)=6 Then BIP=BIP-1:Me.TimerInterval=500:Me.TimerEnabled=1
		End If
	End If
	If GoalType=2 Then EndGKmm
	If GoalType=3 AND MVPOfTheYear(CurrentPlayer)=0 Then KGoalExit
End Sub

'************************************************************************
'*FOOD TRIGGER***********************************************************
'************************************************************************
Sub targ1_hit
PlaySoundAt SoundFXDOF("fx_target", 113, DOFPulse, DOFTargets), ActiveBall
If Tilted=0 Then
	scores(CurrentPlayer)=scores(CurrentPlayer)+10000
	If headLD.z<0 AND headRD.z<0 AND GKMM=0 AND TrapDoorP.Z=0 AND MVPOfTheYear(CurrentPlayer)=0 AND hotdog.state=0 Then
		hotdog.state=1:If NOT UltraDMD.IsRendering Then UDMD_Display "hotdog.gif","",0,0,"",0,0,UltraDMD_Animation_None,1500,UltraDMD_Animation_None,4
		If Table1.VersionMajor>10 OR (Table1.VersionMajor=10 AND Table1.VersionMinor>3) Then hotdogTL.state=1
		FlashForMs fl1,700,50,0:FlashForMs fl1a,700,50,0:FlashForMs dome1,700,50,0:B2SEffect B2SLight1,3,50:DOF 114,DOFPulse
		If hotdog.state=1 AND can.state=1 AND chips.state=1 Then
			tdfcolor=6:OpenTrapDoor True:BSMODE(CurrentPlayer)=1:lbreak1.state=2:lbreak2.state=2:hotdog.state=2:can.state=2:chips.state=2
			If Table1.VersionMajor>10 OR (Table1.VersionMajor=10 AND Table1.VersionMinor>3) Then hotdogTL.state=2:canTL.state=2:chipsTL.state=2
		End If
	End If
End If
End Sub

Sub targ2_hit
PlaySoundAt SoundFXDOF("fx_target", 113, DOFPulse, DOFTargets), ActiveBall
If Tilted=0 Then
	scores(CurrentPlayer)=scores(CurrentPlayer)+10000
	If headLD.z<0 AND headRD.z<0 AND GKMM=0 AND TrapDoorP.Z=0 AND MVPOfTheYear(CurrentPlayer)=0 AND can.state=0 Then
		can.state=1:If NOT UltraDMD.IsRendering Then UDMD_Display "can.gif","",0,0,"",0,0,UltraDMD_Animation_None,1500,UltraDMD_Animation_None,4
		If Table1.VersionMajor>10 OR (Table1.VersionMajor=10 AND Table1.VersionMinor>3) Then canTL.state=1
		FlashForMs fl1,700,50,0:FlashForMs fl1a,700,50,0:FlashForMs dome1,700,50,0:B2SEffect B2SLight1,3,50:DOF 114,DOFPulse
		If hotdog.state=1 AND can.state=1 AND chips.state=1 Then
			tdfcolor=6:OpenTrapDoor True:BSMODE(CurrentPlayer)=1:lbreak1.state=2:lbreak2.state=2:hotdog.state=2:can.state=2:chips.state=2
			If Table1.VersionMajor>10 OR (Table1.VersionMajor=10 AND Table1.VersionMinor>3) Then hotdogTL.state=2:canTL.state=2:chipsTL.state=2
		End If
	End If
End If
End Sub

Sub targ3_hit
PlaySoundAt SoundFXDOF("fx_target", 113, DOFPulse, DOFTargets), ActiveBall
If Tilted=0 Then
	scores(CurrentPlayer)=scores(CurrentPlayer)+10000
	If headLD.z<0 AND headRD.z<0 AND GKMM=0 AND TrapDoorP.Z=0 AND MVPOfTheYear(CurrentPlayer)=0 AND chips.state=0 Then
		chips.state=1:If NOT UltraDMD.IsRendering Then UDMD_Display "chips.gif","",0,0,"",0,0,UltraDMD_Animation_None,1500,UltraDMD_Animation_None,4
		If Table1.VersionMajor>10 OR (Table1.VersionMajor=10 AND Table1.VersionMinor>3) Then chipsTL.state=1
		FlashForMs fl1,700,50,0:FlashForMs fl1a,700,50,0:FlashForMs dome1,700,50,0:B2SEffect B2SLight1,3,50:DOF 114,DOFPulse
		If hotdog.state=1 AND can.state=1 AND chips.state=1 Then
			tdfcolor=6:OpenTrapDoor True:BSMODE(CurrentPlayer)=1:lbreak1.state=2:lbreak2.state=2:hotdog.state=2:can.state=2:chips.state=2
			If Table1.VersionMajor>10 OR (Table1.VersionMajor=10 AND Table1.VersionMinor>3) Then hotdogTL.state=2:canTL.state=2:chipsTL.state=2
		End If
	End If
End If
End Sub

'*********************************************************************
'*****BREAKSPIN*******************************************************
'*********************************************************************
Dim decr,randomchoice,rndchoicereal,out
Dim bscount:bscount=1

Sub BREAKSPIN_TIMER()
	out=out+1
	If out<800 Then 
		If bscount>0 Then BSCOUNT=BSCOUNT+1-(decr)
		decr=decr+0.001
		If bscount>0 AND bscount<10 Then 
			If lbreak1.state=0 Then PlaySound "fx_spinner":rndchoice
			FlashForMs Fl1,100,50,0:FlashForMs Fl1a,100,50,0:FlashForMs dome1,100,50,0
			DOF 142, DOFPulse
			lbreak1.state=1:lbreak2.state=0 
		End If               
		If bscount>10 AND bscount<20 Then 
			If lbreak2.state=0 Then PlaySound "fx_spinner":rndchoice
			FlashForMs Fl2,100,50,0:FlashForMs Fl2a,100,50,0:FlashForMs dome2,100,50,0
			DOF 140, DOFPulse
			lbreak1.state=0:lbreak2.state=1
		End If
		If bscount>20 Then bscount=1 
	End If

	If out=805 Then
		rndchoicereal=RndNum(1,30)
		PlaySound "prize"
		If rndchoicereal=1 Then UltraDMD.ModifyScene00 "rndch","   EXTRA BALL  ",""
		If rndchoicereal=2 Then
			If Lmultilock.state=1 OR Lmultiticket.state=1 OR lmultiskill.state=1 OR headLD.Z>0 OR headRD.Z>0 OR MVPOfTheYear(CurrentPlayer)=1 Then
				out=801			'restart the looping sequence if game is in multiball mode or strikers are up or in MVP
			Else
				UltraDMD.ModifyScene00 "rndch","   G.K. MODE   ",""
			End If
		End If
		If rndchoicereal=3 Then
			If Lmultilock.state=1 OR Lmultiticket.state=1 OR lmultiskill.state=1 Then
				out=801			'restart the looping sequence if game is in multiball mode
			Else
				UltraDMD.ModifyScene00 "rndch","   VIDEO MODE  ",""
			End If
		End If
		If rndchoicereal=4 Then UltraDMD.ModifyScene00 "rndch","   1.000.000   ",""
		If rndchoicereal=5 Then
			If moveGK.ENABLED OR Lmultilock.state=1 OR Lmultiticket.state=1 OR lmultiskill.state=1 OR MVPOfTheYear(CurrentPlayer)=1 Then
				out=801			'restart the looping sequence if game is in multiball mode or in MVP or the gk is moving
			Else
				UltraDMD.ModifyScene00 "rndch","   FREE KICK   ",""
			End If
		End If
		If rndchoicereal=6 Then
			If win(CurrentPlayer)<defencestate(CurrentPlayer) AND progress(CurrentPlayer)<5 AND MVPOfTheYear(CurrentPlayer)=0 Then
				UltraDMD.ModifyScene00 "rndch","  DEFENCE DOWN ",""
			Else
				out=801			'restart the looping sequence if defence is already down or during the final or in MVP
			End If
		End If
		If rndchoicereal>6 AND rndchoicereal<10 Then
			If LockMultiMode>0 OR MVPOfTheYear(CurrentPlayer)=1 Then
				out=801			'restart the looping sequence if game is in Mister Multiball Mode or in MVP
			Else
				UltraDMD.ModifyScene00 "rndch","  ADVANCE LOCK ",""
			End If
		End If
		If rndchoicereal=10 Then
			If lkag.state=0 Then
				UltraDMD.ModifyScene00 "rndch"," 30 SEC. SAVER ",""
			Else
				out=801			'restart the looping sequence if kickagain light is on
			End If
		End If
		If rndchoicereal>10 AND rndchoicereal<21 Then UltraDMD.ModifyScene00 "rndch","    500.000    ",""
		If rndchoicereal=21 Then 
			If Lmultilock.state=0 AND Lmultiticket.state=0 AND lmultiskill.state=0 AND headLD.z<0 AND headRD.z<0 AND MVPOfTheYear(CurrentPlayer)=0 Then
				UltraDMD.ModifyScene00 "rndch"," M.BALL IS LIT ",""
			Else
				out=801			'restart the looping sequence if game is in multiball mode or Strikers are up or in MVP
			End If
		End If
		If rndchoicereal>21 AND rndchoicereal<31 Then UltraDMD.ModifyScene00 "rndch","   BUMPERS X   ",""
	End If

	If out=1000 Then 
		UltraDMD.CancelRendering
		PRIZE:out=0
		DECR=0:BSCOUNT=1
		BREAKSPIN.ENABLED=0
		StopFlash TDFL1,0:StopFlash TDFL2,0:StopFlash TDFL3,0
		If extraball(CurrentPlayer)>0 then StopFlash TDFL1,1
		exit sub
    End If
End Sub

Sub RNDCHOICE
'looping sequence during Break Spin Mode
	UltraDMD.DisplayScene00ExWithID "rndch",false, "breakspin.gif", "               ", 15, 0, "", 15, 0, UltraDMD_Animation_ScrollOnDown, 10000, UltraDMD_Animation_None
    randomize
    randomchoice=RndNum(1,11)
    If randomchoice=1 Then UltraDMD.ModifyScene00 "rndch","   EXTRA BALL  ",""
    If randomchoice=2 Then UltraDMD.ModifyScene00 "rndch","   G.K. MODE   ",""
    If randomchoice=3 Then UltraDMD.ModifyScene00 "rndch","   VIDEO MODE  ",""
    If randomchoice=4 Then UltraDMD.ModifyScene00 "rndch","   1.000.000   ",""
    If randomchoice=5 Then UltraDMD.ModifyScene00 "rndch","   FREE KICK   ",""
    If randomchoice=6 Then UltraDMD.ModifyScene00 "rndch","  DEFENCE DOWN ",""
    If randomchoice=7 Then UltraDMD.ModifyScene00 "rndch","  ADVANCE LOCK ",""
    If randomchoice=8 Then UltraDMD.ModifyScene00 "rndch"," 30 SEC. SAVER ",""
    If randomchoice=9 Then UltraDMD.ModifyScene00 "rndch","    500.000    ",""
    If randomchoice=10 Then UltraDMD.ModifyScene00 "rndch"," M.BALL IS LIT ",""
    If randomchoice=11 Then UltraDMD.ModifyScene00 "rndch","   BUMPERS X   ",""
End Sub

Sub PRIZE
'this is the Break Spin Mode Award
    hotdog.state=0:can.state=0:chips.state=0:lbreak1.state=0:lbreak2.state=0:hotdogTL.state=0:canTL.state=0:chipsTL.state=0
'Award #1 = EXTRA BALL
	If rndchoicereal=1 Then EBAward=2:AddExtraball
'Award #2 = GOALKEEPER MODE
	If rndchoicereal=2 Then
		GKMM=1:firstballout=1:gkmodel.state=1:gkmoder.state=1:GKModeBS=1
		trapkicker.TimerInterval=7000:trapkicker.TimerEnabled=1:For each ii in TeamLogos:StopFlash ii,0:Next
		SCFrame.imageA="LCD_GKMode_sc0":SCFrame.opacity=20:SCFrame.visible=1:PlaySound "gkmode":screenprim.image="LogoCL":screenprim.visible=1
		UltraDMD.DisplayScene00Ex "gkmode.gif", "",14,-1,"",14,-1,UltraDMD_Animation_FadeIn,6500,UltraDMD_Animation_None
    End If
'Award #3 = VIDEO MODE
    If rndchoicereal=3 Then
		videomodel.state=1:videomoder.state=1:VModeBS=1
		trapkicker.TimerInterval=4000:trapkicker.TimerEnabled=1:For each ii in TeamLogos:StopFlash ii,0:Next
		SCFrame.imageA="LCD_VMode_sc0":SCFrame.opacity=20:SCFrame.visible=1:screenprim.image="LogoCL":screenprim.visible=1
		FlashForMs VMFlasher,8000,50,0:DOF 148, DOFPulse:PlaySound "vmode"
		UltraDMD.DisplayScene00Ex "videomode.gif", "",14,-1,"",14,-1,UltraDMD_Animation_FadeIn,2900,UltraDMD_Animation_None
	End If
'Award #4 = 1 MILLION POINTS
	If rndchoicereal=4 Then
		scores(CurrentPlayer)=scores(CurrentPlayer)+1000000
		UltraDMD.CancelRendering
		UDMD_Display "prize.gif", "   1.000.000   ", 15, 0, "", 15, 0, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
		KGoalExit
	End If
'Award #5 = FREE KICK
    If rndchoicereal=5 Then
		PlaySound "fischio":PlaySound "V.freekick":TDExit=1:waitforkick.Enabled=1:L21.STATE=0:L20.STATE=0:FK=1
		lpin.isdropped=0:rpin.isdropped=0:PlaySoundAt SoundFXDOF("fx_postup",133,DOFPulse,DOFDropTargets), Apron
		For each ii in TeamLogos:StopFlash ii,0:Next
		SCFrame.opacity=100:SCFrame.imageA="LCD_freekick":SCFrame.visible=1
		UltraDMD.DisplayScene00Ex "freekick.png","FREE KICK      ", 14,-1,"",14,-1, UltraDMD_Animation_ScrollOnUp, 2500, UltraDMD_Animation_ScrollOffDown
		UltraDMD.DisplayScene00Ex "crfreekick.gif", "", 14,-1,"",14,-1, UltraDMD_Animation_None, 2500, UltraDMD_Animation_FadeOut
		SaveMatchLampStates:ArrowEffect True
		GiOff
		If FKGoal(CurrentPlayer)=0 Then Flash FKFl1,150:exit sub
		If FKGoal(CurrentPlayer)=1 Then Flash FKFL2,150:exit sub
		If FKGoal(CurrentPlayer)=2 Then Flash FKFL3,150:exit sub
		If FKGoal(CurrentPlayer)=3 Then Flash FKFL4,150:exit sub
		If FKGoal(CurrentPlayer)=4 Then Flash FKFL5,150:exit sub
	End If
'Award #6 = DEFENCE DEFEATED
    If rndchoicereal=6 Then
		win(CurrentPlayer)=defencestate(CurrentPlayer):UpdateMatchLevelLights 1:CheckMatchLevel
		scores(CurrentPlayer)=scores(CurrentPlayer)+100000*win(CurrentPlayer)
		UltraDMD.CancelRendering
		UDMD_Display "prize.gif", "DEFENCE", 15, 0, "DEFEATED", 15, 0, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,4
		KGoalExit
	End If
'Award #7 = ADVANCE LOCK
	If rndchoicereal>6 AND rndchoicereal<10 Then
		UltraDMD.CancelRendering
		If LLOCK.STATE=2 AND LLOCK1.STATE=2 AND LLOCK2.STATE=2 AND LLOCK3.STATE=2 Then 
			Llock.state=1:subwall.image = "sub_textSUB":scores(CurrentPlayer)=scores(CurrentPlayer)+10000
			TabletUp
			UDMD_Display "substitution-rule.png", "", 14, 0, "SUBSTITUTION", 14, 0, UltraDMD_Animation_ScrollOnUp,1500, UltraDMD_Animation_FadeOut,6
			PlaySound "V.BOARDISUP":PlaySound "PIZZ"
			KGoalExit
			exit sub
		End If
		If LLOCK.STATE=1 AND LLOCK1.STATE=2 Then
			LLock1.state=1:subwall.image = "sub_textSUB1"
			UDMD_Display "substitution1.gif", "", -1, -1, "", -1, -1, UltraDMD_Animation_ScrollOnUp, 2500, UltraDMD_Animation_FadeOut,6
			PlaySound "V.FIRSTCHANGE":PlaySound "PIZZ"
			KGoalExit
			exit sub
		End If
		If LLOCK1.STATE=1 AND LLOCK2.STATE=2 Then
			Llock2.state=1:subwall.image = "sub_textSUB2"
			UDMD_Display "substitution2.gif", "", -1, -1, "", -1, -1, UltraDMD_Animation_ScrollOnUp, 2200, UltraDMD_Animation_FadeOut,6
			PlaySound "V.SECONDCHANGE":PlaySound "PIZZ"
			KGoalExit 
			exit sub
		End If
		If LLOCK2.STATE=1 AND LLOCK3.STATE=2 AND lmultilock.state=0 AND lmultiticket.state=0 AND lmultiskill.state=0 Then
			rndchoicereal=21
		End If
		If LLOCK2.STATE=1 AND LLOCK3.STATE=2 AND (TicketMultiMode>0 OR SkillMultiMode>0) Then
			KGoalExit
		End If
	End If
'Award #8 = 30 SEC. BALLSAVER
    If rndchoicereal=10 Then
		kicked=0:kickcount=0:BSaverAward=1:kickagainT.enabled=1:Lkag.state=1
		UltraDMD.CancelRendering
		UDMD_Display "prize.gif", " 30 SEC.SAVER ", 15, 0, "", 15, 0, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
		KGoalExit
	End If
'Award #9 = 500.000 POINTS
    If rndchoicereal>10 AND rndchoicereal<21 Then
		scores(CurrentPlayer)=scores(CurrentPlayer)+500000
		UltraDMD.CancelRendering
		UDMD_Display "prize.gif", "    500.000    ", 15, 0, "", 15, 0, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,6
		KGoalExit
	End If
'Award #10 = MISTER MULTIBALL IS LIT
    If rndchoicereal=21 Then
		LockMultiMode=1:lmultilock.state=2:Lmultiskill.state=2:Lmultiticket.state=2
		llock.state=1:llock1.state=1:llock2.state=1:llock3.state=1
		subwall.image = "sub_textSUB3"
		If subwall.z< 70 Then TabletUp
		UDMD_Display "multiball.gif", "MULTIBALL", 14, 2, "IS LIT", 14, 2, UltraDMD_Animation_ScrollOnUp, 3000, UltraDMD_Animation_FadeOut,6
		PlaySound "V.MISTERMISLIT":PlaySound "PIZZ"
		If DiverterP.Z>50 Then TicketDiverter False
		BallRelease.CreateSizedBallWithMass Ballsize/2,BallMass:UpdateBall:BallRelease.Kick 90, 7:PlaySoundAt SoundFXDOF("fx_ballrel",121,DOFPulse,DOFContactors),Ballrelease
		DOF 151, DOFPulse:If Lx1.state=1 AND Lx2.state=1 Then Lx1.state=0:Lx2.state=0
		exit sub
    End If
'Award #11 = ADVANCE BUMPERS X
	If rndchoicereal>21 AND rndchoicereal<31 Then 
		If bonus<10 Then bonus=bonus + 2 
		PlaySound "bumpmult"
		UltraDMD.CancelRendering
		UDMD_Display "bonusX.gif", "BUMPERS", 15,0, "X" & bonus, 15,0, UltraDMD_Animation_ScrollOnUp, 2000, UltraDMD_Animation_FadeOut,3
		KGoalExit
    End If
End Sub

'*********************************************************************
'**** LIGHTS *********************************************************
'*********************************************************************
Sub SwapBonusLights
	If SkillShotMode=0 Then
		If Lx1.state=1 Then Lx1.state=0:Lx2.state=1:exit sub
		If Lx2.state=1 Then Lx2.state=0:Lx1.state=1:exit sub
	Else
		If Lx1.state=2 Then Lx1.state=0:Lx2.state=2:exit sub
		If Lx2.state=2 Then Lx2.state=0:Lx1.state=2:exit sub
	End If
End Sub

Sub SaveMatchLampStates
	For ii = 0 To 8:LampState(ii)=AllInserts(ii).State:Next						'save the state to the lampstate array
End Sub

Sub RestoreMatchLampStates
	For ii = 0 To 8:AllInserts(ii).State=LampState(ii):Next						'restore the state from the lampstate array
End Sub

Sub SavePlayerLampStates
	For ii = 0 To AllInserts.count-1:AllPlayersLampStates(CurrentPlayer,ii)=AllInserts(ii).State:Next						'save the state to the lampstate array (for each Player)
End Sub

Sub RestorePlayerLampStates
	For ii = 0 To AllInserts.count-1:AllInserts(ii).State=AllPlayersLampStates(CurrentPlayer,ii):Next						'restore the state from the lampstate array (for each Player)
End Sub

Sub GiEffect(n)
    Select Case n
        Case 0 	'off Then on
            LightSeqGi.UpdateInterval = 4
            LightSeqGi.Play SeqBlinking, , 1, 300
        Case 1	'blink 10 times every 100 ms
            LightSeqGi.UpdateInterval = 4
            LightSeqGi.Play SeqBlinking, , 10, 100
        Case 2	'multiball
            LightSeqGi.UpdateInterval = 5
            LightSeqGi.Play SeqLeftOn, 30, 1
            LightSeqGi.Play SeqRightOn, 30, 1
        Case 3	'extraball
            LightSeqGi.UpdateInterval = 4
            LightSeqGi.Play SeqUpOn
		Case 4	'MVP Mode
			gidir=1:MVPGI.Interval=15:MVPGI.Enabled=1
    End Select
End Sub

Dim mvpgicc,gidir
Sub MVPGI_Timer
	mvpgicc=mvpgicc+gidir
	If mvpgicc=101 Then gidir=-1
	If mvpgicc=0 Then gidir=1
	For Each ii in GI:ii.IntensitySCale=mvpgicc/100:Next
End Sub

Sub LightEffect(n)
    Select Case n
        Case 0 'defenders/Strikers
			LightSeqInserts.UpdateInterval=2
            LightSeqInserts.Play SeqRandom,50,,50
			B2SEffect Array(B2SLight1,B2SLight2,B2SLight3), 4, 50
        Case 1 'goal scoring/mvp win
            LightSeqInserts.UpdateInterval = 4
            LightSeqInserts.Play SeqBlinking, , 10, 100
			B2SEffect Array(B2SLight1,B2SLight2,B2SLight3), 16, 100
        Case 2 'multiball
			LightSeqInserts.UpdateInterval=15
			LightSeqInserts.Play SeqUpOn,20
			LightSeqInserts.UpdateInterval=2
			LightSeqInserts.Play SeqRandom,60,,200
			B2SOffbkgnd
        Case 3 'extraball
            LightSeqInserts.UpdateInterval = 4
            LightSeqInserts.Play SeqHatch1HorizOn, 4, 3
			LightSeqInserts.UpdateInterval=2
            LightSeqInserts.Play SeqRandom,50,,100
			B2SOffbkgnd
        Case 4 'jackpot
            LightSeqInserts.UpdateInterval = 5
            LightSeqInserts.Play SeqLeftOn, 10, 1
            LightSeqInserts.Play SeqRightOn, 10, 1
			B2SEffect Array(B2SLight1,B2SLight2,B2SLight3), 5, 50
		Case 5	'boots
			LightSeqInserts.UpdateInterval = 4
			LightSeqInserts.Play SeqMiddleInHorizOn, 10,2
			B2SEffect B2SLight3,4,50
    End Select
End Sub

Dim sjcount,cicles,cicleduration

'let's repeat the flasher effect for n times
Sub FlasherEffect(n):SJTimer.Enabled=0:cicles=0:sjcount=0:SJTimer.Enabled=1:cicleduration=n:End Sub

Sub SJTimer_timer
	sjcount=sjcount+1
	If sjcount=10 Then
		FlashForMs fl2,100,50,0
		FlashForMs fl2a,100,50,0
		FlashForMs dome2,100,50,0
		DOF 140, DOFPulse
	End If
	If sjcount=15 Then
		FlashForMs fl3,100,50,0
		FlashForMs fl3a,100,50,0
		FlashForMs dome3,100,50,0
		DOF 141, DOFPulse
	End If
	If sjcount=20 Then
		FlashForMs fl1,100,50,0
		FlashForMs fl1a,100,50,0
		FlashForMs dome1,100,50,0
		DOF 142, DOFPulse
	End If
	If sjcount>20 Then sjcount=9:cicles=cicles+1
	If cicles=(cicleduration+1) Then Me.Enabled=0:cicles=0:sjcount=0
End Sub

'*****TEAM LOGOS***************************************************************
Sub UpdateTeamLogos
	Teamlogos(0).imageA="logo" & teamone(CurrentPlayer):Teamlogos(0).opacity=3:StopFlash TeamLogos(0),1
	Teamlogos(1).imageA="logo" & teamtwo(CurrentPlayer):Teamlogos(1).opacity=3:StopFlash TeamLogos(1),1
	Teamlogos(2).imageA="logo" & teamthree(CurrentPlayer):Teamlogos(2).opacity=3:StopFlash TeamLogos(2),1
	TeamLogos(3).imageA="logo" & choiceteam(CurrentPlayer)
	Teamlogos(4).imageA="logo" & teamfour(CurrentPlayer):Teamlogos(4).opacity=3:StopFlash TeamLogos(4),1
	Teamlogos(5).imageA="logo" & teamfive(CurrentPlayer):Teamlogos(5).opacity=3:StopFlash TeamLogos(5),1
	Teamlogos(6).imageA="logo" & teamsix(CurrentPlayer):Teamlogos(6).opacity=3:StopFlash TeamLogos(6),1
	Select Case progress(CurrentPlayer)
		Case 0
			Teamlogos(0).opacity=50:Flash TeamLogos(0),250
		Case 1
			Teamlogos(0).opacity=50:StopFlash TeamLogos(0),1
			Teamlogos(1).opacity=50:Flash TeamLogos(1),250
		Case 2
			Teamlogos(0).opacity=50:Teamlogos(1).opacity=50:Teamlogos(2).opacity=50
			StopFlash TeamLogos(0),1:StopFlash TeamLogos(1),1
			Flash TeamLogos(2),250
		Case 3
			Teamlogos(0).opacity=50:Teamlogos(1).opacity=50:Teamlogos(2).opacity=50:Teamlogos(4).opacity=50
			StopFlash TeamLogos(0),1:StopFlash TeamLogos(1),1:StopFlash TeamLogos(2),1
			Flash TeamLogos(4),250
		Case 4
			Teamlogos(0).opacity=50:Teamlogos(1).opacity=50:Teamlogos(2).opacity=50:Teamlogos(4).opacity=50:Teamlogos(5).opacity=50
			StopFlash TeamLogos(0),1:StopFlash TeamLogos(1),1:StopFlash TeamLogos(2),1:StopFlash TeamLogos(4),1
			Flash TeamLogos(5),250
		Case 5
			Teamlogos(0).opacity=50:Teamlogos(1).opacity=50:Teamlogos(2).opacity=50:Teamlogos(4).opacity=50:Teamlogos(5).opacity=50:Teamlogos(6).opacity=50
			StopFlash TeamLogos(0),1:StopFlash TeamLogos(1),1:StopFlash TeamLogos(2),1:StopFlash TeamLogos(4),1:StopFlash TeamLogos(5),1
			Flash TeamLogos(6),250
		Case 6
			Teamlogos(0).opacity=50:Teamlogos(1).opacity=50:Teamlogos(2).opacity=50:Teamlogos(4).opacity=50:Teamlogos(5).opacity=50:Teamlogos(6).opacity=50
			StopFlash TeamLogos(0),1:StopFlash TeamLogos(1),1:StopFlash TeamLogos(2),1:StopFlash TeamLogos(4),1:StopFlash TeamLogos(5),1:StopFlash TeamLogos(6),1
	End Select
End Sub

'*****MATCH LEVEL LIGHTS***********************************************
Sub UpdateMatchLevelLights(n)
Select Case n
	Case 0		'when defence goes up
		If defencestate(CurrentPlayer)=6 Then LqualifyG.state=2:LgroupG.state=2:LfirstG.state=2:LquarterG.state=2:LsemiG.state=2:LfinalG.state=2:Lwinfinal.state=2
		If defencestate(CurrentPlayer)=5 Then LqualifyG.state=2:LgroupG.state=2:LfirstG.state=2:LquarterG.state=2:LsemiG.state=2:Lwinsemi.state=2
		If defencestate(CurrentPlayer)=4 Then LqualifyG.state=2:LgroupG.state=2:LfirstG.state=2:LquarterG.state=2:Lwinquarter.state=2
		If defencestate(CurrentPlayer)=3 Then LqualifyG.state=2:LgroupG.state=2:LfirstG.state=2:Lwinfirst.state=2
		If defencestate(CurrentPlayer)=2 Then LqualifyG.state=2:LgroupG.state=2:Lwingroup.state=2
		If defencestate(CurrentPlayer)=1 Then LqualifyG.state=2
	Case 1			'everytime you hit the 3 defenders 
		If win(CurrentPlayer)=6  Then LqualifyG.state=1:LgroupG.state=1:LfirstG.state=1:LquarterG.state=1:LsemiG.state=1:LfinalG.state=1
		If win(CurrentPlayer)=5  Then LqualifyG.state=1:LgroupG.state=1:LfirstG.state=1:LquarterG.state=1:LsemiG.state=1
		If win(CurrentPlayer)=4  Then LqualifyG.state=1:LgroupG.state=1:LfirstG.state=1:LquarterG.state=1
		If win(CurrentPlayer)=3  Then LqualifyG.state=1:LgroupG.state=1:LfirstG.state=1
		If win(CurrentPlayer)=2  Then LqualifyG.state=1:LgroupG.state=1
		If win(CurrentPlayer)=1  Then LqualifyG.state=1
	Case 2			'after you score the 3rd goal
		If progress(CurrentPlayer)=6 Then
			Lwinqualify.BlinkPattern="10":Lwinqualify.BlinkInterval=150:Lwinqualify.state=1
			Lwingroup.BlinkPattern="10":Lwingroup.BlinkInterval=150:Lwingroup.state=1
			Lwinfirst.BlinkPattern="10":Lwinfirst.BlinkInterval=150:Lwinfirst.state=1
			Lwinquarter.BlinkPattern="10":Lwinquarter.BlinkInterval=150:Lwinquarter.state=1
			Lwinsemi.BlinkPattern="10":Lwinsemi.BlinkInterval=150:Lwinsemi.state=1
			Lwinfinal.state=1
		End If
		If progress(CurrentPlayer)=5 Then
			Lwinqualify.BlinkPattern="10000":Lwinqualify.BlinkInterval=80:Lwinqualify.state=2
			Lwingroup.BlinkPattern="01000":Lwingroup.BlinkInterval=80:Lwingroup.state=2
			Lwinfirst.BlinkPattern="00100":Lwinfirst.BlinkInterval=80:Lwinfirst.state=2
			Lwinquarter.BlinkPattern="00010":Lwinquarter.BlinkInterval=80:Lwinquarter.state=2
			Lwinsemi.BlinkPattern="00001":Lwinsemi.BlinkInterval=80:Lwinsemi.state=2
			Lwinfinal.state=2
		End If
		If progress(CurrentPlayer)=4 Then Lwinquarter.state=1
		If progress(CurrentPlayer)=3 Then Lwinfirst.state=1
		If progress(CurrentPlayer)=2 Then Lwingroup.state=1
		If progress(CurrentPlayer)=1 Then Lwinqualify.state=1
End Select
End Sub

Sub ArrowEffect(enabled)
	If Enabled Then
		LqualifyG.BlinkPattern="100000":LqualifyG.BlinkInterval=100:LqualifyG.state=2
		LgroupG.BlinkPattern="010000":LgroupG.BlinkInterval=100:LgroupG.state=2
		LfirstG.BlinkPattern="001000":LfirstG.BlinkInterval=100:LfirstG.state=2
		LquarterG.BlinkPattern="000100":LquarterG.BlinkInterval=100:LquarterG.state=2
		LsemiG.BlinkPattern="000010":LsemiG.BlinkInterval=100:LsemiG.state=2
		LfinalG.BlinkPattern="000001":LfinalG.BlinkInterval=100:LfinalG.state=2
	Else
		LqualifyG.BlinkPattern="10":LqualifyG.BlinkInterval=400:LqualifyG.state=0
		LgroupG.BlinkPattern="10":LgroupG.BlinkInterval=400:LgroupG.state=0
		LfirstG.BlinkPattern="10":LfirstG.BlinkInterval=400:LfirstG.state=0
		LquarterG.BlinkPattern="10":LquarterG.BlinkInterval=400:LquarterG.state=0
		LsemiG.BlinkPattern="10":LsemiG.BlinkInterval=400:LsemiG.state=0
		LfinalG.BlinkPattern="10":LfinalG.BlinkInterval=400:LfinalG.state=0
	End If
End Sub

'*****GI********************************************************
Sub GiOn
For each ii in GI:ii.state=1:next:B2SOnbkgnd
For each ii in BumpLights:ii.state=1:next
For each ii in GIAmbient:ii.visible=1:next
DOF 126, DOFOn
End Sub

Sub GiOff
For each ii in GI:ii.state=0:next:B2SOffbkgnd
For each ii in BumpLights:ii.state=0:next
For each ii in GIAmbient:ii.visible=0:next
DOF 126, DOFOff
End Sub

'*****FLASHERS*******************************************************************************
'********************************************************************************************
' Only for VPX 10.2 AND higher.
' FlashForMs will blink light or a flasher for TotalPeriod(ms) at rate of BlinkPeriod(ms)
' When TotalPeriod done, light or flasher will be set to FinalState value where
' Final State values are:   0=Off, 1=On, 2=Return to previous State
'********************************************************************************************
Sub FlashForMs(MyLight, TotalPeriod, BlinkPeriod, FinalState)			'thanks gtxjoe for the first myVersion
	If TypeName(MyLight) = "Light" Then
		If FinalState = 2 Then FinalState = MyLight.State				'Keep the current light state
		MyLight.BlinkInterval = BlinkPeriod
		'starts a light in startState and leaves it into that state for the amount of milliseconds defined by durationTime until the light switches to the endState
		MyLight.Duration 2, TotalPeriod, FinalState

    ElseIf TypeName(MyLight) = "Flasher" Then
		If FinalState = 2 Then FinalState = ABS(MyLight.Visible)		'Keep the current flasher state
		' Store all blink information
		MyLight.visible=1
		MyLight.UserValue = Int(TotalPeriod / BlinkPeriod - 1.5) * 10 + FinalState					'Store # of blinks, AND final state
		' Start blink timer
		MyLight.TimerInterval = BlinkPeriod
		MyLight.TimerEnabled = 0
		MyLight.TimerEnabled = 1
		'create timer subroutine
		ExecuteGlobal	"Sub " & MyLight.Name & "_Timer:"&_
						"Dim tmp, steps, fstate:"&_
						"tmp=me.UserValue:fstate=tmp MOD 10:steps=tmp\10:"&_
						"Me.Visible=steps MOD 2:"&_
						"me.UserValue=(steps-1) *10 + fstate:"&_
						"If Steps=0 Then Me.Visible=fstate:Me.TimerEnabled=0:me.UserValue="""":End If:"&_
						"End Sub"

	ElseIf TypeName(MyLight) = "Primitive" Then
		ExecuteGlobal "dome" & Right(MyLight.Name,1) & ".image=""dome red_on"":dome" & Right(MyLight.Name,1) & ".disablelighting=1"
		ExecuteGlobal "fl" & Right(MyLight.Name,1) & ".UserValue = " & Int(TotalPeriod / BlinkPeriod - 1.5) * 10 + FinalState
		' Start blink timer
		ExecuteGlobal "fl" & Right(MyLight.Name,1) & ".TimerInterval = " & BlinkPeriod
		ExecuteGlobal "fl" & Right(MyLight.Name,1) & ".TimerEnabled = 0"
		ExecuteGlobal "fl" & Right(MyLight.Name,1) & ".TimerEnabled = 1"
		'create timer subroutine
		ExecuteGlobal	"Sub fl" & Right(MyLight.Name,1) & "_Timer:"&_
						"Dim tmp, steps, fstate,nsteps:"&_
						"tmp=Me.UserValue:fstate=tmp MOD 10:"&_
						"steps=tmp\10:"&_
						"nsteps=steps MOD 2:"&_
						"If nsteps=0 Then dome" & Right(MyLight.Name,1) & ".image=""dome red"":dome" & Right(MyLight.Name,1) & ".disablelighting=0 Else dome" & Right(MyLight.Name,1) & ".image=""dome red_on"":dome" & Right(MyLight.Name,1) & ".disablelighting=1 End If:"&_
						"Me.UserValue=(steps-1) *10 + fstate:"&_
						"If steps=0 Then "&_
						"If fstate=0 Then dome" & Right(MyLight.Name,1) & ".image=""dome red"":dome" & Right(MyLight.Name,1) & ".disablelighting=0 Else dome" & Right(MyLight.Name,1) & ".image=""dome red_on"":dome" & Right(MyLight.Name,1) & ".disablelighting=1 End If:"&_
						"Me.TimerEnabled=0:me.UserValue="""""&_
						"End If:End Sub"
	End If
End Sub

Sub Flash (obj,BlinkPeriod)
	obj.UserValue=1
	obj.TimerInterval=BlinkPeriod
	obj.TimerEnabled=0
	obj.TimerEnabled=1
	ExecuteGlobal "Sub " & obj.Name & "_Timer:" & "Dim lsteps:lsteps=me.UserValue -1:Me.Visible=lsteps MOD 2:me.UserValue=me.UserValue + 1:End Sub"
End Sub

Sub StopFlash (obj,FinalState)
	obj.TimerEnabled=0
	obj.Visible=FinalState
End Sub

'***ATTRACT MODE *****************************************************
Dim cAttractMode
Sub StopAttractMode
	DisplayIntro1.enabled=0:SCframe.visible=0:SCframe.imageA=""
	If B2SOn Then B2SAttract.Enabled=0:B2SEffect Array(B2SLight1,B2SLight2,B2SLight3,B2SLight4),1,100
	StopFlash FKFL1,0:StopFlash FKFL2,0:StopFlash FKFL3,0:StopFlash FKFL4,0:StopFlash FKFL5,0
	StopFlash TDFL1,0:StopFlash TDFL2,0:StopFlash TDFL3,0
	For each ii in BumpLights:ii.state=1:next
	LightSeqAttract.StopPlay:cAttractMode=0
	If NOT OptMenuEnabled Then
		Llock.state=2:Llock1.state=2:Llock2.state=2:Llock3.state=2
		skill1.state=2:skill2.state=2:skill3.state=2
		ticket1.state=2:ticket2.state=2:ticket3.state=2
	End If
End Sub

Sub StartAttractMode
	If NOT DisplayIntro1.Enabled Then ScFrame.opacity=100:SCframe.imageA="LCD_introtxt_00":SCframe.visible=1:DisplayIntro1.Interval=100:DisplayIntro1.Enabled=1
	If B2SOn AND NOT B2SAttract.Enabled Then B2SAttract.Enabled=1
	If NOT TDFL1.TimerEnabled Then Flash TDFL1,50:Flash TDFL2,100:Flash TDFL3,150
	If NOT FKFL1.TimerEnabled Then Flash FKFL1,50:Flash FKFL2,100:Flash FKFL3,150:Flash FKFL4,200:Flash FKFL5,250
	For each ii in BumpLights:ii.state=2:next:cAttractMode=1
    'Attract Mode lights sequences
    LightSeqAttract.UpdateInterval = 25
    LightSeqAttract.Play SeqRandom, 40, , 6000
    LightSeqAttract.Play SeqBlinking, , 5, 300
    LightSeqAttract.Play SeqAllOff
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqCircleOutOn, 15, 2
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 25, 1
    LightSeqAttract.UpdateInterval = 10
    LightSeqAttract.Play SeqCircleOutOn, 15, 3
    LightSeqAttract.UpdateInterval = 5
    LightSeqAttract.Play SeqRightOn, 50, 1
    LightSeqAttract.UpdateInterval = 5
    LightSeqAttract.Play SeqLeftOn, 50, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqRightOn, 50, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 50, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqRightOn, 40, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 40, 1
    LightSeqAttract.UpdateInterval = 10
    LightSeqAttract.Play SeqRightOn, 30, 1
    LightSeqAttract.UpdateInterval = 10
    LightSeqAttract.Play SeqLeftOn, 30, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqRightOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqRightOn, 15, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 15, 1
    LightSeqAttract.UpdateInterval = 10
    LightSeqAttract.Play SeqCircleOutOn, 15, 3
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqRightOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 25, 1
    LightSeqAttract.UpdateInterval = 5
    LightSeqAttract.Play SeqStripe1VertOn, 50, 2
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqCircleOutOn, 15, 2
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqStripe1VertOn, 50, 3
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqRightOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqCircleOutOn, 15, 2
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqStripe2VertOn, 50, 3
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqRightOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 25, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqStripe1VertOn, 25, 3
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqStripe2VertOn, 25, 3
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 15, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 15, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 15, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 15, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqUpOn, 15, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqDownOn, 15, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqRightOn, 15, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 15, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqRightOn, 15, 1
    LightSeqAttract.UpdateInterval = 8
    LightSeqAttract.Play SeqLeftOn, 15, 1
End Sub

Sub LightSeqAttract_PlayDone()
'when finishes the queue it restarts the sequence again
    StartAttractMode
End Sub

'******************************************************
'       	RealTime Updates
'******************************************************
Sub GameTimer_timer()
	RollingSoundUpdate
	BallShadowUpdate
	ToysUpdate
	dim1.rotZ=Spinner2.currentangle
	dim2.rotZ=Spinner2.currentangle
	LeftFlipperSh.RotZ = LeftFlipper.currentangle
	RightFlipperSh.RotZ = RightFlipper.currentangle
	LeftFlipper1Sh.RotZ = LeftFlipper1.currentangle
	RightFlipper1Sh.RotZ = RightFlipper1.currentangle
End Sub

'*********** ROLLING SOUND *********************************
Const tnob = 4 ' total number of balls
ReDim rolling(tnob)
InitRolling
Sub InitRolling:Dim i:For i=0 to (tnob-1):rolling(i) = False:Next:End Sub

Sub RollingSoundUpdate()
    Dim BOT, b
    BOT = GetBalls
	' stop the sound of deleted balls
	If UBound(BOT)<(tnob-1) Then
		For b = (UBound(BOT) + 1) to (tnob-1)
			rolling(b) = False
			StopSound("fx_ballrolling" & (b-1))
		Next
	End If
	' exit the Sub if no balls on the table
    If UBound(BOT) = 0 Then Exit Sub
	' play the rolling sound for each ball
    For b = 1 to UBound(BOT)
        If BallVel(BOT(b) ) > 1 AND BOT(b).z < 30 Then
            rolling(b) = True
			PlaySoundXY "fx_ballrolling" & (b-1), -1, Vol(BOT(b)), 1, BOT(b)
        Else
            If rolling(b) = True Then
                StopSound("fx_ballrolling" & (b-1))
                rolling(b) = False
            End If
        End If
    Next
End Sub

'*********** BALL SHADOW *********************************
Dim BallShadow:BallShadow = Array ("", BallShadow1, BallShadow2, BallShadow3)

Sub BallShadowUpdate()
    Dim BOT, b
    BOT = GetBalls
	' hide shadow of deleted balls
	If UBound(BOT)<(tnob-1) Then
		For b = (UBound(BOT) + 1) to (tnob-1)
			BallShadow(b).visible = 0
		Next
	End If
	' exit the Sub if no balls on the table
    If UBound(BOT) = 0 Then Exit Sub
	' render the shadow for each ball
    For b = 1 to UBound(BOT)
		If BOT(b).X < Table1.Width/2 Then
			BallShadow(b).X = ((BOT(b).X) - (50/6) + ((BOT(b).X - (Table1.Width/2))/7)) + 10
		Else
			BallShadow(b).X = ((BOT(b).X) + (50/6) + ((BOT(b).X - (Table1.Width/2))/7)) - 10
		End If
	    ballShadow(b).Y = BOT(b).Y + 20
		If BOT(b).Z > 20 Then
			BallShadow(b).visible = 1
		Else
			BallShadow(b).visible = 0
		End If
	Next
End Sub

'*************  TOYS SHAKE ON NUDGE  *************
Dim mMagnet, cBall, RatioMultiplier(4), RatioMult

Sub WobbleMagnet_Init
	 Set mMagnet = new cvpmMagnet
	 With mMagnet
		.InitMagnet WobbleMagnet, 1.5
		.Size = 100
		.CreateEvents mMagnet
		.MagnetOn = True
	 End With
	Set cBall = ckicker.createball:ckicker.Kick 0,0:mMagnet.addball cball
	RatioMult=2				'2 is a 200% ratio of ball movement to toy movement
 End Sub

Sub ToysUpdate
	If NOT defLbouncing.Enabled Then
		RatioMultiplier(0) = (headDEF1.z+170)/170*RatioMult*RndNum(5,10)*0.1		'multiply it with a random number between 0.5 and 1				
		headDEF1.rotx=(ckicker.y - cball.y)*RatioMultiplier(0)*0.5
		bodyDEF1.rotx=(ckicker.y - cball.y)*RatioMultiplier(0)*0.5
		kitDEF1.rotx=(ckicker.y - cball.y)*RatioMultiplier(0)*0.5
		bootsDEF1.rotx=(ckicker.y - cball.y)*RatioMultiplier(0)*0.5
		headDEF1.roty=(cball.x - ckicker.x)*RatioMultiplier(0)
		bodyDEF1.roty=(cball.x - ckicker.x)*RatioMultiplier(0)
		kitDEF1.roty=(cball.x - ckicker.x)*RatioMultiplier(0)
		bootsDEF1.roty=(cball.x - ckicker.x)*RatioMultiplier(0)
	End If

	If NOT defCbouncing.Enabled Then
		RatioMultiplier(1) = (headDEF2.z+170)/170*RatioMult*RndNum(5,10)*0.1		'multiply it with a random number between 0.5 and 1
		headDEF2.rotx=(ckicker.y - cball.y)*RatioMultiplier(1)*0.5
		bodyDEF2.rotx=(ckicker.y - cball.y)*RatioMultiplier(1)*0.5
		kitDEF2.rotx=(ckicker.y - cball.y)*RatioMultiplier(1)*0.5
		bootsDEF2.rotx=(ckicker.y - cball.y)*RatioMultiplier(1)*0.5
		headDEF2.roty=(cball.x - ckicker.x)*RatioMultiplier(1)
		bodyDEF2.roty=(cball.x - ckicker.x)*RatioMultiplier(1)
		kitDEF2.roty=(cball.x - ckicker.x)*RatioMultiplier(1)
		bootsDEF2.roty=(cball.x - ckicker.x)*RatioMultiplier(1)
	End If

	If NOT defRbouncing.Enabled Then
		RatioMultiplier(2) = (headDEF3.z+170)/170*RatioMult*RndNum(5,10)*0.1		'multiply it with a random number between 0.5 and 1
		headDEF3.rotx=(ckicker.y - cball.y)*RatioMultiplier(2)*0.5
		bodyDEF3.rotx=(ckicker.y - cball.y)*RatioMultiplier(2)*0.5
		kitDEF3.rotx=(ckicker.y - cball.y)*RatioMultiplier(2)*0.5
		bootsDEF3.rotx=(ckicker.y - cball.y)*RatioMultiplier(2)*0.5
		headDEF3.roty=(cball.x - ckicker.x)*RatioMultiplier(2)
		bodyDEF3.roty=(cball.x - ckicker.x)*RatioMultiplier(2)
		kitDEF3.roty=(cball.x - ckicker.x)*RatioMultiplier(2)
		bootsDEF3.roty=(cball.x - ckicker.x)*RatioMultiplier(2)
	End If

	If NOT bouncingL.Enabled Then
		RatioMultiplier(3) = (headLD.z+170)/170*RatioMult*RndNum(5,10)*0.1		'multiply it with a random number between 0.5 and 1
		headLD.rotx=(ckicker.y - cball.y)*RatioMultiplier(3)*0.5
		bodyLD.rotx=(ckicker.y - cball.y)*RatioMultiplier(3)*0.5
		kitLD.rotx=(ckicker.y - cball.y)*RatioMultiplier(3)*0.5
		bootsLD.rotx=(ckicker.y - cball.y)*RatioMultiplier(3)*0.5
		headLD.roty=(cball.x - ckicker.x)*RatioMultiplier(3)
		bodyLD.roty=(cball.x - ckicker.x)*RatioMultiplier(3)
		kitLD.roty=(cball.x - ckicker.x)*RatioMultiplier(3)
		bootsLD.roty=(cball.x - ckicker.x)*RatioMultiplier(3)
	End If

	If NOT bouncingR.Enabled Then
		RatioMultiplier(4) = (headRD.z+170)/170*RatioMult*RndNum(5,10)*0.1		'multiply it with a random number between 0.5 and 1
		headRD.rotx=(ckicker.y - cball.y)*RatioMultiplier(4)*0.5
		bodyRD.rotx=(ckicker.y - cball.y)*RatioMultiplier(4)*0.5
		kitRD.rotx=(ckicker.y - cball.y)*RatioMultiplier(4)*0.5
		bootsRD.rotx=(ckicker.y - cball.y)*RatioMultiplier(4)*0.5
		headRD.roty=(cball.x - ckicker.x)*RatioMultiplier(4)
		bodyRD.roty=(cball.x - ckicker.x)*RatioMultiplier(4)
		kitRD.roty=(cball.x - ckicker.x)*RatioMultiplier(4)
		bootsRD.roty=(cball.x - ckicker.x)*RatioMultiplier(4)
	End If
End Sub

'************************************************************************
'*RAMPS TRIGGERS*********************************************************
'************************************************************************
Sub LRailEnter_hit:PlaySoundAt "fx_metalrolling",ActiveBall:End Sub
Sub LRailExit_hit:stopsound "fx_metalrolling":PlaySoundAt "fx_ball_drop",ActiveBall:End Sub
Sub RRailEnter_hit:PlaySoundAt "fx_metalrolling",ActiveBall:End Sub
Sub RRailExit_hit:stopsound "fx_metalrolling":PlaySoundAt "fx_ball_drop",ActiveBall:End Sub
Sub RREnter_hit:If ActiveBall.VelY<0 Then PlaySoundAt "fx_rlenter",ActiveBall:End If:End Sub
Sub LREnter_hit:If ActiveBall.VelY<0 Then PlaySoundAt "fx_rlenter",ActiveBall:End If:End Sub
Sub LRHelp_hit:ActiveBall.VelX=ActiveBall.VelX*(0.5):End Sub
Sub LeftHole_hit:RandomSoundHole:End Sub
Sub RightHole_hit:PlaySoundAt "fx_hole_enter",ActiveBall:End Sub

'**********************************************************************
'*FUNCTIONS************************************************************
'**********************************************************************
Function Vol(ball) ' Calculates the Volume of the sound based on the ball speed
    Vol = Csng(BallVel(ball) ^2 / 200)
End Function

Function AudioPan(ball) ' Calculates the pan for a ball based on the X position on the table. "table1" is the name of the table
    Dim tmp
    tmp = ball.x * 2 / table1.width-1
    If tmp > 0 Then
        AudioPan = Csng(tmp ^10)
    Else
        AudioPan = Csng(-((- tmp) ^10) )
    End If
End Function

Function Pitch(ball) ' Calculates the pitch of the sound based on the ball speed
    Pitch = BallVel(ball) * 20
End Function

Function BallVel(ball) 'Calculates the ball speed
    BallVel = INT(SQR((ball.VelX ^2) + (ball.VelY ^2) ) )
End Function

Function AudioFade(ball)
    Dim tmp
    tmp = ball.y * 2 / Table1.height-1
    If tmp > 0 Then
        AudioFade = Csng(tmp ^10)
    Else
        AudioFade = Csng(-((- tmp) ^10) )
    End If
End Function

Function RndNum(min,max)
 RndNum = Int(Rnd()*(max-min+1))+min     ' Sets a random number between min AND max
End Function

'*********************************************************************
'                 Positional Sound Playback Routines
'*********************************************************************
Sub PlaySoundXY(soundname, loopcount, volume, useexisting, tableobj)
	If Table1.VersionMinor > 3 OR Table1.VersionMajor > 10 Then
		PlaySound soundname, loopcount, volume, AudioPan(tableobj), 0, Pitch(tableobj), useexisting, 0, AudioFade(tableobj)
	Else
		PlaySound soundname, loopcount, volume, AudioPan(tableobj), 0, Pitch(tableobj), useexisting, 0
	End If
End Sub

Sub PlaySoundAt(soundname, tableobj)
	If Table1.VersionMinor > 3 OR Table1.VersionMajor > 10 Then
		PlaySound soundname, 1, 1, AudioPan(tableobj), 0,0,0, 1, AudioFade(tableobj)
	Else
		PlaySound soundname, 1, 1, AudioPan(tableobj)
	End If
End Sub

Sub PlaySoundAtBall(soundname)
	If Table1.VersionMinor > 3 OR Table1.VersionMajor > 10 Then
		PlaySound soundname, 0, 10*Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
	Else
		PlaySound soundname, 0, 10*Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0
	End If
End Sub

Sub PlayLoopSoundAt(soundname, tableobj)
	If Table1.VersionMinor > 3 OR Table1.VersionMajor > 10 Then
		PlaySound soundname, -1, 1, AudioPan(tableobj), 0, 0, 1, 0, AudioFade(tableobj)
	Else
		PlaySound soundname, -1, 1, AudioPan(tableobj), 0, 0, 1, 0
	End If
End Sub

' *********************************************************************
' 						Other Sound FX
' *********************************************************************
'Ball Collision
Sub OnBallBallCollision(ball1, ball2, velocity)
	PlaySoundXY "fx_collide", 0, Csng(velocity) ^2 / 500, 0, ball1
End Sub

'Gates Collision
Sub Gates_Hit(idx):PlaysoundAt "fx_gate4", ActiveBall:End Sub

'Rubber Collision
Sub Rubbers_Hit(idx)
 	dim finalspeed
  	finalspeed=SQR((activeball.velx ^2) + (activeball.vely ^2))
 	If finalspeed > 20 then 
		PlaySoundAtBall "fx_rubber"
	End if
	If finalspeed >= 6 AND finalspeed <= 20 then
 		RandomSoundRubber()
 	End If
End Sub

Sub Posts_Hit(idx)
 	dim finalspeed
  	finalspeed=SQR((activeball.velx ^2) + (activeball.vely ^2))
 	If finalspeed > 16 then 
		PlaySoundAtBall "fx_rubber"
	End if
	If finalspeed >= 6 AND finalspeed <= 16 then
 		RandomSoundRubber()
 	End If
End Sub

Sub RandomSoundRubber()
	Select Case RndNum(1,3)
		Case 1 : PlaySoundAtBall "fx_rubber_hit_1"
		Case 2 : PlaySoundAtBall "fx_rubber_hit_2"
		Case 3 : PlaySoundAtBall "fx_rubber_hit_3"
	End Select
End Sub

Sub LeftFlipper_Collide(parm)
 	RandomSoundFlipper()
End Sub

Sub RightFlipper_Collide(parm)
 	RandomSoundFlipper()
End Sub

Sub LeftFlipper1_Collide(parm)
 	RandomSoundFlipper()
End Sub

Sub RightFlipper1_Collide(parm)
 	RandomSoundFlipper()
End Sub

Sub RandomSoundFlipper()
	Select Case RndNum(1,3)
		Case 1 : PlaySoundAtBall "fx_flip_hit_1"
		Case 2 : PlaySoundAtBall "fx_flip_hit_2"
		Case 3 : PlaySoundAtBall "fx_flip_hit_3"
	End Select
End Sub

Sub RandomSoundHole()
	Select Case Int(Rnd*3)+1
		Case 1 : PlaySoundAtBall "fx_Hole1"
		Case 2 : PlaySoundAtBall "fx_Hole2"
		Case 3 : PlaySoundAtBall "fx_Hole4"
	End Select
End Sub

'************************************************************************
'***********HIGHSCORES***************************************************
'************************************************************************
Dim highScore(6)									'The champion values
dim bestscores(4)									'1st (0) >> 4th (3) and temp(4) highscores
dim bestnames(3)									'1st (0) >> 4th (3) highscores names
Dim initials(3)										'What has been entered on the initial screen
Dim HighScoreName(6)								'The player initials
Dim inChar:inChar=65								'Which character the player is entering
Dim cursorPos:cursorPos=40							'Cursor position of character entry (0-2) Hitting START on character 3 finishes entry

Dim HSStrings:HSStrings=Array("Grand Champion","CL Champion","Free Kick Champion","MultiBall Champion","Video Mode Champion","GK Mode Champion")
Dim HSNames:HSNames=Array("HighScoreName","CLChampionName","FKChampionName","MMChampionName","VMChampionName","GKMChampionName")
Dim HSPos,HSPlace:HSPlace=-1
Dim cSpecial:cSpecial=0

'***********LOAD/SAVE HIGHSCORES*********************************************
Sub LoadHighScores
	Dim x
    x = LoadValue(cGameName, "HighScore1")
    If(x <> "")then bestscores(0) = CDbl(x) Else bestscores(0) = 50000000 End If
    x = LoadValue(cGameName, "HighScoreName1")
    If(x <> "")then bestnames(0) = x Else bestnames(0) = "NIN" End If
    x = LoadValue(cGameName, "HighScore2")
    If(x <> "")then bestscores(1) = CDbl(x) Else bestscores(1) = 40000000 End If
    x = LoadValue(cGameName, "HighScoreName2")
    If(x <> "")then bestnames(1) = x Else bestnames(1) = "TOM" End If
    x = LoadValue(cGameName, "HighScore3")
    If(x <> "")then bestscores(2) = CDbl(x) Else bestscores(2) = 30000000 End If
    x = LoadValue(cGameName, "HighScoreName3")
    If(x <> "")then bestnames(2) = x Else bestnames(2) = "M10" End If
    x = LoadValue(cGameName, "HighScore4")
    If(x <> "")then bestscores(3) = CDbl(x) :bestscores(4) = CDbl(x) Else bestscores(3) = 20000000 : bestscores(4) = 20000000 End If
    x = LoadValue(cGameName, "HighScoreName4")
    If(x <> "")then bestnames(3) = x Else bestnames(3) = "CHE" End If
    x = LoadValue(cGameName, "HighScore")
    If(x <> "")then HighScore(0) = CDbl(x) Else HighScore(0) = 70000000 End If
    x = LoadValue(cGameName, "HighScoreName")
    If(x <> "")then HighScoreName(0) = x Else HighScoreName(0) = "BAY" End If
    x = LoadValue(cGameName, "CLChampion")
    If(x <> "")then HighScore(1) = CInt(x) Else HighScore(1) = 1 End If
    x = LoadValue(cGameName, "CLChampionName")
    If(x <> "")then HighScoreName(1) = x Else HighScoreName(1) = "RMA" End If
    x = LoadValue(cGameName, "FKChampion")
    If(x <> "")then HighScore(2) = CInt(x) Else HighScore(2) = 4 End If
    x = LoadValue(cGameName, "FKChampionName")
    If(x <> "")then HighScoreName(2) = x Else HighScoreName(2) = "CR7" End If
    x = LoadValue(cGameName, "MMChampion")
    If(x <> "")then HighScore(3) = CDbl(x) Else HighScore(3) = 2500000 End If
    x = LoadValue(cGameName, "MMChampionName")
    If(x <> "")then HighScoreName(3) = x Else HighScoreName(3) = "PSG" End If
    x = LoadValue(cGameName, "VMChampion")
    If(x <> "")then HighScore(4) = CDbl(x) Else HighScore(4) = 2000000 End If
    x = LoadValue(cGameName, "VMChampionName")
    If(x <> "")then HighScoreName(4) = x Else HighScoreName(4) = "BAR" End If
    x = LoadValue(cGameName, "GKMChampion")
    If(x <> "")then HighScore(5) = CDbl(x) Else HighScore(5) = 2500000 End If
    x = LoadValue(cGameName, "GKMChampionName")
    If(x <> "")then HighScoreName(5) = x Else HighScoreName(5) = "JUV" End If
    x = LoadValue(cGameName, "Credits")
    If(x <> "")then creditgame = CInt(x) Else creditgame = 0 End If
End Sub

Sub LoadDefaultHighScores
	SaveValue cGameName, "HighScore1", 50000000
	SaveValue cGameName, "HighScoreName1", "NIN"
	SaveValue cGameName, "HighScore2", 40000000
	SaveValue cGameName, "HighScoreName2", "TOM"
	SaveValue cGameName, "HighScore3", 30000000
	SaveValue cGameName, "HighScoreName3", "M10"
	SaveValue cGameName, "HighScore4", 20000000
	SaveValue cGameName, "HighScoreName4", "CHE"
	SaveValue cGameName, "HighScore", 70000000
	SaveValue cGameName, "HighScoreName", "BAY"
	SaveValue cGameName, "CLChampion", 1
	SaveValue cGameName, "CLChampionName", "RMA"
	SaveValue cGameName, "FKChampion", 4
	SaveValue cGameName, "FKChampionName", "CR7"
	SaveValue cGameName, "MMChampion", 2500000
	SaveValue cGameName, "MMChampionName", "PSG"
	SaveValue cGameName, "VMChampion", 2000000
	SaveValue cGameName, "VMChampionName", "BAR"
	SaveValue cGameName, "GKMChampion", 2500000
	SaveValue cGameName, "GKMChampionName", "JUV"
End Sub

Sub SaveHighScores
	SaveValue cGameName, "HighScore1", bestscores(0)
	SaveValue cGameName, "HighScoreName1", bestnames(0)
	SaveValue cGameName, "HighScore2", bestscores(1)
	SaveValue cGameName, "HighScoreName2", bestnames(1)
	SaveValue cGameName, "HighScore3", bestscores(2)
	SaveValue cGameName, "HighScoreName3", bestnames(2)
	SaveValue cGameName, "HighScore4", bestscores(3)
	SaveValue cGameName, "HighScoreName4", bestnames(3)
	SaveValue cGameName, "HighScore", HighScore(0)
	SaveValue cGameName, "HighScoreName", HighScoreName(0)
	SaveValue cGameName, "CLChampion", HighScore(1)
	SaveValue cGameName, "CLChampionName", HighScoreName(1)
	SaveValue cGameName, "FKChampion", HighScore(2)
	SaveValue cGameName, "FKChampionName", HighScoreName(2)
	SaveValue cGameName, "MMChampion", HighScore(3)
	SaveValue cGameName, "MMChampionName", HighScoreName(3)
	SaveValue cGameName, "VMChampion", HighScore(4)
	SaveValue cGameName, "VMChampionName", HighScoreName(4)
	SaveValue cGameName, "GKMChampion", HighScore(5)
	SaveValue cGameName, "GKMChampionName", HighScoreName(5)
	SaveValue cGameName, "Credits", creditgame
End Sub

'***********CHECK FOR HIGHSCORES *********************************************
Sub CheckHS
	If scores(CurrentPlayer)>bestScores(4) Then								'4th position
		HSPos=4
		If scores(CurrentPlayer)>bestScores(2) Then HSPos=3					'3th position
		If scores(CurrentPlayer)>bestScores(1) Then HSPos=2					'2nd position
		If scores(CurrentPlayer)>bestScores(0) Then HSPos=1:cSpecial=1		'1st position
		If scores(CurrentPlayer)>highScore(0) Then HSPos=0:cSpecial=2		'grand champion
		bestScores(4)=scores(CurrentPlayer):HSPLACE=0:exit sub				'temporary save the score
	ElseIf CLChamp(CurrentPlayer)>highScore(1) Then
		highScore(1)=CLChamp(CurrentPlayer):HSPLACE=1:exit sub
	ElseIf FKChamp(CurrentPlayer)>highScore(2) Then
		highScore(2)=FKChamp(CurrentPlayer):HSPLACE=2:exit sub
	ElseIf LockMScoreBest(CurrentPlayer)>highScore(3) Then
		highScore(3)=LockMScoreBest(CurrentPlayer):HSPLACE=3:exit sub
	ElseIf VMChamp(CurrentPlayer)>highScore(4) Then
		highScore(4)=VMChamp(CurrentPlayer):HSPLACE=4:exit sub
	ElseIf GKMChamp(CurrentPlayer)>highScore(5) Then
		highScore(5)=GKMChamp(CurrentPlayer):HSPLACE=5:exit sub
	Else
	HSPLACE=-1
	End If
End Sub

Sub CheckHSTimer_timer
	If NOT UltraDMD.IsRendering  Then
		Me.Enabled=0
		CheckHs
		ExitHS.Interval=100:ExitHS.Enabled=1
	End If
End Sub

'***********NAME ENTERING SCREEN *********************************************
Sub nameEntry
	Dim strinitial:StrCase=1
	Initials(0)=0:Initials(1)=0:Initials(2)=0
	If UltraDMD.IsRendering Then UltraDMD.CancelRendering
	If inChar = 47 Then			'character /
		strinitial="    " &  " "  &   "Space"   & "     "
	ElseIf inChar = 91 Then		'character [
		strinitial="    " & "   " &     "<"     & "       "
	Else
		strinitial="    " & "   " & Chr(inChar) & "       "
	End If
	UltraDMD.DisplayScene00ExWithId "optnames00", false, "hiscore.png", "ENTER YOUR NAME", 15, 0, strinitial, 15, 0, UltraDMD_Animation_None, 999999, UltraDMD_Animation_None
End Sub

Sub nameEntryStart_timer
	Dim strinitial
	If inChar = 47 Then			'character /
		strinitial=" " & Chr(Initials(0)) & Chr(Initials(1)) & Chr(Initials(2)) &  " "  &   "Space"   & "     "
	ElseIf inChar = 91 Then		'character [
		strinitial=" " & Chr(Initials(0)) & Chr(Initials(1)) & Chr(Initials(2)) & "   " &     "<"     & "       "
	Else
		strinitial=" " & Chr(Initials(0)) & Chr(Initials(1)) & Chr(Initials(2)) & "   " & Chr(inChar) & "       "
	End If
	Dim nsteps:nsteps=StrCase-1
	Dim ndis:ndis=nsteps MOD 2
	If ndis=1 Then strinitial=strinitial Else strinitial=" " & Chr(Initials(0)) & Chr(Initials(1)) & Chr(Initials(2))  & "           " End If
	UltraDMD.ModifyScene00 "optnames00", "ENTER YOUR NAME", strinitial
	StrCase=StrCase+1
End Sub

'***********EXIT HIGHSCORES *********************************************
Sub ExitHs_timer
	Me.Enabled=0
	If HSPlace>=0 Then
		sendInitials HSPlace
		UltraDMD.CancelRendering
		PlaySound "jackpotgingle":FlasherEffect 5
		Select Case HSPlace
		Case 0
			If HSPos>0 Then
				UltraDMD.DisplayScene00 "", "Highscore " & HSPos,15, bestnames(HSPos-1) & "  " & formatnumber(bestScores(HSPos-1),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
			Else
				UltraDMD.DisplayScene00 "", HSStrings(0),15, highScoreName(0) & "  " & formatnumber(highScore(0),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
			End If
		Case 1
			UltraDMD.DisplayScene00 "", HSStrings(1),15, highScoreName(1) & "  " & highScore(1) & " CL WINS", 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
		Case 2
			UltraDMD.DisplayScene00 "", HSStrings(2),15, highScoreName(2) & "  " & highScore(2) & " FREE KICKS", 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
		Case 3
			UltraDMD.DisplayScene00 "", HSStrings(3),15, highScoreName(3) & "  " & formatnumber(highScore(3),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
		Case 4
			UltraDMD.DisplayScene00 "", HSStrings(4),15, highScoreName(4) & "  " & formatnumber(highScore(4),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
		Case 5
			UltraDMD.DisplayScene00 "", HSStrings(5),15, highScoreName(5) & "  " & formatnumber(highScore(5),0), 15, UltraDMD_Animation_None, 3000, UltraDMD_Animation_None
		End Select
		CheckHSTimer.Enabled=1
	Else
		If cSpecial>0 Then
			UltraDMD.DisplayScene00 "", "PLAYER " & (CurrentPlayer+1) & " AWARD:",15, cSpecial & " CREDITS" ,15,UltraDMD_Animation_None,2500,UltraDMD_Animation_None
			AddSpecial:CheckHSTimer.Enabled=1:StopMusic
		Else
			inChar=65:StopMusic
			If NewPlayer>CurrentPlayer+1 Then
				AdvancePlayer
			Else
				DisplayMatch
			End If
		End If
	End If
End Sub

Sub SendInitials(whichPlace)
	If whichPlace=0 Then
		If HSPos>0 Then
			bestScores(HSPos-1)=bestscores(4):bestnames(HSPos-1)=Chr(initials(0)) & Chr(initials(1)) & Chr(initials(2))
			SaveValue cGameName, "HighScore" & HSPos, bestScores(HSPos-1)
			SaveValue cGameName, "HighScoreName" & HSPos, bestnames(HSPos-1)
		Else
			highscore(0)=bestscores(4):HighScoreName(0)=Chr(initials(0)) & Chr(initials(1)) & Chr(initials(2))
			SaveValue cGameName, HSStrings(0), highscore(0)
			SaveValue cGameName, HSNames(0), HighScoreName(0)
		End If
	Else
		HighScoreName(whichPlace)=Chr(initials(0)) & Chr(initials(1)) & Chr(initials(2))
		SaveValue cGameName, HSStrings(whichPlace), highscore(whichPlace)
		SaveValue cGameName, HSNames(whichPlace), HighScoreName(whichPlace)
	End If
End Sub

'***********MATCH *********************************************
Dim temp1Match, temp2Match, temp3Match, temp4Match, rndMatch, creditspecial

Sub DisplayMatch
	temp1Match="  ":temp2Match="  ":temp3Match="  ":temp4Match="  "
	For ii=1 to NewPlayer
		ExecuteGlobal ("temp" & ii & "Match=" & Right(scores(ii-1),2) & ":")
	Next
	rndMatch=0 & Right(0,1):PlaySound "DrumRoll":For each ii in TeamLogos:StopFlash ii,0:Next
	SCFrame.visible=0:SCFrame.opacity=100:SCFrame.imageA="LCD_Introtxt_00":SCFrame.X=429.215:SCFrame.visible=1
	If UltraDMD.IsRendering Then UltraDMD.CancelRendering
	UltraDMD.DisplayScene00Ex "", "GAME OVER", 14, 2, "", -1, -1, UltraDMD_Animation_None, 1000, UltraDMD_Animation_None
	UltraDMD.DisplayScene00ExWithId "Match", false, "black.bmp",temp1Match & "   " & temp2Match & "    match",15,0,temp3Match & "  " & temp4Match & "     " & rndMatch & " ",15,0,UltraDMD_Animation_None,4500,UltraDMD_Animation_None
	MatchTimer.Enabled=1
End Sub

Sub MatchTimer_timer
	Randomize
	RndMatch= RndNum(0,9) & Right(0,1)
	UltraDMD.ModifyScene00 "Match", temp1Match & "   " & temp2Match & "    match", temp3Match & "  " & temp4Match & "     " & rndMatch & " "
	If NOT UltraDMD.IsRendering Then
		Me.Enabled=0
		UltraDMD.DisplayScene00Ex "black.bmp",temp1Match & "   " & temp2Match & "    match",15,0,temp3Match & "  " & temp4Match & "     " & rndMatch & " ",15,0,UltraDMD_Animation_None,2000,UltraDMD_Animation_None
		TempMatch:GameOver.Enabled=1
	End If
End Sub

Sub TempMatch
	If NewPlayer<>4 Then
	For ii=(NewPlayer+1) to 4
		ExecuteGlobal ("temp" & ii & "Match=999" & ":")
	Next
	End If
	If temp1Match/10=RndMatch/10 Then
		creditspecial=creditspecial+1
	ElseIf temp2Match/10=RndMatch/10 Then
		creditspecial=creditspecial+1
	ElseIf temp3Match/10=RndMatch/10 Then
		creditspecial=creditspecial+1
	ElseIf temp4Match/10=RndMatch/10 Then
		creditspecial=creditspecial+1
	Else
		PlaySound "DelusioneParata"
	End If
	If temp1Match/10=RndMatch/10 or temp2Match/10=RndMatch/10 or temp3Match/10=RndMatch/10 or temp4Match/10=RndMatch/10 Then AddSpecial
End Sub

Sub AddSpecial
	Select Case cSpecial
	Case 0		'awarded from match
		PlaySoundAt SoundFXDOF("fx_knocker",137,DOFPulse,DOFKnocker),trapkicker:Playsound "0_highscore":DOF 150, DOFOn
		If FreePlay=0 Then
			creditgame=creditgame+creditspecial
			If creditgame>MaximumCredits Then creditgame=MaximumCredits
		End If
		KnockerSound.Interval=300:KnockerSound.enabled=1
	Case 1		'awarded when score>highscore 1
		PlaySoundAt SoundFXDOF("fx_knocker",137,DOFPulse,DOFKnocker),trapkicker
		If FreePlay=0 AND creditgame<MaximumCredits Then creditgame=creditgame+1
		cSpecial=0:Playsound "V.replay":DOF 150, DOFOn
	Case 2		'awarded when score>grand champion score
		creditspecial=2:cSpecial=0:AddSpecial
	End Select
End Sub

Sub KnockerSound_timer
	Me.Enabled=0
	If creditspecial>1 Then
		PlaySoundAt SoundFXDOF("fx_knocker",137,DOFPulse,DOFKnocker),trapkicker:creditspecial=creditspecial-1:Me.Enabled=1
	Else
		creditspecial=0
	End If
End Sub

'*********************************************************************
'**** B2S LIGHTING ROUTINES ******************************************
'*********************************************************************
'Set the B2S lights IDs, these must match with the IDs you get from the B2SEditor
'ID=40	Logo Cup	ID=41	Flasher1	'ID=42	Flasher2	'ID=43	Flasher3	'ID=44	Logo CL		'ID=99	BackGround
Const B2SLogoCL = 40, B2SLight1 = 41, B2SLight2 = 42, B2SLight3 = 43, B2SLight4 = 44, B2Sbkgnd = 99

'************************INGAME B2S EFFECTS *******************************************
'flash a b2s light(or array of lights) 'ntimes' at 'OnOffSpeed' interval
Dim B2SID,B2SStep,B2SStep1,B2SStep2
Sub B2SEffect(obj,ntimes,OnOffSpeed)
	If B2SOn Then
		B2SFlash.enabled = 0
		Controller.B2SSetData B2SLight1, 0
		Controller.B2SSetData B2SLight2, 0
		Controller.B2SSetData B2SLight3, 0
		Controller.B2SSetData B2SLight4, 0
		B2SID = obj
		B2SStep=ntimes*2-1
		B2SFlash.interval=OnOffSpeed
		B2SFlash.enabled = 1
	End If
End Sub

Sub B2SFlash_timer
	Dim nsteps
	If B2SStep>1 Then nsteps=B2SStep MOD 2 Else nsteps=B2SStep End If
	If IsArray(B2SID) Then
		For ii=0 to Ubound(B2SID)
		Controller.B2SSetData B2SID(ii), nsteps
		Next
	Else
		Controller.B2SSetData B2SID, nsteps
	End If
	B2SStep=B2SStep-1
	If B2SStep<0 Then
		Me.Enabled=0
		If IsArray(B2SID) Then
			For ii=0 to Ubound(B2SID)
				Controller.B2SSetData B2SID(ii), 0
			Next
		Else
			Controller.B2SSetData B2SID, 0
		End If
	End If
End Sub

Sub B2SOnbkgnd
	If B2SOn Then Controller.B2SSetData B2Sbkgnd, 1
End Sub

Sub B2SOffbkgnd
	If B2SOn Then Controller.B2SSetData B2Sbkgnd, 0
End Sub

'************************CL CUP LOGO******************************************** 
Sub UpdateB2SLogos
	If B2SOn Then
		B2SLogos.Enabled=0:B2SStep1=1:Controller.B2SSetData B2SLogoCL, Cstr(lClWin.visible)
		If win(CurrentPlayer)=6 Then Controller.B2SSetData B2SLogoCL, 1:B2SLogos.Interval=75:B2SLogos.Enabled=1
	End If
End Sub

Sub B2SLogos_timer
	Dim nsteps:nsteps=B2SStep1
	Controller.B2SSetData B2SLogoCL, nsteps MOD 2
	B2SStep1=B2SStep1+1
	If B2SStep1=3 Then B2SStep1=1
End Sub

'************************ATTRACT MODE*********************************************
Sub B2SAttract_timer
	Dim nsteps:nsteps=B2SStep2
	Randomize:Controller.B2SSetData RndNum(40,44), nsteps MOD 2
	B2SStep2=B2SStep2+1
	If B2SStep2=3 Then B2SStep2=1
End Sub

'******************************************************************************************
'* TABLE OPTIONS MENU *********************************************************************
'******************************************************************************************
Dim BallType, FreePlay, BallsPerGame, TiltSensitivity, TiltMaxWarnings, CornerTime, GKModeDifficulty,VModeDifficulty
Dim optBallType,optFreeplay,optBallsPerGame,optTiltSensor,optTiltWarnings,optCornerMode,optGKMode,optVideoMode
Dim OptionValue,OptionPlace,StrCase,OptMenu,OptDir,StrOption(7),OptMenuEnabled:OptMenuEnabled=False
Dim StrFeature:StrFeature=Array("   BALL TYPE    ","    FREE PLAY   "," BALLS PER GAME ","  TILT  SENSOR  "," TILT  WARNINGS ","   CORNER MODE  ","     GK MODE    ","   VIDEO MODE   "," FACTORY  RESET ")
Dim StrNames:StrNames = Array(Array("   STEEL BALL   ","   SOCCER BALL  "),Array("       NO       ","       YES      "),_
							Array("        3       ","        4       ","        5       "), Array("      EASY      ","     MEDIUM     ","      HARD      "),_
							Array("        0       ","        1       ","        2       "), Array("      EASY      ","     MEDIUM     ","      HARD      "),_
							Array("      EASY      ","     MEDIUM     ","      HARD      "), Array("      EASY      ","     MEDIUM     ","      HARD      "))

Sub ManageTableOptions (byVal keycode)
	If keycode = 64 Then ShowDMDOptions(cgamename)													'F6-show the dmd options menu
	If keycode = 8 AND OptMenuEnabled AND NOT OptMenuEnter.Enabled Then								'key 7
		If OptMenu>0 Then OptMenu=OptMenu-1
		If OptMenu=0 Then OptMainMenu.Enabled=0:OptMenuExit.Enabled=1
		If OptMenu=1 Then OptMenuChoice.Enabled=0:CancelTableOption:Playsound "fx_Esc"
	End If
	If keycode = 9 AND OptMenuEnabled Then optdir=-1:OptionChange:Playsound "fx_Next"				'key 8
	If keycode = 10 AND OptMenuEnabled Then optdir=1:OptionChange:Playsound "fx_Previous"			'key 9
	If keycode = 11 AND NOT OptMenuEnter.Enabled AND cAttractMode=1 Then							'key 0
		StartOptionMenu:Playsound "swoosh"
	End If
	If keycode = 11 AND OptMenuEnabled Then
		If OptMenu<3 Then OptMenu=OptMenu+1
		If OptMenu=2 Then Playsound "fx_Enter":OptMainMenu.Enabled=0:DisplayTableOption:If OptionPlace<8 Then OptMenuChoice.Enabled=1
		If OptMenu=3 Then Playsound "fx_Enter":OptMenuChoice.Enabled=0:SaveTableOptions
	End If
End Sub

Sub OptMenuExit_timer
	If NOT UltraDMD.IsRendering Then
		Me.Enabled=0:OptMenu=0:OptionPlace=0:OptMenuEnabled=False
		PlaySound "reset":DisplayIntro.Enabled=1:StartAttractMode
	End If
End Sub

Sub StartOptionMenu
	DisplayIntroHS.Enabled=0:DisplayIntro.Enabled=0:DisplayStartScreen.Enabled=0
	UltraDMD.CancelRendering:OptMenuEnabled=True:StopAttractMode:StopMusic
	ScFrame.opacity=50:SCframe.imageA="LCD_SERVICE":SCframe.visible=1
	UltraDMD.DisplayScene00 "", "  GAME OPTIONS  ",15, "", 15, 14, 1000, 14
	OptMenuEnter.Enabled=1
End Sub

Sub OptMenuEnter_timer
	If NOT UltraDMD.IsRendering Then
		Me.Enabled=0:OptMenu=1:OptMainMenu.Enabled=1
	End If
End Sub

Sub OptMainMenu_timer
	If OptionPlace<0 Then OptionPlace=8
	If OptionPlace>8 Then OptionPlace=0
	UltraDMD.DisplayScene00 "black.bmp", StrFeature(OptionPlace),15, "", 15, 14, -1, 14
	UltraDMD.CancelRendering
End Sub

Sub DisplayTableOption
	StrOption(0)=StrNames(0)(optBallType):StrOption(1)=StrNames(1)(optFreeplay)
	StrOption(2)=StrNames(2)(optBallsPerGame):StrOption(3)=StrNames(3)(optTiltSensor)
	StrOption(4)=StrNames(4)(optTiltWarnings):StrOption(5)=StrNames(5)(optCornerMode)
	StrOption(6)=StrNames(6)(optGKMode):StrOption(7)=StrNames(7)(optVideoMode):StrCase=1
	If OptionPlace=8 Then
		UltraDMD.DisplayScene00 "black.bmp", "HIT OK TO SET TO", 15, "DEFAULT  OPTIONS", 15, 14, 999999, 14
	Else
		UltraDMD.DisplayScene00ExWithId "optmenu00", false, "black.bmp", StrFeature(OptionPlace), 15, 0, StrOption(OptionPlace), 15, 0, 14, 999999, 14
	End If
End Sub

Sub OptMenuChoice_timer
	Dim nsteps:nsteps=StrCase-1
	Dim ndis:ndis=nsteps MOD 2
	Select Case OptionPlace
		Case 0
		If ndis=1 Then StrOption(0)=StrNames(0)(optBallType) Else StrOption(0)="" End If
		Case 1
		If ndis=1 Then StrOption(1)=StrNames(1)(optFreeplay) Else StrOption(1)="" End If
		Case 2
		If ndis=1 Then StrOption(2)=StrNames(2)(optBallsPerGame) Else StrOption(2)="" End If
		Case 3
		If ndis=1 Then StrOption(3)=StrNames(3)(optTiltSensor) Else StrOption(3)="" End If
		Case 4
		If ndis=1 Then StrOption(4)=StrNames(4)(optTiltWarnings) Else StrOption(4)="" End If
		Case 5
		If ndis=1 Then StrOption(5)=StrNames(5)(optCornerMode) Else StrOption(5)="" End If
		Case 6
		If ndis=1 Then StrOption(6)=StrNames(6)(optGKMode) Else StrOption(6)="" End If
		Case 7
		If ndis=1 Then StrOption(7)=StrNames(7)(optVideoMode) Else StrOption(7)="" End If
	End Select
	UltraDMD.ModifyScene00 "optmenu00", StrFeature(OptionPlace), StrOption(OptionPlace)
	StrCase=StrCase+1
End Sub

Sub OptionChange
	If OptMenu=1 Then OptMainMenu.Enabled=0:OptionPlace=OptionPlace+optdir:OptMainMenu.Enabled=1
	If OptMenu=2 Then ChangeTableOption OptionPlace
End Sub

Sub ChangeTableOption(nr)
Select Case nr
	Case 0		'change ball type option
	optBallType=optBallType+optdir
	if optBallType>1 Then optBallType=0
	if optBallType<0 Then optBallType=1

	Case 1		'change free play option
	optFreeplay=optFreeplay+optdir
	if optFreeplay>1 Then optFreeplay=0
	if optFreeplay<0 Then optFreeplay=1

	Case 2		'change balls per game
	optBallsPerGame=optBallsPerGame+optdir
	if optBallsPerGame>2 Then optBallsPerGame=0
	if optBallsPerGame<0 Then optBallsPerGame=2

	Case 3		'change tilt sensitivity
	optTiltSensor=optTiltSensor+optdir
	if optTiltSensor>2 Then optTiltSensor=0
	if optTiltSensor<0 Then optTiltSensor=2

	Case 4		'change tilt warnings
	optTiltWarnings=optTiltWarnings+optdir
	if optTiltWarnings>2 Then optTiltWarnings=0
	if optTiltWarnings<0 Then optTiltWarnings=2

	Case 5		'change corner difficulty
	optCornerMode=optCornerMode+optdir
	if optCornerMode>2 Then optCornerMode=0
	if optCornerMode<0 Then optCornerMode=2

	Case 6		'change gk mode difficulty
	optGKMode=optGKMode+optdir
	if optGKMode>2 Then optGKMode=0
	if optGKMode<0 Then optGKMode=2

	Case 7		'change video mode difficulty
	optVideoMode=optVideoMode+optdir
	if optVideoMode>2 Then optVideoMode=0
	if optVideoMode<0 Then optVideoMode=2
End Select
End Sub

Sub LoadTableOptions
	OptionValue=LoadValue (cGameName, "Options")
	If OptionValue = "" then
		OptionValue = 0*1 + 0*2 + 0*4 + 1*16 + 2*64 + 1*256 + 1*1024 + 1*4096		'default value is 5520
		SaveValue cGameName, "Options", OptionValue
	End If
	Dim tmp:tmp=OptionValue
	optVideoMode=Int(tmp/2^12)
	tmp=OptionValue mod 2^12
	optGKMode=Int(tmp/2^10)
	tmp=tmp mod 2^10
	optCornerMode=Int(tmp/2^8)
	tmp=tmp mod 2^8
	optTiltWarnings=Int(tmp/2^6)
	tmp=tmp mod 2^6
	optTiltSensor=Int(tmp/2^4)
	tmp=tmp mod 2^4
	optBallsPerGame=Int(tmp/2^2)
	tmp=tmp mod 2^2
	optFreeplay=Int(tmp/2)
	tmp=tmp mod 2
	optBallType=Int(tmp)
	tmp=tmp mod 1
	GetOptions
End Sub

Sub SaveTableOptions
	If OptionPlace<8 Then
		OptionValue = optBallType*2^0 + optFreePlay*2^1 + optBallsPerGame*2^2 + optTiltSensor*2^4 + optTiltWarnings*2^6 + optCornerMode*2^8 + optGKMode*2^10 + optVideoMode*2^12
	Else
		OptionValue = 0*1 + 0*2 + 0*4 + 1*16 + 2*64 + 1*256 + 1*1024 + 1*4096		'reset table options to factory
		LoadDefaultHighScores												'reset highscores values to factory
	End If
	SaveValue cGameName, "Options", OptionValue
	If UltraDMD.IsRendering Then UltraDMD.CancelRendering
	UltraDMD.DisplayScene00 "black.bmp","SAVING SETTING",15,"",15,14,1500,14
	LoadTableOptions:OptMenuEnter.Enabled=1
End Sub

Sub CancelTableOption
	If UltraDMD.IsRendering Then UltraDMD.CancelRendering
	UltraDMD.DisplayScene00 "black.bmp","",15,"",15,14,100,14
	OptMenuEnter.Enabled=1
End Sub

Sub GetOptions
	BallType=optBallType
	FreePlay=optFreePlay
	BallsPerGame=3+optBallsPerGame
	Select Case optTiltSensor
		Case 0		'easy
			TiltSensitivity=2
		Case 1		'medium
			TiltSensitivity=5
		Case 2		'hard
			TiltSensitivity=8
	End Select
	TiltMaxWarnings = optTiltWarnings
	Select Case optCornerMode
		Case 0		'easy
			CornerTime=2
		Case 1		'medium
			CornerTime=5
		Case 2		'hard
			CornerTime=8
	End Select
	GKModeDifficulty = optGKMode
	VModeDifficulty = optVideoMode
End Sub

'*************************
'****MULTIPLAYER**********
'*************************
Sub ResetPlayerStatus
'save all lights , then all lights off and reset blink patterns
	SavePlayerLampStates
	For each ii in AllInserts:ii.state=0:Next
	superjackpot.BlinkPattern="1000":LmultiLock.BlinkPattern="0001":Lmultiticket.BlinkPattern="0100":Lmultiskill.BlinkPattern="0010"
	superjackpot.BlinkInterval=100:LmultiLock.BlinkInterval=100:Lmultiticket.BlinkInterval=100:Lmultiskill.BlinkInterval=100
	ticket1.BlinkPattern="000100":ticket2.BlinkPattern="000010":ticket3.BlinkPattern="000001"
	ticket1.BlinkInterval=100:ticket2.BlinkInterval=100:ticket3.BlinkInterval=100:ticketjackpot.BlinkInterval=100
	Lwinqualify.BlinkPattern="10":Lwinqualify.BlinkInterval=150
	Lwingroup.BlinkPattern="10":Lwingroup.BlinkInterval=150
	Lwinfirst.BlinkPattern="10":Lwinfirst.BlinkInterval=150
	Lwinquarter.BlinkPattern="10":Lwinquarter.BlinkInterval=150
	Lwinsemi.BlinkPattern="10":Lwinsemi.BlinkInterval=150
	ArrowEffect False:For each ii in VMFlashers:StopFlash ii,0:Next
'reset multiball mode
	LockMultiMode=0:TicketMultiMode=0:SkillMultiMode=0
'reset the diverter
	If DiverterP.Z<50 Then TicketDiverter True
'reset FK lights
	StopFlash FKFL1,0:StopFlash FKFL2,0:StopFlash FKFL3,0:StopFlash FKFL4,0:StopFlash FKFL5,0
'reset Substitution Board
	If subwall.Z>140 Then tspeed=2:TabletDown:tabletstate=1
	subwall.image = "sub_text"
'reset LCD & Scoreboard
	screenprim.visible=1:screenprim.image="logoCL"
	For each ii in TeamLogos:StopFlash ii,0:Next:SCFrame.visible=0:SCFrame.X=429.215
'reset b2s logos
	StopFlash lClwin,0:UpdateB2SLogos
'reset the Defenders
	MOVEGK.enabled=0:ResetGK:move=0
	If headGK.Z>0 Then GKHOLEin.enabled=1
	defencedown.enabled=1:PlayLoopSoundAt SoundFXDOF("fx_motorD",128,DOFOn,DOFGear),defpost
'reset the Strikers
	If headLD.Z>0 Then bomberLdown.enabled=1:PlaySoundAt SoundFXDOF("fx_postdown",134,DOFPulse,DOFDropTargets),headLD:hitLD.isdropped=1:WALL32.ISDROPPED=1
	If headRD.Z>0 Then bomberRdown.enabled=1:PlaySoundAt SoundFXDOF("fx_postdown",135,DOFPulse,DOFDropTargets),headRD:hitRD.isdropped=1:WALL33.ISDROPPED=1
'reset the Snack Bar
	If TrapDoorP.Z>0 then OpenTrapDoor False:StopFlash TDFL1,0:StopFlash TDFL2,0:StopFlash TDFL3,0
End Sub

Sub UpdatePlayerStatus
'player is playing the Final
	If progress(CurrentPlayer)=5 Then
		Lwinqualify.BlinkPattern="10000":Lwinqualify.BlinkInterval=80
		Lwingroup.BlinkPattern="01000":Lwingroup.BlinkInterval=80
		Lwinfirst.BlinkPattern="00100":Lwinfirst.BlinkInterval=80
		Lwinquarter.BlinkPattern="00010":Lwinquarter.BlinkInterval=80
		Lwinsemi.BlinkPattern="00001":Lwinsemi.BlinkInterval=80
	End If
'update playfield inserts
	RestorePlayerLampStates
'update multiball mode
	If MVPOfTheYear(CurrentPlayer)=0 AND llock.state=1 AND llock1.state=1 AND llock2.state=1 AND llock3.state=1 AND lmultilock.state=2 Then LockMultiMode=1:TicketDiverter False
	If MVPOfTheYear(CurrentPlayer)=0 AND ticket1.state=1 AND ticket2.state=1 AND ticket3.state=1 AND lmultilock.state=2 Then TicketMultiMode=1:TicketDiverter False
	If MVPOfTheYear(CurrentPlayer)=0 AND skill1.state=1 AND skill2.state=1 AND skill3.state=1 AND lmultilock.state=2 Then SkillMultiMode=1:TicketDiverter False
'update FK lights
	If FkGoal(CurrentPlayer)=1 Then StopFlash FKFL1,1
	If FkGoal(CurrentPlayer)=2 Then StopFlash FKFL1,1:StopFlash FKFL2,1
	If FkGoal(CurrentPlayer)=3 Then StopFlash FKFL1,1:StopFlash FKFL2,1:StopFlash FKFL3,1
	If FkGoal(CurrentPlayer)=4 Then StopFlash FKFL1,1:StopFlash FKFL2,1:StopFlash FKFL3,1:StopFlash FKFL4,1
	If FkGoal(CurrentPlayer)=5 Then StopFlash FKFL1,1:StopFlash FKFL2,1:StopFlash FKFL3,1:StopFlash FKFL4,1:StopFlash FKFL5,1
'update Substitution Board
	If MVPOfTheYear(CurrentPlayer)=0 AND llock.state=1 AND llock1.state=2 AND llock2.state=2 AND llock3.state=2 Then subwall.image = "sub_textSUB":tspeed=0.5:TabletUp
	If MVPOfTheYear(CurrentPlayer)=0 AND llock.state=1 AND llock1.state=1 AND llock2.state=2 AND llock3.state=2 Then subwall.image = "sub_textSUB1":tspeed=0.5:TabletUp
	If MVPOfTheYear(CurrentPlayer)=0 AND llock.state=1 AND llock1.state=1 AND llock2.state=1 AND llock3.state=2 Then subwall.image = "sub_textSUB2":tspeed=0.5:TabletUp
	If MVPOfTheYear(CurrentPlayer)=0 AND llock.state=1 AND llock1.state=1 AND llock2.state=1 AND llock3.state=1 Then subwall.image = "sub_textSUB3":tspeed=0.5:TabletUp
'update LCD & Scoreboard
	qualifyprim.image="logo" & teamone(CurrentPlayer)
	groupprim.image="logo" & teamtwo(CurrentPlayer)
	firstprim.image="logo" & teamthree(CurrentPlayer)
	quarterprim.image="logo" & teamfour(CurrentPlayer)
	semiprim.image="logo" & teamfive(CurrentPlayer)
	finalprim.image="logo" & teamsix(CurrentPlayer)
	screenprim.visible=0
	If MVPOfTheYear(CurrentPlayer)=1 Then
		SCFrame.X=399.215:SCFrame.imageA="LCD_ballondor":SCFrame.opacity=50:SCFrame.visible=1:Teamlogos(3).imageA="Logo_BallonDor":StopFlash Teamlogos(3),1
	Else
		UpdateTeamLogos:StopFlash TeamLogos(3),1
	End If
'update DMD Team logo
	UltraDMD.SetScoreboardBackgroundImage "BACK" & choiceteam(CurrentPlayer) & ".png", 15, 10
'update kits
	UpdateTeams:ResetGKTimer.enabled=0
'update b2s logos
	UpdateB2SLogos
'update Defenders	
	Select Case DefenceLocked(CurrentPlayer)
		Case 0		'defenders are not locked
			If win(CurrentPlayer)=defencestate(CurrentPlayer) Then
				If MVPOfTheYear(CurrentPlayer)=1 Then
					moveback=3:GKcount.Interval=2000:GKcount.enabled=1:firstdefenceup.enabled=1:PlayLoopSoundAt SoundFXDOF("fx_motorD",128,DOFOn,DOFGear),defpost:CornerModeOn
				Else
					moveback=99:GKHOLEout.enabled=1:ArrowEffect True	'move only the gk
				End If
				If win(CurrentPlayer)=6 Then Flash lClWin,75:For each ii in VMFlashers:Flash ii,75:Next
			Else
				GKcount.Interval=2000:GKcount.enabled=1:firstdefenceup.enabled=1:PlayLoopSoundAt SoundFXDOF("fx_motorD",128,DOFOn,DOFGear),defpost:CornerModeOn
			End If
			If BLHit(CurrentPlayer)>0 Then bomberLup.enabled=1:brake2=0:perc2=perc2+3:sbou2=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",134,DOFPulse,DOFDropTargets),headLD
			If BRHit(CurrentPlayer)>0 Then bomberRup.enabled=1:brake=0:perc=perc+3:sbou=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",135,DOFPulse,DOFDropTargets),headRD
		Case 1		'defenders are locked (bombers up)
			GKcount.Interval=2000:GKcount.enabled=1:firstdefenceup.enabled=1:PlayLoopSoundAt SoundFXDOF("fx_motorD",128,DOFOn,DOFGear),defpost:CornerModeOn
			bomberLup.enabled=1:brake2=0:perc2=perc2+3:sbou2=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",134,DOFPulse,DOFDropTargets),headLd
			bomberRup.enabled=1:brake=0:perc=perc+3:sbou=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",135,DOFPulse,DOFDropTargets),headRd
		Case 2		'player unlocks the defenders
			GKcount.Interval=2000:GKcount.enabled=1:firstdefenceup.enabled=1:PlayLoopSoundAt SoundFXDOF("fx_motorD",128,DOFOn,DOFGear),defpost:CornerModeOn
			If BLHit(CurrentPlayer)>0 Then bomberLup.enabled=1:brake2=0:perc2=perc2+3:sbou2=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",134,DOFPulse,DOFDropTargets),headLd
			If BRHit(CurrentPlayer)>0 Then bomberRup.enabled=1:brake=0:perc=perc+3:sbou=(Rndnum(-10,10))/10:PlaySoundAt SoundFXDOF("fx_postup",135,DOFPulse,DOFDropTargets),headRd
	End Select
'update Snack Bar
	If MVPOfTheYear(CurrentPlayer)=0 Then											'player wasn't playing MVP
		'snackbar was opened because player started striker mode but did not collect it
		If StrikerModeStart(CurrentPlayer)=1 Then tdfcolor=StrikerMode(CurrentPlayer):OpenTrapDoor True
		'player was awarded an extraball from Fk or semif, but he didn't collect it: snackbar was opened (with red Lights)
		If FKAward(CurrentPlayer)=1 or SemiFinalAward(CurrentPlayer)=1 Then tdfcolor=4:OpenTrapDoor True
		'player was awarded the break spin, but he didn't collect it: snackbar was opened (with break spin mode Lights)
		If BSMODE(CurrentPlayer)=1 Then tdfcolor=6:OpenTrapDoor True
	Else
	'player was playing MVP	
		If finaljackpot.state=0 Then tdfcolor=5:OpenTrapDoor True:GiEffect 4		'player still didn't shot at the snackbar (mvp step 1)open the Snack Bar to start MVP
		If finaljackpot.state=2 Then												'player already shot at the snackbar (mvp step 2)
			MVPEffectType=3:MVPEffect.Enabled=1
			superjackpot.BlinkPattern="10":LmultiLock.BlinkPattern="10":Lmultiticket.BlinkPattern="10":Lmultiskill.BlinkPattern="10"
			superjackpot.BlinkInterval=500:LmultiLock.BlinkInterval=500:Lmultiticket.BlinkInterval=500:Lmultiskill.BlinkInterval=500
			ticket1.BlinkPattern="10":ticket2.BlinkPattern="10":ticket3.BlinkPattern="10"
			ticket1.BlinkInterval=200:ticket2.BlinkInterval=200:ticket3.BlinkInterval=200:ticketjackpot.BlinkInterval=200
		End If
	End If
End Sub

